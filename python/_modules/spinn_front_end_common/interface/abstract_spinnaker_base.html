
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spinn_front_end_common.interface.abstract_spinnaker_base &#8212; SpiNNFrontEndCommon 6.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SpiNNFrontEndCommon 6.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spinn_front_end_common.interface.abstract_spinnaker_base</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for spinn_front_end_common.interface.abstract_spinnaker_base</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2017-2019 The University of Manchester</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">main interface for the SpiNNaker tools</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Condition</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">numpy_version</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.timer</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.log</span> <span class="kn">import</span> <span class="n">FormatAdapter</span>
<span class="kn">from</span> <span class="nn">spinn_utilities</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">spinn_utils_version</span>
<span class="kn">from</span> <span class="nn">spinn_machine</span> <span class="kn">import</span> <span class="n">CoreSubsets</span>
<span class="kn">from</span> <span class="nn">spinn_machine</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">spinn_machine_version</span>
<span class="kn">from</span> <span class="nn">spinnman.model.enums.cpu_state</span> <span class="kn">import</span> <span class="n">CPUState</span>
<span class="kn">from</span> <span class="nn">spinnman</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">spinnman_version</span>
<span class="kn">from</span> <span class="nn">spinnman.exceptions</span> <span class="kn">import</span> <span class="n">SpiNNManCoresNotInStateException</span>
<span class="kn">from</span> <span class="nn">spinnman.model.cpu_infos</span> <span class="kn">import</span> <span class="n">CPUInfos</span>
<span class="kn">from</span> <span class="nn">spinnman.messages.scp.enums.signal</span> <span class="kn">import</span> <span class="n">Signal</span>
<span class="kn">from</span> <span class="nn">data_specification</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">data_spec_version</span>
<span class="kn">from</span> <span class="nn">spalloc</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">spalloc_version</span>
<span class="kn">from</span> <span class="nn">pacman.model.placements</span> <span class="kn">import</span> <span class="n">Placements</span>
<span class="kn">from</span> <span class="nn">pacman.executor</span> <span class="kn">import</span> <span class="n">PACMANAlgorithmExecutor</span>
<span class="kn">from</span> <span class="nn">pacman.executor.injection_decorator</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">clear_injectables</span><span class="p">,</span> <span class="n">provide_injectables</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.model.graphs.application</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ApplicationGraph</span><span class="p">,</span> <span class="n">ApplicationGraphView</span><span class="p">,</span> <span class="n">ApplicationEdge</span><span class="p">,</span> <span class="n">ApplicationVertex</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.model.graphs.machine</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MachineGraph</span><span class="p">,</span> <span class="n">MachineGraphView</span><span class="p">,</span> <span class="n">MachineVertex</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.model.resources</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConstantSDRAM</span><span class="p">,</span> <span class="n">PreAllocatedResourceContainer</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">pacman_version</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.config_holder</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_config_bool</span><span class="p">,</span> <span class="n">get_config_int</span><span class="p">,</span> <span class="n">get_config_str</span><span class="p">,</span> <span class="n">get_config_str_list</span><span class="p">,</span>
    <span class="n">set_config</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.abstract_models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AbstractSendMeMulticastCommandsVertex</span><span class="p">,</span>
    <span class="n">AbstractVertexWithEdgeToDependentVertices</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">,</span>
    <span class="n">AbstractCanReset</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.provenance</span> <span class="kn">import</span> <span class="n">ProvenanceWriter</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities</span> <span class="kn">import</span> <span class="n">globals_variables</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SARK_PER_MALLOC_SDRAM_USAGE</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.exceptions</span> <span class="kn">import</span> <span class="n">ConfigurationException</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.helpful_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">convert_time_diff_to_total_milliseconds</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.report_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">EnergyReport</span><span class="p">,</span> <span class="n">TagsFromMachineReport</span><span class="p">,</span> <span class="n">report_xml</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.utility_objs</span> <span class="kn">import</span> <span class="n">ExecutableType</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utility_models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CommandSender</span><span class="p">,</span> <span class="n">CommandSenderMachineVertex</span><span class="p">,</span>
    <span class="n">DataSpeedUpPacketGatherMachineVertex</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.iobuf_extractor</span> <span class="kn">import</span> <span class="n">IOBufExtractor</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.java_caller</span> <span class="kn">import</span> <span class="n">JavaCaller</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.config_handler</span> <span class="kn">import</span> <span class="n">ConfigHandler</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.provenance</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PacmanProvenanceExtractor</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.simulator_status</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RUNNING_STATUS</span><span class="p">,</span> <span class="n">SHUTDOWN_STATUS</span><span class="p">,</span> <span class="n">Simulator_Status</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.interface_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ChipProvenanceUpdater</span><span class="p">,</span>  <span class="n">PlacementsProvenanceGatherer</span><span class="p">,</span>
    <span class="n">RouterProvenanceGatherer</span><span class="p">,</span> <span class="n">interface_xml</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">spinn_front_end_common</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">fec_version</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">scipy_version</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">scipy_version</span> <span class="o">=</span> <span class="s2">&quot;scipy not installed&quot;</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">FormatAdapter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>

<span class="c1">#: Number of cores to be used when using a Virtual Machine and not specified</span>
<span class="n">DEFAULT_N_VIRTUAL_CORES</span> <span class="o">=</span> <span class="mi">16</span>

<span class="c1">#: The minimum time a board is kept in the off state, in seconds</span>
<span class="n">MINIMUM_OFF_STATE_TIME</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># 0-15 are reserved for system use (per lplana)</span>
<span class="n">ALANS_DEFAULT_RANDOM_APP_ID</span> <span class="o">=</span> <span class="mi">16</span>

<span class="c1"># Number of provenace items before auto changes to sql format</span>
<span class="n">PROVENANCE_TYPE_CUTOFF</span> <span class="o">=</span> <span class="mi">20000</span>

<span class="n">_PREALLOC_NAME</span> <span class="o">=</span> <span class="s1">&#39;PreAllocatedResources&#39;</span>


<div class="viewcode-block" id="AbstractSpinnakerBase"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase">[docs]</a><span class="k">class</span> <span class="nc">AbstractSpinnakerBase</span><span class="p">(</span><span class="n">ConfigHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Main interface into the tools logic flow.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=broad-except</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># the object that contains a set of file paths, which should encompass</span>
        <span class="c1"># all locations where binaries are for this simulation.</span>
        <span class="s2">&quot;_executable_finder&quot;</span><span class="p">,</span>

        <span class="c1"># the number of chips required for this simulation to run, mainly tied</span>
        <span class="c1"># to the spalloc system</span>
        <span class="s2">&quot;_n_chips_required&quot;</span><span class="p">,</span>

        <span class="c1"># the number of boards required for this simulation to run, mainly tied</span>
        <span class="c1"># to the spalloc system</span>
        <span class="s2">&quot;_n_boards_required&quot;</span><span class="p">,</span>

        <span class="c1"># The IP-address of the SpiNNaker machine</span>
        <span class="s2">&quot;_hostname&quot;</span><span class="p">,</span>

        <span class="c1"># the ip_address of the spalloc server</span>
        <span class="s2">&quot;_spalloc_server&quot;</span><span class="p">,</span>

        <span class="c1"># the URL for the HBP platform interface</span>
        <span class="s2">&quot;_remote_spinnaker_url&quot;</span><span class="p">,</span>

        <span class="c1"># the algorithm used for allocating machines from the HBP platform</span>
        <span class="c1">#  interface</span>
        <span class="s2">&quot;_machine_allocation_controller&quot;</span><span class="p">,</span>

        <span class="c1"># the human readable label for the application graph.</span>
        <span class="s2">&quot;_graph_label&quot;</span><span class="p">,</span>

        <span class="c1"># the pacman application graph, used to hold vertices which need to be</span>
        <span class="c1"># split to core sizes</span>
        <span class="s2">&quot;_application_graph&quot;</span><span class="p">,</span>

        <span class="c1"># the end user application graph, used to hold vertices which need to</span>
        <span class="c1"># be split to core sizes</span>
        <span class="s2">&quot;_original_application_graph&quot;</span><span class="p">,</span>

        <span class="c1"># the pacman machine graph, used to hold vertices which represent cores</span>
        <span class="s2">&quot;_machine_graph&quot;</span><span class="p">,</span>

        <span class="c1"># the end user pacman machine graph, used to hold vertices which</span>
        <span class="c1"># represent cores.</span>
        <span class="s2">&quot;_original_machine_graph&quot;</span><span class="p">,</span>

        <span class="c1"># boolean for empty graphs</span>
        <span class="s2">&quot;_empty_graphs&quot;</span><span class="p">,</span>

        <span class="c1"># The holder for where machine graph vertices are placed.</span>
        <span class="s2">&quot;_placements&quot;</span><span class="p">,</span>

        <span class="c1"># The holder for the routing table entries for all used routers in this</span>
        <span class="c1"># simulation</span>
        <span class="s2">&quot;_router_tables&quot;</span><span class="p">,</span>

        <span class="c1"># the holder for the keys used by the machine vertices for</span>
        <span class="c1"># communication</span>
        <span class="s2">&quot;_routing_infos&quot;</span><span class="p">,</span>

        <span class="c1"># the holder for the fixed routes generated, if there are any</span>
        <span class="s2">&quot;_fixed_routes&quot;</span><span class="p">,</span>

        <span class="c1"># The holder for the IP tags and reverse IP tags used by the simulation</span>
        <span class="s2">&quot;_tags&quot;</span><span class="p">,</span>

        <span class="c1"># The python representation of the SpiNNaker machine that this</span>
        <span class="c1"># simulation is going to run on</span>
        <span class="s2">&quot;_machine&quot;</span><span class="p">,</span>

        <span class="c1"># The SpiNNMan interface instance.</span>
        <span class="s2">&quot;_txrx&quot;</span><span class="p">,</span>

        <span class="c1"># The manager of streaming buffered data in and out of the SpiNNaker</span>
        <span class="c1"># machine</span>
        <span class="s2">&quot;_buffer_manager&quot;</span><span class="p">,</span>

        <span class="c1"># Handler for keep all the calls to Java in a single space.</span>
        <span class="c1"># May be null is configs request not to use Java</span>
        <span class="s2">&quot;_java_caller&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_ip_address&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_machine_outputs&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_machine_tokens&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_mapping_outputs&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_mapping_tokens&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_load_outputs&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_load_tokens&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_last_run_outputs&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_last_run_tokens&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_pacman_provenance&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_xml_paths&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_extra_mapping_algorithms&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_extra_mapping_inputs&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_extra_inputs&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_extra_pre_run_algorithms&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_extra_post_run_algorithms&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_extra_load_algorithms&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_dsg_algorithm&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_none_labelled_edge_count&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_database_socket_addresses&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_database_interface&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_create_database&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_has_ran&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_status&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_state_condition&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_has_reset_last&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_current_run_timesteps&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_no_sync_changes&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_max_run_time_steps&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_no_machine_time_steps&quot;</span><span class="p">,</span>

        <span class="c1"># The lowest values auto pause resume may use as steps</span>
        <span class="s2">&quot;_minimum_auto_time_steps&quot;</span><span class="p">,</span>

        <span class="c1"># Set when run_until_complete is specified by the user</span>
        <span class="s2">&quot;_run_until_complete&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_app_id&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_do_timings&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_print_timings&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_raise_keyboard_interrupt&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_n_calls_to_run&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_command_sender&quot;</span><span class="p">,</span>

        <span class="c1"># iobuf cores</span>
        <span class="s2">&quot;_cores_to_read_iobuf&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_executable_types&quot;</span><span class="p">,</span>

        <span class="c1"># mapping between parameters and the vertices which need to talk to</span>
        <span class="c1"># them</span>
        <span class="s2">&quot;_live_packet_recorder_params&quot;</span><span class="p">,</span>

        <span class="c1"># place holder for checking the vertices being added to the recorders</span>
        <span class="c1"># tracker are all of the same vertex type.</span>
        <span class="s2">&quot;_live_packet_recorders_associated_vertex_type&quot;</span><span class="p">,</span>

        <span class="c1"># the time the process takes to do mapping</span>
        <span class="s2">&quot;_mapping_time&quot;</span><span class="p">,</span>

        <span class="c1"># the time the process takes to do load</span>
        <span class="s2">&quot;_load_time&quot;</span><span class="p">,</span>

        <span class="c1"># the time takes to execute the simulation</span>
        <span class="s2">&quot;_execute_time&quot;</span><span class="p">,</span>
        <span class="c1"># the timer used to log the execute time</span>
        <span class="s2">&quot;_run_timer&quot;</span><span class="p">,</span>

        <span class="c1"># time takes to do data generation</span>
        <span class="s2">&quot;_dsg_time&quot;</span><span class="p">,</span>

        <span class="c1"># time taken by the front end extracting things</span>
        <span class="s2">&quot;_extraction_time&quot;</span><span class="p">,</span>

        <span class="s2">&quot;_last_except_hook&quot;</span><span class="p">,</span>

        <span class="s2">&quot;_vertices_or_edges_added&quot;</span><span class="p">,</span>

    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">executable_finder</span><span class="p">,</span> <span class="n">graph_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">database_socket_addresses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_algorithm_xml_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">n_chips_required</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_boards_required</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">front_end_versions</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param executable_finder: How to find APLX files to deploy to SpiNNaker</span>
<span class="sd">        :type executable_finder:</span>
<span class="sd">            ~spinn_utilities.executable_finder.ExecutableFinder</span>
<span class="sd">        :param str graph_label: A label for the overall application graph</span>
<span class="sd">        :param database_socket_addresses: How to talk to notification databases</span>
<span class="sd">        :type database_socket_addresses:</span>
<span class="sd">            iterable(~spinn_utilities.socket_address.SocketAddress) or None</span>
<span class="sd">        :param iterable(str) extra_algorithm_xml_paths:</span>
<span class="sd">            Where to load definitions of extra algorithms from</span>
<span class="sd">        :param int n_chips_required:</span>
<span class="sd">            Overrides the number of chips to allocate from spalloc</span>
<span class="sd">        :param int n_boards_required:</span>
<span class="sd">            Overrides the number of boards to allocate from spalloc</span>
<span class="sd">        :param list(tuple(str,str)) front_end_versions:</span>
<span class="sd">            Information about what software is in use</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># timings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extraction_time</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span> <span class="o">=</span> <span class="n">executable_finder</span>

        <span class="c1"># output locations of binaries to be searched for end user info</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Will search these locations for binaries: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="o">.</span><span class="n">binary_paths</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n_chips_required</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">n_boards_required</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span> <span class="o">=</span> <span class="n">n_chips_required</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span> <span class="o">=</span> <span class="n">n_boards_required</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Please use at most one of n_chips_required or &quot;</span>
                <span class="s2">&quot;n_boards_required&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># command sender vertex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command_sender</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># store for Live Packet Gatherers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># update graph label if needed</span>
        <span class="k">if</span> <span class="n">graph_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_label</span> <span class="o">=</span> <span class="s2">&quot;Application_graph&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graph_label</span> <span class="o">=</span> <span class="n">graph_label</span>

        <span class="c1"># pacman objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span> <span class="o">=</span> <span class="n">ApplicationGraph</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span> <span class="o">=</span> <span class="n">MachineGraph</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_label</span><span class="p">,</span>
            <span class="n">application_graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_empty_graphs</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_routes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># pacman executor objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_outputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_tokens</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_tokens</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_outputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_tokens</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_tokens</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pacman_provenance</span> <span class="o">=</span> <span class="n">PacmanProvenanceExtractor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xml_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_xml_paths</span><span class="p">(</span><span class="n">extra_algorithm_xml_paths</span><span class="p">)</span>

        <span class="c1"># extra algorithms and inputs for runs, should disappear in future</span>
        <span class="c1">#  releases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_mapping_algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_mapping_inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_pre_run_algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_post_run_algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_load_algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_algorithm</span> <span class="o">=</span> <span class="s2">&quot;GraphDataSpecificationWriter&quot;</span>

        <span class="c1"># vertex label safety (used by reports mainly)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_none_labelled_edge_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># database objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database_socket_addresses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">database_socket_addresses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_database_socket_addresses</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">database_socket_addresses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database_interface</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_database</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># holder for timing and running related values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_machine_time_steps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_auto_time_steps</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
                <span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum_auto_time_steps&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;app_id&quot;</span><span class="p">)</span>

        <span class="c1"># folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pacman_executor_provenance_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_up_output_folders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span><span class="p">)</span>

        <span class="c1"># timing provenance elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_timings</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_algorithm_timings&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_timings</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;display_algorithm_timings&quot;</span><span class="p">)</span>

        <span class="c1"># Setup for signal handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_keyboard_interrupt</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">globals_variables</span><span class="o">.</span><span class="n">set_simulator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_version_provenance</span><span class="p">(</span><span class="n">front_end_versions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_last_except_hook</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.set_n_boards_required"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.set_n_boards_required">[docs]</a>    <span class="k">def</span> <span class="nf">set_n_boards_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_boards_required</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the machine requirements.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method should not be called after the machine</span>
<span class="sd">            requirements have be computed based on the graph.</span>

<span class="sd">        :param int n_boards_required: The number of boards required</span>
<span class="sd">        :raises: ConfigurationException</span>
<span class="sd">            If any machine requirements have already been set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Catch the unchanged case including leaving it None</span>
        <span class="k">if</span> <span class="n">n_boards_required</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Illegal attempt to change previously set value.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Clash with n_chips_required.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span> <span class="o">=</span> <span class="n">n_boards_required</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.update_extra_mapping_inputs"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.update_extra_mapping_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">update_extra_mapping_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_mapping_inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Supply extra inputs to the mapping algorithms. Mappings are from\</span>
<span class="sd">            known names (the logical type names) to the values to bind to them.</span>

<span class="sd">        :param dict(str,any) extra_inputs: The additional inputs to provide</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ran</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Changing mapping inputs is not supported after run&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extra_mapping_inputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_mapping_inputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_mapping_inputs</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.update_extra_inputs"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.update_extra_inputs">[docs]</a>    <span class="k">def</span> <span class="nf">update_extra_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_inputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Supply extra inputs to the runtime algorithms. Mappings are from\</span>
<span class="sd">            known names (the logical type names) to the values to bind to them.</span>

<span class="sd">        :param dict(str,any) extra_inputs: The additional inputs to provide</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ran</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Changing inputs is not supported after run&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extra_inputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_inputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">extra_inputs</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.extend_extra_mapping_algorithms"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.extend_extra_mapping_algorithms">[docs]</a>    <span class="k">def</span> <span class="nf">extend_extra_mapping_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_mapping_algorithms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add custom mapping algorithms to the end of the sequence of \</span>
<span class="sd">            mapping algorithms to be run.</span>

<span class="sd">        :param list(str) extra_mapping_algorithms: Algorithms to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ran</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Changing algorithms is not supported after run&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extra_mapping_algorithms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_mapping_algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_mapping_algorithms</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.prepend_extra_pre_run_algorithms"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.prepend_extra_pre_run_algorithms">[docs]</a>    <span class="k">def</span> <span class="nf">prepend_extra_pre_run_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_pre_run_algorithms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add custom pre-execution algorithms to the front of the sequence \</span>
<span class="sd">            of algorithms to be run.</span>

<span class="sd">        :param list(str) extra_pre_run_algorithms: Algorithms to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ran</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Changing algorithms is not supported after run&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extra_pre_run_algorithms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_pre_run_algorithms</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">extra_pre_run_algorithms</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.extend_extra_post_run_algorithms"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.extend_extra_post_run_algorithms">[docs]</a>    <span class="k">def</span> <span class="nf">extend_extra_post_run_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_post_run_algorithms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add custom post-execution algorithms to the sequence of \</span>
<span class="sd">            such algorithms to be run.</span>

<span class="sd">        :param list(str) extra_post_run_algorithms: Algorithms to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ran</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Changing algorithms is not supported after run&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extra_post_run_algorithms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_post_run_algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_post_run_algorithms</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.extend_extra_load_algorithms"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.extend_extra_load_algorithms">[docs]</a>    <span class="k">def</span> <span class="nf">extend_extra_load_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_load_algorithms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add custom data-loading algorithms to the sequence of \</span>
<span class="sd">            such algorithms to be run.</span>

<span class="sd">        :param list(str) extra_load_algorithms: Algorithms to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ran</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Changing algorithms is not supported after run&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extra_load_algorithms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extra_load_algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_load_algorithms</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_extraction_timing"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_extraction_timing">[docs]</a>    <span class="k">def</span> <span class="nf">add_extraction_timing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timing</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Record the time taken for doing data extraction.</span>

<span class="sd">        :param ~datetime.timedelta timing:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="n">convert_time_diff_to_total_milliseconds</span><span class="p">(</span><span class="n">timing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extraction_time</span> <span class="o">+=</span> <span class="n">ms</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_live_packet_gatherer_parameters"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_live_packet_gatherer_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">add_live_packet_gatherer_parameters</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">live_packet_gatherer_params</span><span class="p">,</span> <span class="n">vertex_to_record_from</span><span class="p">,</span>
            <span class="n">partition_ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds parameters for a new LPG if needed, or adds to the tracker \</span>
<span class="sd">            for parameters. Note that LPGs can be inserted to track behaviour \</span>
<span class="sd">            either at the application graph level or at the machine graph \</span>
<span class="sd">            level, but not both at the same time.</span>

<span class="sd">        :param LivePacketGatherParameters live_packet_gatherer_params:</span>
<span class="sd">            params to look for a LPG</span>
<span class="sd">        :param ~pacman.model.graphs.AbstractVertex vertex_to_record_from:</span>
<span class="sd">            the vertex that needs to send to a given LPG</span>
<span class="sd">        :param list(str) partition_ids:</span>
<span class="sd">            the IDs of the partitions to connect from the vertex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">[</span><span class="n">live_packet_gatherer_params</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">vertex_to_record_from</span><span class="p">,</span> <span class="n">partition_ids</span><span class="p">))</span>

        <span class="c1"># verify that the vertices being added are of one vertex type.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex_to_record_from</span><span class="p">,</span> <span class="n">ApplicationVertex</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span> <span class="o">=</span> \
                    <span class="n">ApplicationVertex</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span> <span class="o">=</span> \
                    <span class="n">MachineVertex</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">vertex_to_record_from</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Only one type of graph can be used during live output. &quot;</span>
                <span class="s2">&quot;Please fix and try again&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.set_up_machine_specifics"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.set_up_machine_specifics">[docs]</a>    <span class="k">def</span> <span class="nf">set_up_machine_specifics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds machine specifics for the different modes of execution.</span>

<span class="sd">        :param str hostname: machine name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hostname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="o">=</span> <span class="n">hostname</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The machine name from setup call is overriding &quot;</span>
                           <span class="s2">&quot;the machine name defined in the config file&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;machine_name&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;spalloc_server&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;remote_spinnaker_url&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;A SpiNNaker machine must be specified your configuration&quot;</span>
                <span class="s2">&quot; file&quot;</span><span class="p">)</span>

        <span class="n">n_items_specified</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">n_items_specified</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">n_items_specified</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Only one of machineName, spalloc_server, &quot;</span>
                <span class="s2">&quot;remote_spinnaker_url and virtual_board should be specified &quot;</span>
                <span class="s2">&quot;in your configuration files&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;spalloc_user&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;A spalloc_user must be specified with a spalloc_server&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__signal_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_signal</span><span class="p">,</span> <span class="n">_frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handles closing down of script via keyboard interrupt</span>

<span class="sd">        :param _signal: the signal received (ignored)</span>
<span class="sd">        :param _frame: frame executed in (ignored)</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If we are to raise the keyboard interrupt, do so</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raise_keyboard_interrupt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User has cancelled simulation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.exception_handler"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.exception_handler">[docs]</a>    <span class="k">def</span> <span class="nf">exception_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handler of exceptions</span>

<span class="sd">        :param type exctype: the type of exception received</span>
<span class="sd">        :param Exception value: the value of the exception</span>
<span class="sd">        :param traceback traceback_obj: the trace back stuff</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Shutdown on exception&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_except_hook</span><span class="p">(</span><span class="n">exctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback_obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.verify_not_running"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.verify_not_running">[docs]</a>    <span class="k">def</span> <span class="nf">verify_not_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Verify that the simulator is in a state where it can start running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">in</span> <span class="n">RUNNING_STATUS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Illegal call while a simulation is already running&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">in</span> <span class="n">SHUTDOWN_STATUS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Illegal call after simulation is shutdown&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_should_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the simulation should run.</span>

<span class="sd">        Will warn the user if there is no need to run</span>

<span class="sd">        :return: True if and only if one of the graphs has vertices in it</span>
<span class="sd">        :raises ConfigurationException: If the current state does not</span>
<span class="sd">            support a new run call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_not_running</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Your graph has no vertices in it. &quot;</span>
            <span class="s2">&quot;Therefor the run call will exit immediately.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.run_until_complete"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.run_until_complete">[docs]</a>    <span class="k">def</span> <span class="nf">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Run a simulation until it completes</span>

<span class="sd">        :param int n_steps:</span>
<span class="sd">            If not None, this specifies that the simulation should be</span>
<span class="sd">            requested to run for the given number of steps.  The host will</span>
<span class="sd">            still wait until the simulation itself says it has completed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">sync_time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.run"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">,</span> <span class="n">sync_time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Run a simulation for a fixed amount of time</span>

<span class="sd">        :param int run_time: the run duration in milliseconds.</span>
<span class="sd">        :param float sync_time:</span>
<span class="sd">            If not 0, this specifies that the simulation should pause after</span>
<span class="sd">            this duration.  The continue_simulation() method must then be</span>
<span class="sd">            called for the simulation to continue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">run_time</span><span class="p">,</span> <span class="n">sync_time</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_build_graphs_for_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;Illegal state where both original_application and &quot;</span>
                    <span class="s2">&quot;original machine graph have vertices in them&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_in_ms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get a number of timesteps for a given time in milliseconds.</span>

<span class="sd">        :return: The number of timesteps</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_time_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">time_in_ms</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span><span class="p">))</span>
        <span class="n">calc_time</span> <span class="o">=</span> <span class="n">n_time_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span>

        <span class="c1"># Allow for minor float errors</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">time_in_ms</span> <span class="o">-</span> <span class="n">calc_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.00001</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Time of </span><span class="si">{}</span><span class="s2">ms &quot;</span>
                <span class="s2">&quot;is not a multiple of the machine time step of </span><span class="si">{}</span><span class="s2">ms &quot;</span>
                <span class="s2">&quot;and has therefore been rounded up to </span><span class="si">{}</span><span class="s2">ms&quot;</span><span class="p">,</span>
                <span class="n">time_in_ms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span><span class="p">,</span> <span class="n">calc_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n_time_steps</span>

    <span class="k">def</span> <span class="nf">_calc_run_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates n_machine_time_steps and total_run_time based on run_time\</span>
<span class="sd">        and machine_time_step</span>

<span class="sd">        This method rounds the run up to the next timestep as discussed in\</span>
<span class="sd">        https://github.com/SpiNNakerManchester/sPyNNaker/issues/149</span>

<span class="sd">        If run_time is None (run forever) both values will be None</span>

<span class="sd">        :param run_time: time user requested to run for in milliseconds</span>
<span class="sd">        :type run_time: float or None</span>
<span class="sd">        :return: n_machine_time_steps as a whole int and</span>
<span class="sd">            total_run_time in milliseconds</span>
<span class="sd">        :rtype: tuple(int,float) or tuple(None,None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">run_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">n_machine_time_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timesteps</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>
        <span class="n">total_run_timesteps</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">+</span> <span class="n">n_machine_time_steps</span><span class="p">)</span>
        <span class="n">total_run_time</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">total_run_timesteps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span> <span class="o">*</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_scale_factor</span><span class="p">)</span>

        <span class="c1"># Convert dt into microseconds and multiply by</span>
        <span class="c1"># scale factor to get hardware timestep</span>
        <span class="n">hardware_timestep_us</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_scale_factor</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Simulating for </span><span class="si">{</span><span class="n">n_machine_time_steps</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span><span class="si">}</span><span class="s2">ms timesteps using a &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;hardware timestep of </span><span class="si">{</span><span class="n">hardware_timestep_us</span><span class="si">}</span><span class="s2">us&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">,</span> <span class="n">sync_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The main internal run function.</span>

<span class="sd">        :param int run_time: the run duration in milliseconds.</span>
<span class="sd">        :param int sync_time:</span>
<span class="sd">            the time in ms between synchronisations, or 0 to disable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_run</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="c1"># verify that we can keep doing auto pause and resume</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">can_keep_running</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">executable_type</span><span class="o">.</span><span class="n">supports_auto_pause_and_resume</span>
                <span class="k">for</span> <span class="n">executable_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">can_keep_running</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Only binaries that use the simulation interface can be&quot;</span>
                    <span class="s2">&quot; run more than once&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">IN_RUN</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_config</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>

        <span class="c1"># Install the Control-C handler</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">(),</span> <span class="n">threading</span><span class="o">.</span><span class="n">_MainThread</span><span class="p">):</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__signal_handler</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_keyboard_interrupt</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_except_hook</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting execution process&quot;</span><span class="p">)</span>

        <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_run_time</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span><span class="o">.</span><span class="n">extend_allocation</span><span class="p">(</span>
                <span class="n">total_run_time</span><span class="p">)</span>

        <span class="n">n_sync_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timesteps</span><span class="p">(</span><span class="n">sync_time</span><span class="p">)</span>

        <span class="c1"># If we have never run before, or the graph has changed,</span>
        <span class="c1"># start by performing mapping</span>
        <span class="n">graph_changed</span><span class="p">,</span> <span class="n">data_changed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_if_graph_has_changed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">graph_changed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;The network cannot be changed between runs without&quot;</span>
                <span class="s2">&quot; resetting&quot;</span><span class="p">)</span>

        <span class="c1"># If we have reset and the graph has changed, stop any running</span>
        <span class="c1"># application</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">graph_changed</span> <span class="ow">or</span> <span class="n">data_changed</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">stop_application</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>

            <span class="c1"># change number of resets as loading the binary again resets the</span>
            <span class="c1"># sync to 0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># build the graphs to modify with system requirements</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">or</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
                <span class="c1"># create new sub-folder for reporting data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_up_output_folders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_build_graphs_for_usage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_dependent_verts_and_edges_for_application_graph</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_commands_to_command_sender</span><span class="p">()</span>

            <span class="c1"># Reset the machine if the graph has changed</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                <span class="c1"># wipe out stuff associated with a given machine, as these need</span>
                <span class="c1"># to be rebuilt.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_machine</span><span class="p">(</span><span class="n">total_run_time</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_mapping</span><span class="p">(</span><span class="n">run_time</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>

        <span class="c1"># Check if anything has per-timestep SDRAM usage</span>
        <span class="n">provide_injectables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span><span class="p">)</span>
        <span class="n">is_per_timestep_sdram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_per_timestep_sdram</span><span class="p">()</span>

        <span class="c1"># Disable auto pause and resume if the binary can&#39;t do it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">executable_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">executable_type</span><span class="o">.</span><span class="n">supports_auto_pause_and_resume</span><span class="p">:</span>
                    <span class="n">set_config</span><span class="p">(</span>
                        <span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;use_auto_pause_and_resume&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>

        <span class="c1"># Work out the maximum run duration given all recordings</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deduce_data_n_timesteps</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">)</span>
        <span class="n">clear_injectables</span><span class="p">()</span>

        <span class="c1"># Work out an array of timesteps to perform</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;use_auto_pause_and_resume&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_per_timestep_sdram</span><span class="p">):</span>

            <span class="c1"># Runs should only be in units of max_run_time_steps at most</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">is_per_timestep_sdram</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="o">&lt;</span> <span class="n">n_machine_time_steps</span> <span class="ow">or</span>
                        <span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">FINISHED</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;The SDRAM required by one or more vertices is based on&quot;</span>
                    <span class="s2">&quot; the run time, so the run time is limited to&quot;</span>
                    <span class="s2">&quot; </span><span class="si">{}</span><span class="s2"> time steps&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">))</span>

            <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_machine_time_steps</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">run_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># With auto pause and resume, any time step is possible but run</span>
            <span class="c1"># time more than the first will guarantee that run will be called</span>
            <span class="c1"># more than once</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_steps</span><span class="p">(</span>
                <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">)</span>

        <span class="c1"># If we have never run before, or the graph has changed, or data has</span>
        <span class="c1"># been changed, generate and load the data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">or</span> <span class="n">graph_changed</span> <span class="ow">or</span> <span class="n">data_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_data_generation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">)</span>

            <span class="c1"># If we are using a virtual board, don&#39;t load</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_load</span><span class="p">(</span><span class="n">graph_changed</span><span class="p">,</span> <span class="n">data_changed</span><span class="p">)</span>

        <span class="c1"># Run for each of the given steps</span>
        <span class="k">if</span> <span class="n">run_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running for </span><span class="si">{}</span><span class="s2"> steps for a total of </span><span class="si">{}</span><span class="s2">ms&quot;</span><span class="p">,</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">),</span> <span class="n">run_time</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">run_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running until complete&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;use_auto_pause_and_resume&quot;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="ow">not</span> <span class="n">is_per_timestep_sdram</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running forever&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for stop request&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">!=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">STOP_REQUESTED</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running forever in steps of </span><span class="si">{}</span><span class="s2">ms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">!=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">STOP_REQUESTED</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Indicate that the signal handler needs to act</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">(),</span> <span class="n">threading</span><span class="o">.</span><span class="n">_MainThread</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_keyboard_interrupt</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_except_hook</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception_handler</span>

        <span class="c1"># update counter for runs (used by reports and app data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">FINISHED</span>

    <span class="k">def</span> <span class="nf">_is_per_timestep_sdram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="o">.</span><span class="n">placements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">placement</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">resources_required</span><span class="o">.</span><span class="n">sdram</span><span class="o">.</span><span class="n">per_timestep</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_add_commands_to_command_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">vertices</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span>
        <span class="n">command_sender_vertex</span> <span class="o">=</span> <span class="n">CommandSender</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="o">.</span><span class="n">vertices</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span>
            <span class="n">command_sender_vertex</span> <span class="o">=</span> <span class="n">CommandSenderMachineVertex</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">AbstractSendMeMulticastCommandsVertex</span><span class="p">):</span>
                <span class="c1"># if there&#39;s no command sender yet, build one</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_sender</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_command_sender</span> <span class="o">=</span> <span class="n">command_sender_vertex</span><span class="p">(</span>
                        <span class="s2">&quot;auto_added_command_sender&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_command_sender</span><span class="p">)</span>

                <span class="c1"># allow the command sender to create key to partition map</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_command_sender</span><span class="o">.</span><span class="n">add_commands</span><span class="p">(</span>
                    <span class="n">vertex</span><span class="o">.</span><span class="n">start_resume_commands</span><span class="p">,</span>
                    <span class="n">vertex</span><span class="o">.</span><span class="n">pause_stop_commands</span><span class="p">,</span>
                    <span class="n">vertex</span><span class="o">.</span><span class="n">timed_commands</span><span class="p">,</span> <span class="n">vertex</span><span class="p">)</span>

        <span class="c1"># add the edges from the command sender to the dependent vertices</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_sender</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edges</span><span class="p">,</span> <span class="n">partition_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command_sender</span><span class="o">.</span><span class="n">edges_and_partitions</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">partition_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">partition_ids</span><span class="p">):</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">partition_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_dependent_verts_and_edges_for_application_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
            <span class="c1"># add any dependent edges and vertices if needed</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">AbstractVertexWithEdgeToDependentVertices</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">dependant_vertex</span> <span class="ow">in</span> <span class="n">vertex</span><span class="o">.</span><span class="n">dependent_vertices</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">dependant_vertex</span><span class="p">)</span>
                    <span class="n">edge_partition_ids</span> <span class="o">=</span> <span class="n">vertex</span><span class="o">.</span>\
                        <span class="n">edge_partition_identifiers_for_dependent_vertex</span><span class="p">(</span>
                            <span class="n">dependant_vertex</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">edge_identifier</span> <span class="ow">in</span> <span class="n">edge_partition_ids</span><span class="p">:</span>
                        <span class="n">dependant_edge</span> <span class="o">=</span> <span class="n">ApplicationEdge</span><span class="p">(</span>
                            <span class="n">pre_vertex</span><span class="o">=</span><span class="n">vertex</span><span class="p">,</span> <span class="n">post_vertex</span><span class="o">=</span><span class="n">dependant_vertex</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                            <span class="n">dependant_edge</span><span class="p">,</span> <span class="n">edge_identifier</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deduce_data_n_timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine_graph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Operates the auto pause and resume functionality by figuring out\</span>
<span class="sd">            how many timer ticks a simulation can run before SDRAM runs out,\</span>
<span class="sd">            and breaks simulation into chunks of that long.</span>

<span class="sd">        :param ~.MachineGraph machine_graph:</span>
<span class="sd">        :return: max time a simulation can run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Go through the placements and find how much SDRAM is used</span>
        <span class="c1"># on each chip</span>
        <span class="n">usage_by_chip</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">seen_partitions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="o">.</span><span class="n">placements</span><span class="p">:</span>
            <span class="n">sdram_required</span> <span class="o">=</span> <span class="n">placement</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">resources_required</span><span class="o">.</span><span class="n">sdram</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">placement</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">placement</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">usage_by_chip</span><span class="p">:</span>
                <span class="n">usage_by_chip</span><span class="p">[</span><span class="n">placement</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">placement</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sdram_required</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">usage_by_chip</span><span class="p">[</span><span class="n">placement</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">placement</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">sdram_required</span>

            <span class="c1"># add sdram partitions</span>
            <span class="n">sdram_partitions</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">machine_graph</span><span class="o">.</span><span class="n">get_sdram_edge_partitions_starting_at_vertex</span><span class="p">(</span>
                    <span class="n">placement</span><span class="o">.</span><span class="n">vertex</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">sdram_partitions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">partition</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_partitions</span><span class="p">:</span>
                    <span class="n">usage_by_chip</span><span class="p">[</span><span class="n">placement</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">placement</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="n">ConstantSDRAM</span><span class="p">(</span>
                            <span class="n">partition</span><span class="o">.</span><span class="n">total_sdram_requirements</span><span class="p">()</span> <span class="o">+</span>
                            <span class="n">SARK_PER_MALLOC_SDRAM_USAGE</span><span class="p">))</span>
                    <span class="n">seen_partitions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>

        <span class="c1"># Go through the chips and divide up the remaining SDRAM, finding</span>
        <span class="c1"># the minimum number of machine timesteps to assign</span>
        <span class="n">max_time_steps</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">sdram</span> <span class="ow">in</span> <span class="n">usage_by_chip</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">get_chip_at</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">sdram</span><span class="o">.</span><span class="n">size</span>
            <span class="k">if</span> <span class="n">sdram</span><span class="o">.</span><span class="n">per_timestep</span><span class="p">:</span>
                <span class="n">max_this_chip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">size</span> <span class="o">-</span> <span class="n">sdram</span><span class="o">.</span><span class="n">fixed</span><span class="p">)</span> <span class="o">//</span> <span class="n">sdram</span><span class="o">.</span><span class="n">per_timestep</span><span class="p">)</span>
                <span class="n">max_time_steps</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_time_steps</span><span class="p">,</span> <span class="n">max_this_chip</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">max_time_steps</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_generate_steps</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">n_steps_per_segment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generates the list of &quot;timer&quot; runs. These are usually in terms of\</span>
<span class="sd">            time steps, but need not be.</span>

<span class="sd">        :param int n_steps: the total runtime in machine time steps</span>
<span class="sd">        :param int n_steps_per_segment: the minimum allowed per chunk</span>
<span class="sd">        :return: list of time step lengths</span>
<span class="sd">        :rtype: list(int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n_full_iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n_steps</span> <span class="o">/</span> <span class="n">n_steps_per_segment</span><span class="p">))</span>
        <span class="n">left_over_steps</span> <span class="o">=</span> <span class="n">n_steps</span> <span class="o">-</span> <span class="n">n_full_iterations</span> <span class="o">*</span> <span class="n">n_steps_per_segment</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_steps_per_segment</span><span class="p">)]</span> <span class="o">*</span> <span class="n">n_full_iterations</span>
        <span class="k">if</span> <span class="n">left_over_steps</span><span class="p">:</span>
            <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_over_steps</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">steps</span>

    <span class="k">def</span> <span class="nf">_calculate_number_of_machine_time_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_run_timesteps</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">next_run_timesteps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">total_timesteps</span> <span class="o">=</span> <span class="n">next_run_timesteps</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_no_machine_time_steps</span> <span class="o">=</span> <span class="n">total_timesteps</span>
            <span class="k">return</span> <span class="n">total_timesteps</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_no_machine_time_steps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_run_algorithms</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="n">required_tokens</span><span class="p">,</span>
            <span class="n">provenance_name</span><span class="p">,</span> <span class="n">optional_algorithms</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Runs getting a SpiNNaker machine logic</span>

<span class="sd">        :param dict(str,any) inputs: the inputs</span>
<span class="sd">        :param list(str) algorithms: algorithms to call</span>
<span class="sd">        :param list(str) outputs: outputs to get</span>
<span class="sd">        :param list(str) tokens: The tokens to start with</span>
<span class="sd">        :param list(str) required_tokens: The tokens that must be generated</span>
<span class="sd">        :param str provenance_name: the name for provenance</span>
<span class="sd">        :param list(str) optional_algorithms: optional algorithms to use</span>
<span class="sd">        :return: the executor that did the running of the algorithms</span>
<span class="sd">        :rtype: ~.PACMANAlgorithmExecutor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="n">optional</span> <span class="o">=</span> <span class="n">optional_algorithms</span>
        <span class="k">if</span> <span class="n">optional</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">optional</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Execute the algorithms</span>
        <span class="n">executor</span> <span class="o">=</span> <span class="n">PACMANAlgorithmExecutor</span><span class="p">(</span>
            <span class="n">algorithms</span><span class="o">=</span><span class="n">algorithms</span><span class="p">,</span> <span class="n">optional_algorithms</span><span class="o">=</span><span class="n">optional</span><span class="p">,</span>
            <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">tokens</span><span class="o">=</span><span class="n">tokens</span><span class="p">,</span>
            <span class="n">required_output_tokens</span><span class="o">=</span><span class="n">required_tokens</span><span class="p">,</span> <span class="n">xml_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_paths</span><span class="p">,</span>
            <span class="n">required_outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">do_timings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_timings</span><span class="p">,</span>
            <span class="n">print_timings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_timings</span><span class="p">,</span>
            <span class="n">provenance_name</span><span class="o">=</span><span class="n">provenance_name</span><span class="p">,</span>
            <span class="n">provenance_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pacman_executor_provenance_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">execute_mapping</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pacman_provenance</span><span class="o">.</span><span class="n">extract_provenance</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">executor</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;Transceiver&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span>
                <span class="s2">&quot;MachineAllocationController&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">TagsFromMachineReport</span><span class="p">()(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e2</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;problem with TagsFromMachineReport </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e2</span><span class="p">),</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e3</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;problem when shutting down </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e3</span><span class="p">),</span>
                               <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_errored_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_finished_file</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">_get_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_run_time</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param float total_run_time:</span>
<span class="sd">        :param n_machine_time_steps:</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :rtype: ~spinn_machine.Machine</span>
<span class="sd">        :raises ConfigurationException:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span>

        <span class="c1"># If we are using a directly connected machine, add the details to get</span>
        <span class="c1"># the machine and transceiver</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_by_hostname</span><span class="p">(</span><span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_by_virtual</span><span class="p">(</span><span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># must be remote due to set_up_machine_specifics()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_by_remote</span><span class="p">(</span><span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="o">=</span> <span class="n">ALANS_DEFAULT_RANDOM_APP_ID</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">app_id_tracker</span><span class="o">.</span><span class="n">get_new_id</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">n_chips</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;Failure to detect machine of with </span><span class="si">{}</span><span class="s2"> chips as requested. &quot;</span>
                    <span class="s2">&quot;Only found </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">ethernet_connected_chips</span><span class="p">)</span> \
                    <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;Failure to detect machine with </span><span class="si">{}</span><span class="s2"> boards as requested. &quot;</span>
                    <span class="s2">&quot;Only found </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span>

    <span class="k">def</span> <span class="nf">_machine_by_hostname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param n_machine_time_steps:</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :param float total_run_time:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_machine_common</span><span class="p">(</span>
            <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;IPAddress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;BMPDetails&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;bmp_names&quot;</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;AutoDetectBMPFlag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;auto_detect_bmp&quot;</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ScampConnectionData&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;scamp_connections_data&quot;</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="n">_PREALLOC_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">PreAllocatedResourceContainer</span><span class="p">()</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MachineGenerator&quot;</span><span class="p">)</span>

        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">)</span>
        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Transceiver&quot;</span><span class="p">)</span>

        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_algorithms</span><span class="p">(</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="s2">&quot;machine_generation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;Transceiver&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_outputs</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_tokens</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_completed_tokens</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_machine_by_virtual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param n_machine_time_steps:</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :param float total_run_time:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_machine_common</span><span class="p">(</span>
            <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;IPAddress&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;virtual&quot;</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;NumberOfBoards&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;number_of_boards&quot;</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;BMPDetails&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;AutoDetectBMPFlag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ScampConnectionData&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">inputs</span><span class="p">[</span><span class="n">_PREALLOC_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">PreAllocatedResourceContainer</span><span class="p">()</span>

        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;VirtualMachineGenerator&quot;</span><span class="p">)</span>

        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">)</span>

        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_algorithms</span><span class="p">(</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="s2">&quot;machine_generation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_outputs</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_tokens</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_completed_tokens</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_machine_by_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets a machine when we know one of `self._spalloc_server` or</span>
<span class="sd">            `self._remote_spinnaker_url` is defined</span>

<span class="sd">        :param n_machine_time_steps:</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :param float total_run_time:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_machine_common</span><span class="p">(</span>
            <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="n">do_partitioning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_by_size</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="n">_PREALLOC_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">PreAllocatedResourceContainer</span><span class="p">()</span>

        <span class="c1"># if using spalloc system</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;SpallocServer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># must be using HBP server system</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RemoteSpinnakerUrl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SpallocAllocator&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;HBPAllocator&quot;</span><span class="p">)</span>

        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MachineGenerator&quot;</span><span class="p">)</span>

        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">)</span>
        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;IPAddress&quot;</span><span class="p">)</span>
        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Transceiver&quot;</span><span class="p">)</span>
        <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MachineAllocationController&quot;</span><span class="p">)</span>

        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_algorithms</span><span class="p">(</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="s2">&quot;machine_generation&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_outputs</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_tokens</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_completed_tokens</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ip_address</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;IPAddress&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;Transceiver&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span>
            <span class="s2">&quot;MachineAllocationController&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">do_partitioning</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;MachineGraph&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_machine_by_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Checks if we can get a remote machine by size of if we have to \</span>
<span class="sd">            use a virtual machine to get the size</span>

<span class="sd">        Adds the required info to inputs, algorithms, outputs</span>

<span class="sd">        :param dict(str,any) inputs: Data to go into executor; will be updated</span>
<span class="sd">        :param list(str) algorithms: Algorithms to execute; will be updated</span>
<span class="sd">        :param list(str) outputs: Data needed after execution; will be updated</span>
<span class="sd">        :return: True if and only if the required steps include partitioning</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If we are using an allocation server but have been told how</span>
        <span class="c1"># many chips to use, just use that as an input</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;NChipsRequired&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;NBoardsRequired&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># only add machine graph is it has vertices.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;MachineGraph&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;GraphMeasurer&quot;</span><span class="p">)</span>
            <span class="n">do_partitioning</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># If we are using an allocation server, and we need a virtual</span>
        <span class="c1"># board, we need to use the virtual board to get the number of</span>
        <span class="c1"># chips to be allocated either by partitioning, or by measuring</span>
        <span class="c1"># the graph</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ApplicationGraph&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_config_str_list</span><span class="p">(</span>
                <span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;application_to_machine_graph_algorithms&quot;</span><span class="p">))</span>
            <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MachineGraph&quot;</span><span class="p">)</span>
            <span class="n">do_partitioning</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Ok we do need a virtual machine</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SpallocMaxMachineGenerator&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;HBPMaxMachineGenerator&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">do_partitioning</span>

    <span class="k">def</span> <span class="nf">_get_machine_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param n_machine_time_steps:</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :param float total_run_time:</span>
<span class="sd">        :return: inputs, algorithms</span>
<span class="sd">        :rtype: tuple(dict(str,any), list(str))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extra_inputs</span><span class="p">)</span>
        <span class="n">algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;use_auto_pause_and_resume&quot;</span><span class="p">):</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PlanNTimeSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum_auto_time_steps</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PlanNTimeSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_machine_time_steps</span>

        <span class="c1"># Set the total run time</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;TotalRunTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_run_time</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;MaxMachineCoreReduction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;max_machine_core_reduction&quot;</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;BoardVersion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ResetMachineOnStartupFlag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;reset_machine_on_startup&quot;</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;BootPortNum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;boot_connection_port_num&quot;</span><span class="p">)</span>

        <span class="c1"># add algorithms for handling LPG placement and edge insertion</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PreAllocateResourcesForLivePacketGatherers&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;LivePacketRecorderParameters&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span>

        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PreAllocateResourcesForChipPowerMonitor&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;MemorySamplingFrequency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
                <span class="s2">&quot;EnergyMonitor&quot;</span><span class="p">,</span> <span class="s2">&quot;sampling_frequency&quot;</span><span class="p">)</span>

        <span class="c1"># add algorithms for handling extra monitor code</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">)):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PreAllocateResourcesForExtraMonitorSupport&quot;</span><span class="p">)</span>

        <span class="c1"># add the application and machine graphs as needed</span>
        <span class="c1"># Both could be None if call from other than self._run</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ApplicationGraph&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;MachineGraph&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span>
        <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span>

    <span class="k">def</span> <span class="nf">_create_version_provenance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">front_end_versions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add the version information to the provenance data at the start.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">ProvenanceWriter</span><span class="p">()</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;spinn_utilities_version&quot;</span><span class="p">,</span> <span class="n">spinn_utils_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;spinn_machine_version&quot;</span><span class="p">,</span> <span class="n">spinn_machine_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;spalloc_version&quot;</span><span class="p">,</span> <span class="n">spalloc_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;spinnman_version&quot;</span><span class="p">,</span> <span class="n">spinnman_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;pacman_version&quot;</span><span class="p">,</span> <span class="n">pacman_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;data_specification_version&quot;</span><span class="p">,</span> <span class="n">data_spec_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;front_end_common_version&quot;</span><span class="p">,</span> <span class="n">fec_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;numpy_version&quot;</span><span class="p">,</span> <span class="n">numpy_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;scipy_version&quot;</span><span class="p">,</span> <span class="n">scipy_version</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">description</span><span class="p">,</span> <span class="n">the_value</span> <span class="ow">in</span> <span class="n">front_end_versions</span><span class="p">:</span>
                <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">the_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param float run_time:</span>
<span class="sd">        :param float total_run_time:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># time the time it takes to do all pacman stuff</span>
        <span class="n">mapping_total_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="n">mapping_total_timer</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>

        <span class="c1"># update inputs with extra mapping inputs if required</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine_outputs</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine_tokens</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_mapping_inputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extra_mapping_inputs</span><span class="p">)</span>

        <span class="c1"># runtime full runtime from pynn</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RunTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run_time</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;TotalRunTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_run_time</span>

        <span class="c1"># handle graph additions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ApplicationGraph&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;MachineGraph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span>

        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;JsonFolder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_folder</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;APPID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;DatabaseSocketAddresses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database_socket_addresses</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ExecutableFinder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span>

        <span class="n">algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># process for TDMA required cores</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;LocalTDMABuilder&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;InsertLivePacketGatherersToGraphs&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;InsertEdgesToLivePacketGatherers&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;LivePacketRecorderParameters&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span>

        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;InsertChipPowerMonitorsToGraphs&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;MemorySamplingFrequency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
                <span class="s2">&quot;EnergyMonitor&quot;</span><span class="p">,</span> <span class="s2">&quot;sampling_frequency&quot;</span><span class="p">)</span>

        <span class="c1"># handle extra monitor functionality</span>
        <span class="n">add_data_speed_up</span> <span class="o">=</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">)</span> <span class="ow">or</span>
            <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">add_data_speed_up</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;InsertExtraMonitorVerticesToGraphs&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;InsertEdgesToExtraMonitorFunctionality&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SystemMulticastRoutingGenerator&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FixedRouteRouter&quot;</span><span class="p">)</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;FixedRouteDestinationClass&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">DataSpeedUpPacketGatherMachineVertex</span>

        <span class="c1"># handle extra mapping algorithms if required</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_mapping_algorithms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extra_mapping_algorithms</span><span class="p">)</span>

        <span class="n">optional_algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># Add reports</span>
        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;reports_enabled&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_tag_allocation_reports&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TagReport&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_router_info_report&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;routingInfoReports&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_router_reports&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RouterReports&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_router_summary_report&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RouterSummaryReport&quot;</span><span class="p">)</span>

            <span class="c1"># only add board chip report if requested</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_board_chip_report&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BoardChipReport&quot;</span><span class="p">)</span>

            <span class="c1"># only add partitioner report if using an application graph</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_partitioner_reports&quot;</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PartitionerReport&quot;</span><span class="p">)</span>

            <span class="c1"># only add write placer report with application graph when</span>
            <span class="c1"># there&#39;s application vertices</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_application_graph_placer_report&quot;</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PlacerReportWithApplicationGraph&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_machine_graph_placer_report&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PlacerReportWithoutApplicationGraph&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_machine&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WriteJsonMachine&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_machine_graph&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WriteJsonMachineGraph&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_placements&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WriteJsonPlacements&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_routing_tables&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WriteJsonRoutingTables&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_partition_n_keys_map&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WriteJsonPartitionNKeysMap&quot;</span><span class="p">)</span>

            <span class="c1"># only add network specification report if there&#39;s</span>
            <span class="c1"># application vertices.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_network_specification_report&quot;</span><span class="p">)):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;NetworkSpecificationReport&quot;</span><span class="p">)</span>

        <span class="c1"># only add the partitioner if there isn&#39;t already a machine graph</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MallocBasedChipIDAllocator&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_PREALLOC_NAME</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="n">_PREALLOC_NAME</span><span class="p">]</span> <span class="o">=</span> <span class="n">PreAllocatedResourceContainer</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_config_str_list</span><span class="p">(</span>
                <span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;application_to_machine_graph_algorithms&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_config_str_list</span><span class="p">(</span>
                <span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;machine_graph_to_virtual_machine_algorithms&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_config_str_list</span><span class="p">(</span>
                <span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;machine_graph_to_machine_algorithms&quot;</span><span class="p">))</span>

        <span class="c1"># add check for algorithm start type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;LocateExecutableStartType&quot;</span><span class="p">)</span>

        <span class="c1"># handle outputs</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Placements&quot;</span><span class="p">,</span> <span class="s2">&quot;RoutingTables&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Tags&quot;</span><span class="p">,</span> <span class="s2">&quot;RoutingInfos&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MachineGraph&quot;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ExecutableTypes&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_data_speed_up</span><span class="p">:</span>
            <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FixedRoutes&quot;</span><span class="p">)</span>

        <span class="c1"># Create a buffer manager if there isn&#39;t one already</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BufferManagerCreator&quot;</span><span class="p">)</span>
                <span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BufferManager&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;BufferManager&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;use_java&quot;</span><span class="p">):</span>
                    <span class="n">java_call</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;java_call&quot;</span><span class="p">)</span>
                    <span class="n">java_spinnaker_path</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                        <span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;java_spinnaker_path&quot;</span><span class="p">)</span>
                    <span class="n">java_jar_path</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                        <span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;java_jar_path&quot;</span><span class="p">)</span>
                    <span class="n">java_properties</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                        <span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;java_properties&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span> <span class="o">=</span> <span class="n">JavaCaller</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_json_folder</span><span class="p">,</span> <span class="n">java_call</span><span class="p">,</span> <span class="n">java_spinnaker_path</span><span class="p">,</span>
                        <span class="n">java_properties</span><span class="p">,</span> <span class="n">java_jar_path</span><span class="p">)</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;JavaCaller&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span>

        <span class="c1"># Add the sdram allocator to ensure the sdram is allocated before</span>
        <span class="c1"># DSG.  Note this can run with a virtual machine but then makes fake</span>
        <span class="c1"># allocations, but avoids DSG issues.</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SDRAMOutgoingPartitionAllocator&quot;</span><span class="p">)</span>

        <span class="c1"># Execute the mapping algorithms</span>
        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_algorithms</span><span class="p">(</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="p">[],</span> <span class="s2">&quot;mapping&quot;</span><span class="p">,</span>
            <span class="n">optional_algorithms</span><span class="p">)</span>

        <span class="c1"># get result objects from the pacman executor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_tokens</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_completed_tokens</span><span class="p">()</span>

        <span class="c1"># Get the outputs needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;Placements&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;RoutingTables&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;Tags&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;RoutingInfos&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;MachineGraph&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;ExecutableTypes&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">add_data_speed_up</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_routes</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;FixedRoutes&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;BufferManager&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_time</span> <span class="o">+=</span> <span class="n">convert_time_diff_to_total_milliseconds</span><span class="p">(</span>
            <span class="n">mapping_total_timer</span><span class="o">.</span><span class="n">take_sample</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span><span class="p">[</span><span class="s2">&quot;MappingTimeMs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_time</span>

    <span class="k">def</span> <span class="nf">_do_data_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param int n_machine_time_steps:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set up timing</span>
        <span class="n">data_gen_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="n">data_gen_timer</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>

        <span class="c1"># The initial inputs are the mapping outputs</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping_tokens</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RunUntilTimeSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_machine_time_steps</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;FirstMachineTimeStep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span>

        <span class="c1"># This is done twice to make things nicer for things which don&#39;t have</span>
        <span class="c1"># time steps without breaking existing code; it is purely aesthetic</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;DataNTimeSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;DataNSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span>

        <span class="c1"># Run the data generation algorithms</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dsg_algorithm</span><span class="p">]</span>

        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_algorithms</span><span class="p">(</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="p">[],</span> <span class="s2">&quot;data_generation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_tokens</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_completed_tokens</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_time</span> <span class="o">+=</span> <span class="n">convert_time_diff_to_total_milliseconds</span><span class="p">(</span>
            <span class="n">data_gen_timer</span><span class="o">.</span><span class="n">take_sample</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span><span class="p">[</span><span class="s2">&quot;DSGTimeMs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_time</span>

    <span class="k">def</span> <span class="nf">_do_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">data_changed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param bool graph_changed:</span>
<span class="sd">        :param bool data_changed:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set up timing</span>
        <span class="n">load_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="n">load_timer</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>

        <span class="c1"># The initial inputs are the mapping outputs</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping_tokens</span><span class="p">)</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;NoSyncChanges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">graph_changed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ExecutableTargets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="p">[</span>
                <span class="s2">&quot;ExecutableTargets&quot;</span><span class="p">]</span>

        <span class="n">algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="c1"># add report for extracting routing table from machine report if needed</span>
        <span class="c1"># Add algorithm to clear routing tables and set up routing</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="c1"># only clear routing tables if we&#39;ve not loaded them by now</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_tokens</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;DataLoaded&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">part</span> <span class="o">==</span> <span class="s2">&quot;MulticastRoutesLoaded&quot;</span><span class="p">:</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RoutingSetup&quot;</span><span class="p">)</span>

            <span class="c1"># Get the executable targets</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;GraphBinaryGatherer&quot;</span><span class="p">)</span>

        <span class="n">algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_config_str_list</span><span class="p">(</span>
            <span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;loading_algorithms&quot;</span><span class="p">))</span>

        <span class="n">algorithms</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extra_load_algorithms</span><span class="p">)</span>

        <span class="n">write_memory_report</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_memory_map_report&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">write_memory_report</span> <span class="ow">and</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MemoryMapOnHostReport&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;MemoryMapOnHostChipReport&quot;</span><span class="p">)</span>

        <span class="c1"># Add reports that depend on compression</span>
        <span class="n">routing_tables_needed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_routing_table_reports&quot;</span><span class="p">):</span>
                <span class="n">routing_tables_needed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;unCompressedRoutingTableReports&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                        <span class="s2">&quot;Reports&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;write_routing_tables_from_machine_reports&quot;</span><span class="p">):</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ReadRoutingTablesFromMachine&quot;</span><span class="p">)</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;compressedRoutingTableReports&quot;</span><span class="p">)</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;comparisonOfRoutingTablesReport&quot;</span><span class="p">)</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;CompressedRouterSummaryReport&quot;</span><span class="p">)</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RoutingTableFromMachineReport&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_bit_field_compressor_report&quot;</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BitFieldCompressorReport&quot;</span><span class="p">)</span>

        <span class="c1"># handle extra monitor functionality</span>
        <span class="n">enable_advanced_monitor</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable_advanced_monitor</span> <span class="ow">and</span> <span class="p">(</span><span class="n">graph_changed</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;LoadFixedRoutes&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FixedRouteFromMachineReport&quot;</span><span class="p">)</span>

        <span class="c1"># add optional algorithms</span>
        <span class="n">optional_algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">graph_changed</span> <span class="ow">or</span> <span class="n">data_changed</span><span class="p">:</span>
            <span class="n">optional_algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RoutingTableLoader&quot;</span><span class="p">)</span>
            <span class="n">optional_algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TagsLoader&quot;</span><span class="p">)</span>

        <span class="n">optional_algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;HostExecuteApplicationDataSpecification&quot;</span><span class="p">)</span>

        <span class="c1"># Get the executable targets</span>
        <span class="n">optional_algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;GraphBinaryGatherer&quot;</span><span class="p">)</span>

        <span class="c1"># algorithms needed for loading the binaries to the SpiNNaker machine</span>
        <span class="n">optional_algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;LoadApplicationExecutableImages&quot;</span><span class="p">)</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;HostExecuteSystemDataSpecification&quot;</span><span class="p">)</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;LoadSystemExecutableImages&quot;</span><span class="p">)</span>

        <span class="c1"># Something probably a report needs the routing tables</span>
        <span class="c1"># This report is one way to get them if done on machine</span>
        <span class="k">if</span> <span class="n">routing_tables_needed</span><span class="p">:</span>
            <span class="n">optional_algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RoutingTableFromMachineReport&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_tag_allocation_reports&quot;</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TagsFromMachineReport&quot;</span><span class="p">)</span>

        <span class="c1"># Decide what needs to be done</span>
        <span class="n">required_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DataLoaded&quot;</span><span class="p">,</span> <span class="s2">&quot;BinariesLoaded&quot;</span><span class="p">]</span>

        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_algorithms</span><span class="p">(</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="p">[],</span> <span class="n">tokens</span><span class="p">,</span> <span class="n">required_tokens</span><span class="p">,</span> <span class="s2">&quot;loading&quot;</span><span class="p">,</span>
            <span class="n">optional_algorithms</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;NoSyncChanges&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_outputs</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_tokens</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_completed_tokens</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_load_time</span> <span class="o">+=</span> <span class="n">convert_time_diff_to_total_milliseconds</span><span class="p">(</span>
            <span class="n">load_timer</span><span class="o">.</span><span class="n">take_sample</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_outputs</span><span class="p">[</span><span class="s2">&quot;LoadTimeMs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_time</span>

    <span class="k">def</span> <span class="nf">_end_of_run_timing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return:</span>
<span class="sd">            mapping_time, dsg_time, load_time, execute_time, extraction_time</span>
<span class="sd">        :rtype: tuple(float, float, float, float, float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_timer</span>
        <span class="k">if</span> <span class="n">timer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_time</span> <span class="o">+=</span> <span class="n">convert_time_diff_to_total_milliseconds</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_timer</span><span class="o">.</span><span class="n">take_sample</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mapping_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_time</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extraction_time</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param n_machine_time_steps: The number of steps to simulate</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :param bool graph_changed: Has the graph changed between runs</span>
<span class="sd">        :param int n_sync_steps: The number of steps between synchronisation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># start timer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_timer</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>

        <span class="n">run_complete</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">executor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_execute_workflow</span><span class="p">(</span>
            <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>

        <span class="c1"># Update the number of sync changes now in case this is used in a</span>
        <span class="c1"># synchronised simulation.  Note that the &quot;correct&quot; value will be</span>
        <span class="c1"># extracted later if not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">executor</span><span class="o">.</span><span class="n">execute_mapping</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pacman_provenance</span><span class="o">.</span><span class="n">extract_provenance</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>
            <span class="n">run_complete</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># move data around</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_tokens</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_completed_tokens</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;NoSyncChanges&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User has aborted the simulation&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">e_inf</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>

            <span class="c1"># If an exception occurs during a run, attempt to get</span>
            <span class="c1"># information out of the simulation before shutting down</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">executor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Only do this if the error occurred in the run</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">run_complete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_items</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_tokens</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_completed_tokens</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_recover_from_error</span><span class="p">(</span>
                            <span class="n">e</span><span class="p">,</span> <span class="n">e_inf</span><span class="p">,</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="s2">&quot;ExecutableTargets&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;The PACMAN executor crashing during initialisation,&quot;</span>
                        <span class="s2">&quot; please read previous error message to locate its&quot;</span>
                        <span class="s2">&quot; error&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error when attempting to recover from error&quot;</span><span class="p">)</span>

            <span class="c1"># if in debug mode, do not shut down machine</span>
            <span class="k">if</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mode&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;Debug&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span>
                        <span class="n">turn_off_machine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">clear_tags</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error when attempting to stop&quot;</span><span class="p">)</span>

            <span class="c1"># reraise exception</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">_create_execute_workflow</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param n_machine_time_steps:</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :param bool graph_changed:</span>
<span class="sd">        :param int n_sync_steps:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># calculate number of machine time steps</span>
        <span class="n">run_until_timesteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_number_of_machine_time_steps</span><span class="p">(</span>
            <span class="n">n_machine_time_steps</span><span class="p">)</span>
        <span class="n">run_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">run_time</span> <span class="o">=</span> <span class="n">n_machine_time_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span>

        <span class="c1"># if running again, load the outputs from last load or last mapping</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_outputs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_outputs</span><span class="p">)</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_tokens</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping_outputs</span><span class="p">)</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping_tokens</span><span class="p">)</span>

        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;NoSyncChanges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RunTimeMachineTimeSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_machine_time_steps</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RunUntilTimeSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run_until_timesteps</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RunTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">run_time</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;NSyncSteps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_sync_steps</span>
        <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;FirstMachineTimeStep&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;RunUntilCompleteFlag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Don&#39;t timeout if a stepped mode is in operation</span>
        <span class="k">if</span> <span class="n">n_sync_steps</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PostSimulationOverrunBeforeError&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;PostSimulationOverrunBeforeError&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;post_simulation_overrun_before_error&quot;</span><span class="p">)</span>

        <span class="c1"># update algorithm list with extra pre algorithms if needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_pre_run_algorithms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extra_pre_run_algorithms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">algorithms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_sdram_usage_report_per_chip&quot;</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;SdramUsageReportPerChip&quot;</span><span class="p">)</span>

        <span class="c1"># Clear iobuf from machine</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_empty_graphs</span> <span class="ow">and</span>
                <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_iobuf_during_run&quot;</span><span class="p">)):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ChipIOBufClearer&quot;</span><span class="p">)</span>

        <span class="c1"># Reload any parameters over the loaded data if we have already</span>
        <span class="c1"># run and not using a virtual board and the data hasn&#39;t already</span>
        <span class="c1"># been regenerated</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;DSGRegionReloader&quot;</span><span class="p">)</span>

        <span class="c1"># Update the run time if not using a virtual board</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span>
                <span class="n">ExecutableType</span><span class="o">.</span><span class="n">USES_SIMULATION_INTERFACE</span> <span class="ow">in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ChipRuntimeUpdater&quot;</span><span class="p">)</span>

        <span class="c1"># Add the database writer in case it is needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">or</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;DatabaseInterface&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;DatabaseFilePath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="p">[</span><span class="s2">&quot;DatabaseFilePath&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;CreateNotificationProtocol&quot;</span><span class="p">)</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;NoSyncChanges&quot;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Application will not actually be run as on a virtual board&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
                <span class="n">ExecutableType</span><span class="o">.</span><span class="n">NO_APPLICATION</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Application will not actually be run as there is nothing to &quot;</span>
                <span class="s2">&quot;actually run&quot;</span><span class="p">)</span>
            <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ApplicationRun&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ApplicationRunner&quot;</span><span class="p">)</span>

        <span class="c1"># add extractor of iobuf if needed</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;extract_iobuf&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span>
                <span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ChipIOBufExtractor&quot;</span><span class="p">)</span>

        <span class="c1"># ensure we exploit the parallel of data extraction by running it at\</span>
        <span class="c1"># end regardless of multirun, but only run if using a real machine</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span> <span class="ow">or</span> <span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BufferExtractor&quot;</span><span class="p">)</span>

        <span class="n">read_prov</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;read_provenance_data&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">read_prov</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;GraphProvenanceGatherer&quot;</span><span class="p">)</span>

        <span class="c1"># add any extra post algorithms as needed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_post_run_algorithms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">algorithms</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_post_run_algorithms</span>

        <span class="c1"># add in the timing finalisation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FinaliseTimingData&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">):</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ComputeEnergyUsed&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">read_prov</span><span class="p">:</span>
                    <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;EnergyProvenanceReporter&quot;</span><span class="p">)</span>

        <span class="c1"># add extractor of provenance if needed</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">read_prov</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span>
                <span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PlacementsProvenanceGatherer&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RouterProvenanceGatherer&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ProfileDataGatherer&quot;</span><span class="p">)</span>

        <span class="c1"># Decide what needs done</span>
        <span class="n">required_tokens</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">required_tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ApplicationRun&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">PACMANAlgorithmExecutor</span><span class="p">(</span>
            <span class="n">algorithms</span><span class="o">=</span><span class="n">algorithms</span><span class="p">,</span> <span class="n">optional_algorithms</span><span class="o">=</span><span class="p">[],</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
            <span class="n">tokens</span><span class="o">=</span><span class="n">tokens</span><span class="p">,</span> <span class="n">required_output_tokens</span><span class="o">=</span><span class="n">required_tokens</span><span class="p">,</span>
            <span class="n">xml_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_paths</span><span class="p">,</span> <span class="n">required_outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span>
            <span class="n">do_timings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_timings</span><span class="p">,</span> <span class="n">print_timings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_timings</span><span class="p">,</span>
            <span class="n">provenance_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pacman_executor_provenance_path</span><span class="p">,</span>
            <span class="n">provenance_name</span><span class="o">=</span><span class="s2">&quot;Execution&quot;</span><span class="p">),</span> <span class="n">run_until_timesteps</span>

    <span class="k">def</span> <span class="nf">_recover_from_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">,</span> <span class="n">executable_targets</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param Exception exception:</span>
<span class="sd">        :param tuple(type,Exception,traceback) exc_info:</span>
<span class="sd">        :param ExecutableTargets executable_targets:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if exception has an exception, print to system</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;An error has occurred during simulation&quot;</span><span class="p">)</span>
        <span class="c1"># Print the detail including the traceback</span>
        <span class="n">real_exception</span> <span class="o">=</span> <span class="n">exception</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">exc_info</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Attempting to extract data</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract router provenance</span>
        <span class="n">extra_monitor_vertices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">)):</span>
                <span class="n">extra_monitor_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="p">[</span>
                    <span class="s2">&quot;ExtraMonitorVertices&quot;</span><span class="p">]</span>
            <span class="n">router_provenance</span> <span class="o">=</span> <span class="n">RouterProvenanceGatherer</span><span class="p">()</span>
            <span class="n">router_provenance</span><span class="p">(</span>
                <span class="n">transceiver</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="n">machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="n">router_tables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span>
                <span class="n">extra_monitor_vertices</span><span class="o">=</span><span class="n">extra_monitor_vertices</span><span class="p">,</span>
                <span class="n">placements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error reading router provenance&quot;</span><span class="p">)</span>

        <span class="c1"># Find the cores that are not in an expected state</span>
        <span class="n">unsuccessful_cores</span> <span class="o">=</span> <span class="n">CPUInfos</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">real_exception</span><span class="p">,</span> <span class="n">SpiNNManCoresNotInStateException</span><span class="p">):</span>
            <span class="n">unsuccessful_cores</span> <span class="o">=</span> <span class="n">real_exception</span><span class="o">.</span><span class="n">failed_core_states</span><span class="p">()</span>

        <span class="c1"># If there are no cores in a bad state, find those not yet in</span>
        <span class="c1"># their finished state</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unsuccessful_cores</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">executable_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">:</span>
                <span class="n">failed_cores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">get_cores_not_in_state</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">[</span><span class="n">executable_type</span><span class="p">],</span>
                    <span class="n">executable_type</span><span class="o">.</span><span class="n">end_state</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">failed_cores</span><span class="p">:</span>
                    <span class="n">unsuccessful_cores</span><span class="o">.</span><span class="n">add_processor</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">failed_cores</span><span class="o">.</span><span class="n">get_cpu_info</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

        <span class="c1"># Print the details of error cores</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">core_info</span> <span class="ow">in</span> <span class="n">unsuccessful_cores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">core_info</span><span class="o">.</span><span class="n">state</span>
            <span class="n">rte_state</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">RUN_TIME_EXCEPTION</span><span class="p">:</span>
                <span class="n">rte_state</span> <span class="o">=</span> <span class="s2">&quot; (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">core_info</span><span class="o">.</span><span class="n">run_time_error</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rte_state</span><span class="p">,</span> <span class="n">core_info</span><span class="o">.</span><span class="n">application_name</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">core_info</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">RUN_TIME_EXCEPTION</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;r0=0x</span><span class="si">{:08X}</span><span class="s2"> r1=0x</span><span class="si">{:08X}</span><span class="s2"> r2=0x</span><span class="si">{:08X}</span><span class="s2"> r3=0x</span><span class="si">{:08X}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;r4=0x</span><span class="si">{:08X}</span><span class="s2"> r5=0x</span><span class="si">{:08X}</span><span class="s2"> r6=0x</span><span class="si">{:08X}</span><span class="s2"> r7=0x</span><span class="si">{:08X}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                        <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;PSR=0x</span><span class="si">{:08X}</span><span class="s2"> SR=0x</span><span class="si">{:08X}</span><span class="s2"> LR=0x</span><span class="si">{:08X}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">core_info</span><span class="o">.</span><span class="n">processor_state_register</span><span class="p">,</span>
                    <span class="n">core_info</span><span class="o">.</span><span class="n">stack_pointer</span><span class="p">,</span> <span class="n">core_info</span><span class="o">.</span><span class="n">link_register</span><span class="p">))</span>

        <span class="c1"># Find the cores that are not in RTE i.e. that can still be read</span>
        <span class="n">non_rte_cores</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">core_info</span> <span class="ow">in</span> <span class="n">unsuccessful_cores</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">core_info</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">RUN_TIME_EXCEPTION</span> <span class="ow">and</span>
                <span class="n">core_info</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">WATCHDOG</span><span class="p">)]</span>

        <span class="c1"># If there are any cores that are not in RTE, extract data from them</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">non_rte_cores</span> <span class="ow">and</span>
                <span class="n">ExecutableType</span><span class="o">.</span><span class="n">USES_SIMULATION_INTERFACE</span> <span class="ow">in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">):</span>
            <span class="n">non_rte_core_subsets</span> <span class="o">=</span> <span class="n">CoreSubsets</span><span class="p">()</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">non_rte_cores</span><span class="p">:</span>
                <span class="n">non_rte_core_subsets</span><span class="o">.</span><span class="n">add_processor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

            <span class="c1"># Attempt to force the cores to write provenance and exit</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">updater</span> <span class="o">=</span> <span class="n">ChipProvenanceUpdater</span><span class="p">()</span>
                <span class="n">updater</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="n">non_rte_core_subsets</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Could not update provenance on chip&quot;</span><span class="p">)</span>

            <span class="c1"># Extract any written provenance data</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">finished_cores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">get_cores_in_state</span><span class="p">(</span>
                    <span class="n">non_rte_core_subsets</span><span class="p">,</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">FINISHED</span><span class="p">)</span>
                <span class="n">finished_placements</span> <span class="o">=</span> <span class="n">Placements</span><span class="p">()</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">finished_cores</span><span class="p">:</span>
                    <span class="n">finished_placements</span><span class="o">.</span><span class="n">add_placement</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="o">.</span><span class="n">get_placement_on_processor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
                <span class="n">extractor</span> <span class="o">=</span> <span class="n">PlacementsProvenanceGatherer</span><span class="p">()</span>
                <span class="n">extractor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="n">finished_placements</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Could not read provenance&quot;</span><span class="p">)</span>

        <span class="c1"># Read IOBUF where possible (that should be everywhere)</span>
        <span class="n">iobuf</span> <span class="o">=</span> <span class="n">IOBufExtractor</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="n">executable_targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span> <span class="o">=</span> <span class="n">iobuf</span><span class="o">.</span><span class="n">extract_iobuf</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Could not get iobuf&quot;</span><span class="p">)</span>
            <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="c1"># Print the IOBUFs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_iobuf</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_print_iobuf</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param list(str) errors:</span>
<span class="sd">        :param list(str) warnings:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.reset"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Code that puts the simulation back at time zero</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resetting&quot;</span><span class="p">)</span>

        <span class="c1"># rewind the buffers from the buffer manager, to start at the beginning</span>
        <span class="c1"># of the simulation again and clear buffered out</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="c1"># reset the current count of how many milliseconds the application</span>
        <span class="c1"># has ran for over multiple calls to run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># sets the reset last flag to true, so that when run occurs, the tools</span>
        <span class="c1"># know to update the vertices which need to know a reset has occurred</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Reset the graph off the machine, to set things to time 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reset_graph_elements</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_create_xml_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_algorithm_xml_paths</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param list(str) extra_algorithm_xml_paths:</span>
<span class="sd">        :rtype: list(str)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add the extra xml files from the config file</span>
        <span class="n">xml_paths</span> <span class="o">=</span> <span class="n">get_config_str_list</span><span class="p">(</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;extra_xmls_paths&quot;</span><span class="p">)</span>
        <span class="n">xml_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interface_xml</span><span class="p">())</span>
        <span class="n">xml_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report_xml</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">extra_algorithm_xml_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xml_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_algorithm_xml_paths</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xml_paths</span>

    <span class="k">def</span> <span class="nf">_detect_if_graph_has_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reset_flags</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterates though the original graphs looking for changes.</span>

<span class="sd">        :param bool reset_flags:</span>
<span class="sd">        :return: mapping_changed, data_changed</span>
<span class="sd">        :rtype: tuple(bool, bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Set changed - note that we can&#39;t return yet as we still have to</span>
            <span class="c1"># mark vertices as not changed, otherwise they will keep reporting</span>
            <span class="c1"># that they have changed when they haven&#39;t</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># if application graph is filled, check their changes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">vertex</span><span class="o">.</span><span class="n">requires_mapping</span><span class="p">:</span>
                        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">vertex</span><span class="o">.</span><span class="n">requires_data_generation</span><span class="p">:</span>
                        <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">reset_flags</span><span class="p">:</span>
                        <span class="n">vertex</span><span class="o">.</span><span class="n">mark_no_changes</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">outgoing_edge_partitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">partition</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">requires_mapping</span><span class="p">:</span>
                            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">requires_data_generation</span><span class="p">:</span>
                            <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">reset_flags</span><span class="p">:</span>
                            <span class="n">edge</span><span class="o">.</span><span class="n">mark_no_changes</span><span class="p">()</span>

        <span class="c1"># if no application, but a machine graph, check for changes there</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">machine_vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">machine_vertex</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">machine_vertex</span><span class="o">.</span><span class="n">requires_mapping</span><span class="p">:</span>
                        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">machine_vertex</span><span class="o">.</span><span class="n">requires_data_generation</span><span class="p">:</span>
                        <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">reset_flags</span><span class="p">:</span>
                        <span class="n">machine_vertex</span><span class="o">.</span><span class="n">mark_no_changes</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">outgoing_edge_partitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">machine_edge</span> <span class="ow">in</span> <span class="n">partition</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">machine_edge</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">machine_edge</span><span class="o">.</span><span class="n">requires_mapping</span><span class="p">:</span>
                            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">machine_edge</span><span class="o">.</span><span class="n">requires_data_generation</span><span class="p">:</span>
                            <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">reset_flags</span><span class="p">:</span>
                            <span class="n">machine_edge</span><span class="o">.</span><span class="n">mark_no_changes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">changed</span><span class="p">,</span> <span class="n">data_changed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_ran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Whether the simulation has executed anything at all.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The python machine description object.</span>

<span class="sd">         :rtype: ~spinn_machine.Machine</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_machine</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">no_machine_time_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of machine time steps.</span>

<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_machine_time_steps</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a protected view of the machine_graph</span>
<span class="sd">        :rtype: ~pacman.model.graphs.machine.MachineGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MachineGraphView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">original_machine_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~pacman.model.graphs.machine.MachineGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">original_application_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~pacman.model.graphs.application.ApplicationGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">application_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The protected view of the application graph used to derive the</span>
<span class="sd">            runtime machine configuration.</span>

<span class="sd">        :rtype: ~pacman.model.graphs.application.ApplicationGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ApplicationGraphView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">routing_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~pacman.model.routing_info.RoutingInfo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fixed_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: dict(tuple(int,int),~spinn_machine.FixedRouteEntry)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_routes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">placements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Where machine vertices are placed on the machine.</span>

<span class="sd">        :rtype: ~pacman.model.placements.Placements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transceiver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; How to talk to the machine.</span>

<span class="sd">        :rtype: ~spinnman.transceiver.Transceiver</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~pacman.model.tags.Tags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">buffer_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The buffer manager being used for loading/extracting buffers</span>

<span class="sd">        :rtype:</span>
<span class="sd">            ~spinn_front_end_common.interface.buffer_management.BufferManager</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dsg_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The DSG algorithm used by the tools</span>

<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_algorithm</span>

    <span class="nd">@dsg_algorithm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dsg_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_dsg_algorithm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set the DSG algorithm to be used by the tools</span>

<span class="sd">        :param str new_dsg_algorithm: the new DSG algorithm name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_algorithm</span> <span class="o">=</span> <span class="n">new_dsg_algorithm</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">none_labelled_edge_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of times edges have not been labelled.</span>

<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_none_labelled_edge_count</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.increment_none_labelled_edge_count"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.increment_none_labelled_edge_count">[docs]</a>    <span class="k">def</span> <span class="nf">increment_none_labelled_edge_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Increment the number of new edges which have not been labelled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_none_labelled_edge_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_virtual_board</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; True if this run is using a virtual machine</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.get_current_time"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.get_current_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the current simulation time.</span>

<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.get_generated_output"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.get_generated_output">[docs]</a>    <span class="k">def</span> <span class="nf">get_generated_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_of_variable</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the value of an inter-algorithm variable.</span>

<span class="sd">        :param str name_of_variable: The variable to retrieve</span>
<span class="sd">        :return: The value (of arbitrary type), or `None` if the variable is</span>
<span class="sd">            not found.</span>
<span class="sd">        :raises ConfigurationException: If the simulation hasn&#39;t yet run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name_of_variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="p">[</span><span class="n">name_of_variable</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
            <span class="s2">&quot;Cannot call this function until after a simulation has ran.&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;general front end instance for machine </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_application_vertex"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_application_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">add_application_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~pacman.model.graphs.application.ApplicationVertex vertex:</span>
<span class="sd">            the vertex to add to the graph</span>
<span class="sd">        :raises ConfigurationException: when both graphs contain vertices</span>
<span class="sd">        :raises PacmanConfigurationException:</span>
<span class="sd">            If there is an attempt to add the same vertex more than once</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Cannot add vertices to both the machine and application&quot;</span>
                <span class="s2">&quot; graphs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_machine_vertex"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_machine_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">add_machine_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~pacman.model.graphs.machine.MachineVertex vertex:</span>
<span class="sd">            the vertex to add to the graph</span>
<span class="sd">        :raises ConfigurationException: when both graphs contain vertices</span>
<span class="sd">        :raises PacmanConfigurationException:</span>
<span class="sd">            If there is an attempt to add the same vertex more than once</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check that there&#39;s no application vertices added so far</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Cannot add vertices to both the machine and application&quot;</span>
                <span class="s2">&quot; graphs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_application_edge"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_application_edge">[docs]</a>    <span class="k">def</span> <span class="nf">add_application_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_to_add</span><span class="p">,</span> <span class="n">partition_identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~pacman.model.graphs.application.ApplicationEdge edge_to_add:</span>
<span class="sd">            the edge to add to the graph</span>
<span class="sd">        :param str partition_identifier:</span>
<span class="sd">            the partition identifier for the outgoing edge partition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
            <span class="n">edge_to_add</span><span class="p">,</span> <span class="n">partition_identifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_machine_edge"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_machine_edge">[docs]</a>    <span class="k">def</span> <span class="nf">add_machine_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">partition_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~pacman.model.graphs.machine.MachineEdge edge:</span>
<span class="sd">            the edge to add to the graph</span>
<span class="sd">        :param str partition_id:</span>
<span class="sd">            the partition identifier for the outgoing edge partition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">partition_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_shutdown</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">turn_off_machine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">clear_tags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param bool turn_off_machine:</span>
<span class="sd">        :param bool clear_routing_tables:</span>
<span class="sd">        :param bool clear_tags:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">SHUTDOWN</span>

        <span class="k">if</span> <span class="n">turn_off_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">turn_off_machine</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;turn_off_machine&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clear_routing_tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">clear_routing_tables</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_routing_tables&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clear_tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">clear_tags</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_tags&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if stopping on machine, clear IP tags and routing table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__clear</span><span class="p">(</span><span class="n">clear_tags</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="p">)</span>

        <span class="c1"># Fully stop the application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__stop_app</span><span class="p">()</span>

        <span class="c1"># stop the transceiver and allocation controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__close_transceiver</span><span class="p">(</span><span class="n">turn_off_machine</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__close_allocation_controller</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span> <span class="ow">and</span> \
                    <span class="s2">&quot;NotificationInterface&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="p">[</span><span class="s2">&quot;NotificationInterface&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Error when closing Notifications&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_tags</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param bool clear_tags:</span>
<span class="sd">        :param bool clear_routing_tables:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if stopping on machine, clear IP tags and</span>
        <span class="k">if</span> <span class="n">clear_tags</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ip_tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">ip_tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">clear_ip_tag</span><span class="p">(</span>
                    <span class="n">ip_tag</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">board_address</span><span class="o">=</span><span class="n">ip_tag</span><span class="o">.</span><span class="n">board_address</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">reverse_ip_tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">reverse_ip_tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">clear_ip_tag</span><span class="p">(</span>
                    <span class="n">reverse_ip_tag</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                    <span class="n">board_address</span><span class="o">=</span><span class="n">reverse_ip_tag</span><span class="o">.</span><span class="n">board_address</span><span class="p">)</span>

        <span class="c1"># if clearing routing table entries, clear</span>
        <span class="k">if</span> <span class="n">clear_routing_tables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">router_table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="o">.</span><span class="n">routing_tables</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">get_chip_at</span><span class="p">(</span>
                        <span class="n">router_table</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">router_table</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">virtual</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">clear_multicast_routes</span><span class="p">(</span>
                        <span class="n">router_table</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">router_table</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># clear values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__stop_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">stop_application</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__close_transceiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">turn_off_machine</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param bool turn_off_machine:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">turn_off_machine</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Turning off machine&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">power_off_machine</span><span class="o">=</span><span class="n">turn_off_machine</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__close_allocation_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.stop"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">turn_off_machine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># pylint: disable=arguments-differ</span>
             <span class="n">clear_routing_tables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear_tags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        End running of the simulation.</span>

<span class="sd">        :param bool turn_off_machine:</span>
<span class="sd">            decides if the machine should be powered down after running the</span>
<span class="sd">            execution. Note that this powers down all boards connected to the</span>
<span class="sd">            BMP connections given to the transceiver</span>
<span class="sd">        :param bool clear_routing_tables: informs the tool chain if it</span>
<span class="sd">            should turn off the clearing of the routing tables</span>
<span class="sd">        :param bool clear_tags: informs the tool chain if it should clear the</span>
<span class="sd">            tags off the machine at stop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Simulator_Status</span><span class="o">.</span><span class="n">SHUTDOWN</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span><span class="s2">&quot;Simulator has already been shutdown&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">SHUTDOWN</span>

        <span class="c1"># Keep track of any exception to be re-raised</span>
        <span class="n">exn</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If we have run forever, stop the binaries</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span><span class="p">):</span>
            <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_stop_workflow</span><span class="p">()</span>
            <span class="n">run_complete</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">execute_mapping</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pacman_provenance</span><span class="o">.</span><span class="n">extract_provenance</span><span class="p">(</span><span class="n">executor</span><span class="p">)</span>
                <span class="n">run_complete</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">exn</span> <span class="o">=</span> <span class="n">e</span>
                <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>

                <span class="c1"># If an exception occurs during a run, attempt to get</span>
                <span class="c1"># information out of the simulation before shutting down</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Only do this if the error occurred in the run</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">run_complete</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_recover_from_error</span><span class="p">(</span>
                            <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">executor</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span>
                                <span class="s2">&quot;ExecutableTargets&quot;</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                        <span class="s2">&quot;Error when attempting to recover from error&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_energy_report</span><span class="p">()</span>

            <span class="c1"># handle iobuf extraction</span>
            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;extract_iobuf&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extract_iobufs</span><span class="p">()</span>

        <span class="c1"># shut down the machine properly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">(</span><span class="n">turn_off_machine</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="p">,</span> <span class="n">clear_tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_errored_file</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">exn</span>  <span class="c1"># pylint: disable=raising-bad-type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_finished_file</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_create_stop_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~.PACMANAlgorithmExecutor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_tokens</span>
        <span class="n">algorithms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># stop any binaries that need to be notified of the simulation</span>
        <span class="c1"># stopping if in infinite run</span>
        <span class="k">if</span> <span class="n">ExecutableType</span><span class="o">.</span><span class="n">USES_SIMULATION_INTERFACE</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ApplicationFinisher&quot;</span><span class="p">)</span>

        <span class="c1"># Add the buffer extractor just in case</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BufferExtractor&quot;</span><span class="p">)</span>

        <span class="n">read_prov</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;read_provenance_data&quot;</span><span class="p">)</span>

        <span class="c1"># add extractor of iobuf if needed</span>
        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;extract_iobuf&quot;</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ChipIOBufExtractor&quot;</span><span class="p">)</span>

        <span class="c1"># add extractor of provenance if needed</span>
        <span class="k">if</span> <span class="n">read_prov</span><span class="p">:</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;PlacementsProvenanceGatherer&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RouterProvenanceGatherer&quot;</span><span class="p">)</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ProfileDataGatherer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">)</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">):</span>
            <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ComputeEnergyUsed&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">read_prov</span><span class="p">:</span>
                <span class="n">algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;EnergyProvenanceReporter&quot;</span><span class="p">)</span>

        <span class="c1"># Assemble how to run the algorithms</span>
        <span class="k">return</span> <span class="n">PACMANAlgorithmExecutor</span><span class="p">(</span>
            <span class="n">algorithms</span><span class="o">=</span><span class="n">algorithms</span><span class="p">,</span> <span class="n">optional_algorithms</span><span class="o">=</span><span class="p">[],</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span>
            <span class="n">tokens</span><span class="o">=</span><span class="n">tokens</span><span class="p">,</span> <span class="n">required_output_tokens</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">xml_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_paths</span><span class="p">,</span>
            <span class="n">required_outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">do_timings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_do_timings</span><span class="p">,</span>
            <span class="n">print_timings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_print_timings</span><span class="p">,</span>
            <span class="n">provenance_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pacman_executor_provenance_path</span><span class="p">,</span>
            <span class="n">provenance_name</span><span class="o">=</span><span class="s2">&quot;stopping&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_energy_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create energy reporter</span>
        <span class="n">energy_reporter</span> <span class="o">=</span> <span class="n">EnergyReport</span><span class="p">(</span>
            <span class="n">get_config_int</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># acquire provenance items</span>
        <span class="n">power_used</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PowerUsed&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># run energy report</span>
        <span class="n">energy_reporter</span><span class="o">.</span><span class="n">write_energy_report</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span><span class="p">,</span> <span class="n">power_used</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_extract_iobufs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_iobuf_during_run&quot;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">extractor</span> <span class="o">=</span> <span class="n">IOBufExtractor</span><span class="p">(</span>
            <span class="n">transceiver</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span>
            <span class="n">executable_targets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_run_outputs</span><span class="p">[</span><span class="s2">&quot;ExecutableTargets&quot;</span><span class="p">],</span>
            <span class="n">executable_finder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">)</span>
        <span class="n">extractor</span><span class="o">.</span><span class="n">extract_iobuf</span><span class="p">()</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_socket_address"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_socket_address">[docs]</a>    <span class="k">def</span> <span class="nf">add_socket_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">socket_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add the address of a socket used in the run notification protocol.</span>

<span class="sd">        :param ~spinn_utilities.socket_address.SocketAddress socket_address:</span>
<span class="sd">            The address of the database socket</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database_socket_addresses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">socket_address</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_reset_last</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_number_of_available_cores_on_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of available cores on the machine after taking\</span>
<span class="sd">            into account preallocated resources.</span>

<span class="sd">        :return: number of available cores</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get machine if not got already</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_machine</span><span class="p">()</span>

        <span class="c1"># get cores of machine</span>
        <span class="n">cores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">total_available_user_cores</span>
        <span class="n">take_into_account_chip_power_monitor</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">take_into_account_chip_power_monitor</span><span class="p">:</span>
            <span class="n">cores</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">n_chips</span>
        <span class="n">take_into_account_extra_monitor_cores</span> <span class="o">=</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">take_into_account_extra_monitor_cores</span><span class="p">:</span>
            <span class="n">cores</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">n_chips</span>
            <span class="n">cores</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">ethernet_connected_chips</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cores</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.stop_run"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.stop_run">[docs]</a>    <span class="k">def</span> <span class="nf">stop_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Request that the current infinite run stop.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This will need to be called from another thread as the infinite \</span>
<span class="sd">            run call is blocking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">IN_RUN</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">STOP_REQUESTED</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.continue_simulation"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.continue_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">continue_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Continue a simulation that has been started in stepped mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sync_signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="o">.</span><span class="n">SYNC0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sync_signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="o">.</span><span class="n">SYNC1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="n">sync_signal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">+=</span> <span class="mi">1</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__reset_object</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="c1"># Reset an object if appropriate</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">AbstractCanReset</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">reset_to_first_timestep</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__reset_graph_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Reset any object that can reset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__reset_object</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">outgoing_edge_partitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__reset_object</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">machine_vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__reset_object</span><span class="p">(</span><span class="n">machine_vertex</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">outgoing_edge_partitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">machine_edge</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__reset_object</span><span class="p">(</span><span class="n">machine_edge</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SpiNNFrontEndCommon 6.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spinn_front_end_common.interface.abstract_spinnaker_base</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
    </div>
  </body>
</html>