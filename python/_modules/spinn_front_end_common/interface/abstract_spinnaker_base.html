
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spinn_front_end_common.interface.abstract_spinnaker_base &#8212; SpiNNFrontEndCommon 6.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SpiNNFrontEndCommon 6.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spinn_front_end_common.interface.abstract_spinnaker_base</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for spinn_front_end_common.interface.abstract_spinnaker_base</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2017-2019 The University of Manchester</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">main interface for the SpiNNaker tools</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Condition</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">numpy_version</span>

<span class="kn">from</span> <span class="nn">spinn_utilities</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">spinn_utils_version</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.config_holder</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_config_bool</span><span class="p">,</span> <span class="n">get_config_int</span><span class="p">,</span> <span class="n">get_config_str</span><span class="p">,</span> <span class="n">set_config</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.log</span> <span class="kn">import</span> <span class="n">FormatAdapter</span>
<span class="kn">from</span> <span class="nn">spinn_utilities.timer</span> <span class="kn">import</span> <span class="n">Timer</span>

<span class="kn">from</span> <span class="nn">spinn_machine</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">spinn_machine_version</span>
<span class="kn">from</span> <span class="nn">spinn_machine</span> <span class="kn">import</span> <span class="n">CoreSubsets</span><span class="p">,</span> <span class="n">Machine</span>

<span class="kn">from</span> <span class="nn">spinnman</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">spinnman_version</span>
<span class="kn">from</span> <span class="nn">spinnman.exceptions</span> <span class="kn">import</span> <span class="n">SpiNNManCoresNotInStateException</span>
<span class="kn">from</span> <span class="nn">spinnman.messages.scp.enums.signal</span> <span class="kn">import</span> <span class="n">Signal</span>
<span class="kn">from</span> <span class="nn">spinnman.model.cpu_infos</span> <span class="kn">import</span> <span class="n">CPUInfos</span>
<span class="kn">from</span> <span class="nn">spinnman.model.enums.cpu_state</span> <span class="kn">import</span> <span class="n">CPUState</span>

<span class="kn">from</span> <span class="nn">data_specification</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">data_spec_version</span>

<span class="kn">from</span> <span class="nn">spalloc</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">spalloc_version</span>

<span class="kn">from</span> <span class="nn">pacman</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">pacman_version</span>
<span class="kn">from</span> <span class="nn">pacman.executor.injection_decorator</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">clear_injectables</span><span class="p">,</span> <span class="n">provide_injectables</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.model.graphs.application</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ApplicationGraph</span><span class="p">,</span> <span class="n">ApplicationGraphView</span><span class="p">,</span> <span class="n">ApplicationEdge</span><span class="p">,</span> <span class="n">ApplicationVertex</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.model.graphs.machine</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">MachineGraph</span><span class="p">,</span> <span class="n">MachineGraphView</span><span class="p">,</span> <span class="n">MachineVertex</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.model.partitioner_splitters.splitter_reset</span> <span class="kn">import</span> <span class="n">splitter_reset</span>
<span class="kn">from</span> <span class="nn">pacman.model.placements</span> <span class="kn">import</span> <span class="n">Placements</span>
<span class="kn">from</span> <span class="nn">pacman.model.resources</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConstantSDRAM</span><span class="p">,</span> <span class="n">PreAllocatedResourceContainer</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.operations.chip_id_allocator_algorithms</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">malloc_based_chip_id_allocator</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.operations.fixed_route_router</span> <span class="kn">import</span> <span class="n">fixed_route_router</span>
<span class="kn">from</span> <span class="nn">pacman.operations.partition_algorithms</span> <span class="kn">import</span> <span class="n">splitter_partitioner</span>
<span class="kn">from</span> <span class="nn">pacman.operations.placer_algorithms</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">connective_based_placer</span><span class="p">,</span> <span class="n">one_to_one_placer</span><span class="p">,</span> <span class="n">radial_placer</span><span class="p">,</span> <span class="n">spreader_placer</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.operations.router_algorithms</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">basic_dijkstra_routing</span><span class="p">,</span> <span class="n">ner_route</span><span class="p">,</span> <span class="n">ner_route_traffic_aware</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.operations.router_compressors</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">pair_compressor</span><span class="p">,</span> <span class="n">range_compressor</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.operations.router_compressors.ordered_covering_router_compressor</span> \
    <span class="kn">import</span> <span class="nn">ordered_covering_compressor</span>
<span class="kn">from</span> <span class="nn">pacman.operations.routing_info_allocator_algorithms.</span>\
    <span class="n">malloc_based_routing_allocator</span> <span class="kn">import</span> <span class="nn">malloc_based_routing_info_allocator</span>
<span class="kn">from</span> <span class="nn">pacman.operations.routing_info_allocator_algorithms.</span>\
    <span class="n">zoned_routing_info_allocator</span> <span class="kn">import</span> <span class="p">(</span><span class="n">flexible_allocate</span><span class="p">,</span> <span class="n">global_allocate</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.operations.routing_table_generators</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">basic_routing_table_generator</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pacman.operations.tag_allocator_algorithms</span> <span class="kn">import</span> <span class="n">basic_tag_allocator</span>

<span class="kn">from</span> <span class="nn">spinn_front_end_common</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">fec_version</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.abstract_models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AbstractSendMeMulticastCommandsVertex</span><span class="p">,</span>
    <span class="n">AbstractVertexWithEdgeToDependentVertices</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">,</span>
    <span class="n">AbstractCanReset</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.config_handler</span> <span class="kn">import</span> <span class="n">ConfigHandler</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.interface_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">application_finisher</span><span class="p">,</span> <span class="n">application_runner</span><span class="p">,</span> <span class="n">buffer_extractor</span><span class="p">,</span>
    <span class="n">buffer_manager_creator</span><span class="p">,</span> <span class="n">chip_io_buf_clearer</span><span class="p">,</span> <span class="n">chip_io_buf_extractor</span><span class="p">,</span>
    <span class="n">chip_provenance_updater</span><span class="p">,</span> <span class="n">chip_runtime_updater</span><span class="p">,</span> <span class="n">compute_energy_used</span><span class="p">,</span>
    <span class="n">create_notification_protocol</span><span class="p">,</span> <span class="n">database_interface</span><span class="p">,</span>
    <span class="n">dsg_region_reloader</span><span class="p">,</span> <span class="n">edge_to_n_keys_mapper</span><span class="p">,</span> <span class="n">energy_provenance_reporter</span><span class="p">,</span>
    <span class="n">execute_application_data_specs</span><span class="p">,</span> <span class="n">execute_system_data_specs</span><span class="p">,</span>
    <span class="n">graph_binary_gatherer</span><span class="p">,</span> <span class="n">graph_data_specification_writer</span><span class="p">,</span>
    <span class="n">graph_measurer</span><span class="p">,</span> <span class="n">graph_provenance_gatherer</span><span class="p">,</span>
    <span class="n">host_based_bit_field_router_compressor</span><span class="p">,</span>
    <span class="n">hbp_allocator</span><span class="p">,</span> <span class="n">hbp_max_machine_generator</span><span class="p">,</span>
    <span class="n">insert_chip_power_monitors_to_graphs</span><span class="p">,</span>
    <span class="n">insert_edges_to_extra_monitor_functionality</span><span class="p">,</span>
    <span class="n">insert_edges_to_live_packet_gatherers</span><span class="p">,</span>
    <span class="n">insert_extra_monitor_vertices_to_graphs</span><span class="p">,</span>
    <span class="n">insert_live_packet_gatherers_to_graphs</span><span class="p">,</span>
    <span class="n">load_app_images</span><span class="p">,</span> <span class="n">load_fixed_routes</span><span class="p">,</span> <span class="n">load_sys_images</span><span class="p">,</span>
    <span class="n">local_tdma_builder</span><span class="p">,</span> <span class="n">locate_executable_start_type</span><span class="p">,</span> <span class="n">machine_generator</span><span class="p">,</span>
    <span class="n">preallocate_resources_for_chip_power_monitor</span><span class="p">,</span>
    <span class="n">preallocate_resources_for_live_packet_gatherers</span><span class="p">,</span>
    <span class="n">pre_allocate_resources_for_extra_monitor_support</span><span class="p">,</span>
    <span class="n">placements_provenance_gatherer</span><span class="p">,</span>
    <span class="n">profile_data_gatherer</span><span class="p">,</span> <span class="n">process_partition_constraints</span><span class="p">,</span>
    <span class="n">read_routing_tables_from_machine</span><span class="p">,</span>
    <span class="n">router_provenance_gatherer</span><span class="p">,</span> <span class="n">routing_setup</span><span class="p">,</span> <span class="n">routing_table_loader</span><span class="p">,</span>
    <span class="n">sdram_outgoing_partition_allocator</span><span class="p">,</span> <span class="n">spalloc_allocator</span><span class="p">,</span>
    <span class="n">spalloc_max_machine_generator</span><span class="p">,</span>
    <span class="n">system_multicast_routing_generator</span><span class="p">,</span>
    <span class="n">tags_loader</span><span class="p">,</span> <span class="n">virtual_machine_generator</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.interface_functions.</span>\
    <span class="n">machine_bit_field_router_compressor</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">machine_bit_field_ordered_covering_compressor</span><span class="p">,</span>
        <span class="n">machine_bit_field_pair_router_compressor</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.interface_functions.</span>\
    <span class="n">host_no_bitfield_router_compression</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">ordered_covering_compression</span><span class="p">,</span> <span class="n">pair_compression</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.splitter_selectors</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">splitter_selector</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.java_caller</span> <span class="kn">import</span> <span class="n">JavaCaller</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.provenance</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">APPLICATION_RUNNER</span><span class="p">,</span> <span class="n">DATA_GENERATION</span><span class="p">,</span> <span class="n">GET_MACHINE</span><span class="p">,</span> <span class="n">LOADING</span><span class="p">,</span>
    <span class="n">ProvenanceWriter</span><span class="p">,</span> <span class="n">MAPPING</span><span class="p">,</span> <span class="n">RUN_LOOP</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.interface.simulator_status</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RUNNING_STATUS</span><span class="p">,</span> <span class="n">SHUTDOWN_STATUS</span><span class="p">,</span> <span class="n">Simulator_Status</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities</span> <span class="kn">import</span> <span class="n">globals_variables</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SARK_PER_MALLOC_SDRAM_USAGE</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.exceptions</span> <span class="kn">import</span> <span class="n">ConfigurationException</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.report_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">bitfield_compressor_report</span><span class="p">,</span> <span class="n">board_chip_report</span><span class="p">,</span> <span class="n">EnergyReport</span><span class="p">,</span>
    <span class="n">fixed_route_from_machine_report</span><span class="p">,</span> <span class="n">memory_map_on_host_report</span><span class="p">,</span>
    <span class="n">memory_map_on_host_chip_report</span><span class="p">,</span> <span class="n">network_specification</span><span class="p">,</span>
    <span class="n">router_collision_potential_report</span><span class="p">,</span>
    <span class="n">routing_table_from_machine_report</span><span class="p">,</span> <span class="n">tags_from_machine_report</span><span class="p">,</span>
    <span class="n">write_json_machine</span><span class="p">,</span> <span class="n">write_json_partition_n_keys_map</span><span class="p">,</span> <span class="n">write_json_placements</span><span class="p">,</span>
    <span class="n">write_json_routing_tables</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities</span> <span class="kn">import</span> <span class="n">IOBufExtractor</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.utility_objs</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ExecutableType</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utility_models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CommandSender</span><span class="p">,</span> <span class="n">CommandSenderMachineVertex</span><span class="p">,</span>
    <span class="n">DataSpeedUpPacketGatherMachineVertex</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities</span> <span class="kn">import</span> <span class="n">FecTimer</span>
<span class="kn">from</span> <span class="nn">spinn_front_end_common.utilities.report_functions.reports</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">generate_comparison_router_report</span><span class="p">,</span> <span class="n">partitioner_report</span><span class="p">,</span>
    <span class="n">placer_reports_with_application_graph</span><span class="p">,</span>
    <span class="n">placer_reports_without_application_graph</span><span class="p">,</span>
    <span class="n">router_compressed_summary_report</span><span class="p">,</span> <span class="n">routing_info_report</span><span class="p">,</span>
    <span class="n">router_report_from_compressed_router_tables</span><span class="p">,</span>
    <span class="n">router_report_from_paths</span><span class="p">,</span>
    <span class="n">router_report_from_router_tables</span><span class="p">,</span> <span class="n">router_summary_report</span><span class="p">,</span>
    <span class="n">sdram_usage_report_per_chip</span><span class="p">,</span>
    <span class="n">tag_allocator_report</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">scipy_version</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">scipy_version</span> <span class="o">=</span> <span class="s2">&quot;scipy not installed&quot;</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">FormatAdapter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>

<span class="c1"># 0-15 are reserved for system use (per lplana)</span>
<span class="n">ALANS_DEFAULT_RANDOM_APP_ID</span> <span class="o">=</span> <span class="mi">16</span>


<div class="viewcode-block" id="AbstractSpinnakerBase"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase">[docs]</a><span class="k">class</span> <span class="nc">AbstractSpinnakerBase</span><span class="p">(</span><span class="n">ConfigHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Main interface into the tools logic flow.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=broad-except</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># the object that contains a set of file paths, which should encompass</span>
        <span class="c1"># all locations where binaries are for this simulation.</span>
        <span class="c1"># init param and never changed</span>
        <span class="s2">&quot;_executable_finder&quot;</span><span class="p">,</span>

        <span class="c1"># the number of boards requested by the user during setup</span>
        <span class="c1"># init param and never changed</span>
        <span class="s2">&quot;_n_boards_required&quot;</span><span class="p">,</span>

        <span class="c1"># the number of chips requested by the user during setup.</span>
        <span class="c1"># init param and never changed</span>
        <span class="s2">&quot;_n_chips_required&quot;</span><span class="p">,</span>

        <span class="c1"># The IP-address of the SpiNNaker machine</span>
        <span class="c1"># provided during init and never changed</span>
        <span class="c1"># init or cfg param and never changed</span>
        <span class="s2">&quot;_hostname&quot;</span><span class="p">,</span>

        <span class="c1"># The IP-address of the SpiNNaker machine</span>
        <span class="c1"># Either hostname or the ipaddress form the allocator</span>
        <span class="s2">&quot;_ipaddress&quot;</span><span class="p">,</span>

        <span class="c1"># the ip_address of the spalloc server</span>
        <span class="c1"># provided during init and never changed</span>
        <span class="c1"># cfg param and never changed</span>
        <span class="s2">&quot;_spalloc_server&quot;</span><span class="p">,</span>

        <span class="c1"># the URL for the HBP platform interface</span>
        <span class="c1"># cfg param and never changed</span>
        <span class="s2">&quot;_remote_spinnaker_url&quot;</span><span class="p">,</span>

        <span class="c1"># the connection to allocted spalloc and HBP machines</span>
        <span class="s2">&quot;_machine_allocation_controller&quot;</span><span class="p">,</span>

        <span class="c1"># the pacman application graph, used to hold vertices which need to be</span>
        <span class="c1"># split to core sizes</span>
        <span class="s2">&quot;_application_graph&quot;</span><span class="p">,</span>

        <span class="c1"># the end user application graph, used to hold vertices which need to</span>
        <span class="c1"># be split to core sizes</span>
        <span class="c1"># Object created by init. Added to but never new object</span>
        <span class="s2">&quot;_original_application_graph&quot;</span><span class="p">,</span>

        <span class="c1"># the pacman machine graph, used to hold vertices which represent cores</span>
        <span class="s2">&quot;_machine_graph&quot;</span><span class="p">,</span>

        <span class="c1"># the end user pacman machine graph, used to hold vertices which</span>
        <span class="c1"># represent cores.</span>
        <span class="c1"># Object created by init. Added to but never new object</span>
        <span class="s2">&quot;_original_machine_graph&quot;</span><span class="p">,</span>

        <span class="c1"># The holder for where machine graph vertices are placed.</span>
        <span class="s2">&quot;_placements&quot;</span><span class="p">,</span>

        <span class="c1"># The holder for the routing table entries for all used routers in this</span>
        <span class="c1"># simulation</span>
        <span class="s2">&quot;_router_tables&quot;</span><span class="p">,</span>

        <span class="c1"># The holder for the routing table entries after possible</span>
        <span class="c1"># pre compression but before main compression</span>
        <span class="s2">&quot;_precompressed&quot;</span><span class="p">,</span>

        <span class="c1"># the holder for the keys used by the machine vertices for</span>
        <span class="c1"># communication</span>
        <span class="s2">&quot;_routing_infos&quot;</span><span class="p">,</span>

        <span class="c1"># the holder for the fixed routes generated, if there are any</span>
        <span class="s2">&quot;_fixed_routes&quot;</span><span class="p">,</span>

        <span class="c1"># The holder for the IP tags and reverse IP tags used by the simulation</span>
        <span class="s2">&quot;_tags&quot;</span><span class="p">,</span>

        <span class="c1"># The python representation of the SpiNNaker machine that this</span>
        <span class="c1"># simulation is going to run on</span>
        <span class="s2">&quot;_machine&quot;</span><span class="p">,</span>

        <span class="c1"># The SpiNNMan interface instance.</span>
        <span class="s2">&quot;_txrx&quot;</span><span class="p">,</span>

        <span class="c1"># The manager of streaming buffered data in and out of the SpiNNaker</span>
        <span class="c1"># machine</span>
        <span class="s2">&quot;_buffer_manager&quot;</span><span class="p">,</span>

        <span class="c1"># Handler for keep all the calls to Java in a single space.</span>
        <span class="c1"># May be null is configs request not to use Java</span>
        <span class="s2">&quot;_java_caller&quot;</span><span class="p">,</span>

        <span class="c1"># vertex label count used to ensure unique names of edges</span>
        <span class="s2">&quot;_none_labelled_edge_count&quot;</span><span class="p">,</span>

        <span class="c1"># Set of addresses.</span>
        <span class="c1"># Set created at init. Added to but never new object</span>
        <span class="s2">&quot;_database_socket_addresses&quot;</span><span class="p">,</span>

        <span class="c1"># status flag</span>
        <span class="s2">&quot;_has_ran&quot;</span><span class="p">,</span>

        <span class="c1"># Status enum</span>
        <span class="s2">&quot;_status&quot;</span><span class="p">,</span>

        <span class="c1"># Condition object used for waiting for stop</span>
        <span class="c1"># Set during init and the used but never new object</span>
        <span class="s2">&quot;_state_condition&quot;</span><span class="p">,</span>

        <span class="c1"># status flag</span>
        <span class="s2">&quot;_has_reset_last&quot;</span><span class="p">,</span>

        <span class="c1"># flag to say user has been give machine info</span>
        <span class="s2">&quot;_user_accessed_machine&quot;</span><span class="p">,</span>

        <span class="c1"># count of time from previous runs since setup/reset</span>
        <span class="c1"># During do_run points to the end timestep of that cycle</span>
        <span class="s2">&quot;_current_run_timesteps&quot;</span><span class="p">,</span>

        <span class="c1"># change number of resets as loading the binary again resets the</span>
        <span class="c1"># sync to 0</span>
        <span class="s2">&quot;_no_sync_changes&quot;</span><span class="p">,</span>

        <span class="c1"># max time the run can take without running out of memory</span>
        <span class="s2">&quot;_max_run_time_steps&quot;</span><span class="p">,</span>

        <span class="c1"># Set when run_until_complete is specified by the user</span>
        <span class="s2">&quot;_run_until_complete&quot;</span><span class="p">,</span>

        <span class="c1"># id for the application from the cfg or the tranceiver</span>
        <span class="c1"># TODO check after related PR</span>
        <span class="s2">&quot;_app_id&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_do_timings&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_print_timings&quot;</span><span class="p">,</span>

        <span class="c1">#</span>
        <span class="s2">&quot;_raise_keyboard_interrupt&quot;</span><span class="p">,</span>

        <span class="c1"># The run number for the this/next end_user call to run</span>
        <span class="s2">&quot;_n_calls_to_run&quot;</span><span class="p">,</span>

        <span class="c1"># The loop number for the this/next loop in the end_user run</span>
        <span class="s2">&quot;_n_loops&quot;</span><span class="p">,</span>

        <span class="c1"># dict of exucutable types to cores</span>
        <span class="s2">&quot;_executable_types&quot;</span><span class="p">,</span>

        <span class="c1"># mapping between parameters and the vertices which need to talk to</span>
        <span class="c1"># them</span>
        <span class="c1"># Created during init. Added to but never new object</span>
        <span class="s2">&quot;_live_packet_recorder_params&quot;</span><span class="p">,</span>

        <span class="c1"># place holder for checking the vertices being added to the recorders</span>
        <span class="c1"># tracker are all of the same vertex type.</span>
        <span class="s2">&quot;_live_packet_recorders_associated_vertex_type&quot;</span><span class="p">,</span>

        <span class="c1"># mapping of live packet recorder parameters to vertex</span>
        <span class="s2">&quot;_live_packet_recorder_parameters_mapping&quot;</span><span class="p">,</span>

        <span class="c1"># the timer used to log the execute time</span>
        <span class="c1"># TODO energy report cleanup</span>
        <span class="s2">&quot;_run_timer&quot;</span><span class="p">,</span>

        <span class="c1"># Used in exception handling and control c</span>
        <span class="s2">&quot;_last_except_hook&quot;</span><span class="p">,</span>

        <span class="c1"># status flag</span>
        <span class="s2">&quot;_vertices_or_edges_added&quot;</span><span class="p">,</span>

        <span class="c1"># Version provenance</span>
        <span class="c1"># TODO provenance cleanup</span>
        <span class="s2">&quot;_version_provenance&quot;</span><span class="p">,</span>

        <span class="c1"># All beyond this point new for no extractor</span>
        <span class="c1"># The data is not new but now it is held direct and not via inputs</span>

        <span class="c1"># Path of the notification interface database</span>
        <span class="s2">&quot;_database_file_path&quot;</span><span class="p">,</span>

        <span class="c1"># Binaries to run</span>
        <span class="s2">&quot;_executable_targets&quot;</span><span class="p">,</span>

        <span class="c1"># version of the board to requested or discovered</span>
        <span class="s2">&quot;_board_version&quot;</span><span class="p">,</span>

        <span class="c1"># vertices added to support Buffer Extractor</span>
        <span class="s2">&quot;_extra_monitor_vertices&quot;</span><span class="p">,</span>

        <span class="c1"># Start timestep of a do_run cycle</span>
        <span class="c1"># Set by data generation and do_run cleared by do_run</span>
        <span class="s2">&quot;_first_machine_time_step&quot;</span><span class="p">,</span>

        <span class="c1"># Mapping for partitions to how many keys they need</span>
        <span class="s2">&quot;_machine_partition_n_keys_map&quot;</span><span class="p">,</span>

        <span class="c1"># system routing timout keys</span>
        <span class="s2">&quot;_system_multicast_router_timeout_keys&quot;</span><span class="p">,</span>

        <span class="c1"># DSG to be written to the machine</span>
        <span class="s2">&quot;_dsg_targets&quot;</span><span class="p">,</span>

        <span class="c1"># Sizes of dsg regions</span>
        <span class="s2">&quot;_region_sizes&quot;</span><span class="p">,</span>

        <span class="c1"># Mapping for vertice to extra monitors</span>
        <span class="s2">&quot;_vertex_to_ethernet_connected_chip_mapping&quot;</span><span class="p">,</span>

        <span class="c1"># Reinjection routing tables</span>
        <span class="s2">&quot;_data_in_multicast_routing_tables&quot;</span><span class="p">,</span>

        <span class="c1"># Maps injector keys to chips</span>
        <span class="s2">&quot;_data_in_multicast_key_to_chip_map&quot;</span><span class="p">,</span>

        <span class="c1"># Number of timesteps to consider when doing partitioning and placement</span>
        <span class="s2">&quot;_plan_n_timesteps&quot;</span><span class="p">,</span>

        <span class="c1"># TODO provenance cleanup</span>
        <span class="s2">&quot;_compressor_provenance&quot;</span><span class="p">,</span>

        <span class="c1"># Routing tables</span>
        <span class="s2">&quot;_routing_table_by_partition&quot;</span><span class="p">,</span>

        <span class="c1"># Flag to say is compressed routing tables are on machine</span>
        <span class="c1"># TODO remove this when the data change only algorithms are done</span>
        <span class="s2">&quot;_multicast_routes_loaded&quot;</span><span class="p">,</span>

        <span class="c1"># Extra monitors per chip</span>
        <span class="s2">&quot;_extra_monitor_to_chip_mapping&quot;</span><span class="p">,</span>

        <span class="c1"># Flag to say if current machine is a temporary max machine</span>
        <span class="c1"># the temp /max machine is held in the &quot;machine&quot; slot</span>
        <span class="s2">&quot;_max_machine&quot;</span><span class="p">,</span>

        <span class="c1"># Number of chips computed to be needed</span>
        <span class="s2">&quot;_n_chips_needed&quot;</span><span class="p">,</span>

        <span class="c1"># Notification interface if needed</span>
        <span class="s2">&quot;_notification_interface&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">executable_finder</span><span class="p">,</span> <span class="n">graph_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">database_socket_addresses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_chips_required</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">n_boards_required</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param executable_finder: How to find APLX files to deploy to SpiNNaker</span>
<span class="sd">        :type executable_finder:</span>
<span class="sd">            ~spinn_utilities.executable_finder.ExecutableFinder</span>
<span class="sd">        :param str graph_label: A label for the overall application graph</span>
<span class="sd">        :param database_socket_addresses: How to talk to notification databases</span>
<span class="sd">        :type database_socket_addresses:</span>
<span class="sd">            iterable(~spinn_utilities.socket_address.SocketAddress) or None</span>
<span class="sd">        :param int n_chips_required:</span>
<span class="sd">            Overrides the number of chips to allocate from spalloc</span>
<span class="sd">        :param int n_boards_required:</span>
<span class="sd">            Overrides the number of boards to allocate from spalloc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span> <span class="o">=</span> <span class="n">executable_finder</span>

        <span class="c1"># output locations of binaries to be searched for end user info</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Will search these locations for binaries: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="o">.</span><span class="n">binary_paths</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n_chips_required</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">n_boards_required</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span> <span class="o">=</span> <span class="n">n_chips_required</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span> <span class="o">=</span> <span class="n">n_boards_required</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Please use at most one of n_chips_required or &quot;</span>
                <span class="s2">&quot;n_boards_required&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># store for Live Packet Gatherers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># update graph label if needed</span>
        <span class="k">if</span> <span class="n">graph_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">graph_label</span> <span class="o">=</span> <span class="s2">&quot;Application_graph&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">graph_label</span> <span class="o">=</span> <span class="n">graph_label</span>

        <span class="c1"># pacman objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span> <span class="o">=</span> <span class="n">ApplicationGraph</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">graph_label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span> <span class="o">=</span> <span class="n">MachineGraph</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">graph_label</span><span class="p">,</span>
            <span class="n">application_graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_run_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_clear</span><span class="p">()</span>

        <span class="c1"># pacman executor objects</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_none_labelled_edge_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># database objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database_socket_addresses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">database_socket_addresses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_database_socket_addresses</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">database_socket_addresses</span><span class="p">)</span>

        <span class="c1"># holder for timing and running related values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">INIT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_accessed_machine</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># folders</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_up_output_folders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span><span class="p">)</span>

        <span class="c1"># Setup for signal handling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_keyboard_interrupt</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">globals_variables</span><span class="o">.</span><span class="n">set_simulator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_version_provenance</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_last_except_hook</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_machine_time_step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compressor_provenance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">FecTimer</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Safety in case a previous run left a bad state</span>
        <span class="n">clear_injectables</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_new_run_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This clears all data that if no longer valid after a hard reset</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database_file_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notification_interface</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_in_multicast_key_to_chip_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_in_multicast_routing_tables</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_targets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_to_chip_mapping</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_vertices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_routes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_parameters_mapping</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_machine</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_needed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_region_sizes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_table_by_partition</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_system_multicast_router_timeout_keys</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_to_ethernet_connected_chip_mapping</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_machine_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_board_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">stop_application</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__close_allocation_controller</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides dict style access to the key data.</span>

<span class="sd">        Allow ASB to be passed into the do_injection method</span>

<span class="sd">        Values exposed this way are limited to the ones needed for injection</span>

<span class="sd">        :param str item: key to object wanted</span>
<span class="sd">        :return: Object asked for</span>
<span class="sd">        :rtype: Object</span>
<span class="sd">        :raise KeyError: the error message will say if the item is not known</span>
<span class="sd">            now or not provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unchecked_gettiem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Item </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2"> is currently not set&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provides dict style in checks to the key data.</span>

<span class="sd">        Keys check this way are limited to the ones needed for injection</span>

<span class="sd">        :param str item:</span>
<span class="sd">        :return: True if the items is currently know</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unchecked_gettiem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.items"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists the keys of the data currently available.</span>

<span class="sd">        Keys exposed this way are limited to the ones needed for injection</span>

<span class="sd">        :return: List of the keys for which there is data</span>
<span class="sd">        :rtype: list(str)</span>
<span class="sd">        :raise KeyError:  Amethod this call depends on could raise this</span>
<span class="sd">            exception, but that indicates a programming mismatch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;APPID&quot;</span><span class="p">,</span> <span class="s2">&quot;ApplicationGraph&quot;</span><span class="p">,</span> <span class="s2">&quot;DataInMulticastKeyToChipMap&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;DataInMulticastRoutingTables&quot;</span><span class="p">,</span> <span class="s2">&quot;DataNTimeSteps&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ExtendedMachine&quot;</span><span class="p">,</span> <span class="s2">&quot;FirstMachineTimeStep&quot;</span><span class="p">,</span> <span class="s2">&quot;MachineGraph&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;MachinePartitionNKeysMap&quot;</span><span class="p">,</span> <span class="s2">&quot;Placements&quot;</span><span class="p">,</span> <span class="s2">&quot;RoutingInfos&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;RunUntilTimeSteps&quot;</span><span class="p">,</span> <span class="s2">&quot;SystemMulticastRouterTimeoutKeys&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Tags&quot;</span><span class="p">]:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unchecked_gettiem</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span></div>

    <span class="k">def</span> <span class="nf">_unchecked_gettiem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the data for this item or None if currently unknown.</span>

<span class="sd">        Values exposed this way are limited to the ones needed for injection</span>

<span class="sd">        :param str item:</span>
<span class="sd">        :return: The value for this item or None is currently unkwon</span>
<span class="sd">        :rtype: Object or None</span>
<span class="sd">        :raise KeyError: It the item is one that is never provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;APPID&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;ApplicationGraph&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;DataInMulticastKeyToChipMap&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_in_multicast_key_to_chip_map</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;DataInMulticastRoutingTables&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_in_multicast_routing_tables</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;DataNTimeSteps&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;DataNSteps&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;ExtendedMachine&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;FirstMachineTimeStep&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_machine_time_step</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;MachineGraph&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_graph</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;MachinePartitionNKeysMap&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;Placements&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;RoutingInfos&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;RunUntilTimeSteps&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;SystemMulticastRouterTimeoutKeys&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_system_multicast_router_timeout_keys</span>
        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s2">&quot;Tags&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected Item </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.set_n_boards_required"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.set_n_boards_required">[docs]</a>    <span class="k">def</span> <span class="nf">set_n_boards_required</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_boards_required</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the machine requirements.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This method should not be called after the machine</span>
<span class="sd">            requirements have be computed based on the graph.</span>

<span class="sd">        :param int n_boards_required: The number of boards required</span>
<span class="sd">        :raises: ConfigurationException</span>
<span class="sd">            If any machine requirements have already been set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Catch the unchanged case including leaving it None</span>
        <span class="k">if</span> <span class="n">n_boards_required</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Illegal attempt to change previously set value.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Clash with n_chips_required.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span> <span class="o">=</span> <span class="n">n_boards_required</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_live_packet_gatherer_parameters"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_live_packet_gatherer_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">add_live_packet_gatherer_parameters</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">live_packet_gatherer_params</span><span class="p">,</span> <span class="n">vertex_to_record_from</span><span class="p">,</span>
            <span class="n">partition_ids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds parameters for a new LPG if needed, or adds to the tracker \</span>
<span class="sd">            for parameters. Note that LPGs can be inserted to track behaviour \</span>
<span class="sd">            either at the application graph level or at the machine graph \</span>
<span class="sd">            level, but not both at the same time.</span>

<span class="sd">        :param LivePacketGatherParameters live_packet_gatherer_params:</span>
<span class="sd">            params to look for a LPG</span>
<span class="sd">        :param ~pacman.model.graphs.AbstractVertex vertex_to_record_from:</span>
<span class="sd">            the vertex that needs to send to a given LPG</span>
<span class="sd">        :param list(str) partition_ids:</span>
<span class="sd">            the IDs of the partitions to connect from the vertex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">[</span><span class="n">live_packet_gatherer_params</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">vertex_to_record_from</span><span class="p">,</span> <span class="n">partition_ids</span><span class="p">))</span>

        <span class="c1"># verify that the vertices being added are of one vertex type.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex_to_record_from</span><span class="p">,</span> <span class="n">ApplicationVertex</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span> <span class="o">=</span> \
                    <span class="n">ApplicationVertex</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span> <span class="o">=</span> \
                    <span class="n">MachineVertex</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">vertex_to_record_from</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorders_associated_vertex_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Only one type of graph can be used during live output. &quot;</span>
                <span class="s2">&quot;Please fix and try again&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.set_up_machine_specifics"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.set_up_machine_specifics">[docs]</a>    <span class="k">def</span> <span class="nf">set_up_machine_specifics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hostname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds machine specifics for the different modes of execution.</span>

<span class="sd">        :param str hostname: machine name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">hostname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="o">=</span> <span class="n">hostname</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The machine name from setup call is overriding &quot;</span>
                           <span class="s2">&quot;the machine name defined in the config file&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;machine_name&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;spalloc_server&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;remote_spinnaker_url&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;See http://spinnakermanchester.github.io/spynnaker/&quot;</span>
                <span class="s2">&quot;PyNNOnSpinnakerInstall.html Configuration Section&quot;</span><span class="p">)</span>

        <span class="n">n_items_specified</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">n_items_specified</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">n_items_specified</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Only one of machineName, spalloc_server, &quot;</span>
                <span class="s2">&quot;remote_spinnaker_url and virtual_board should be specified &quot;</span>
                <span class="s2">&quot;in your configuration files&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;spalloc_user&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;A spalloc_user must be specified with a spalloc_server&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setup_java_caller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;use_java&quot;</span><span class="p">):</span>
            <span class="n">java_call</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;java_call&quot;</span><span class="p">)</span>
            <span class="n">java_spinnaker_path</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                <span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;java_spinnaker_path&quot;</span><span class="p">)</span>
            <span class="n">java_jar_path</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                <span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;java_jar_path&quot;</span><span class="p">)</span>
            <span class="n">java_properties</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                <span class="s2">&quot;Java&quot;</span><span class="p">,</span> <span class="s2">&quot;java_properties&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span> <span class="o">=</span> <span class="n">JavaCaller</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_json_folder</span><span class="p">,</span> <span class="n">java_call</span><span class="p">,</span> <span class="n">java_spinnaker_path</span><span class="p">,</span>
                <span class="n">java_properties</span><span class="p">,</span> <span class="n">java_jar_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__signal_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_signal</span><span class="p">,</span> <span class="n">_frame</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handles closing down of script via keyboard interrupt</span>

<span class="sd">        :param _signal: the signal received (ignored)</span>
<span class="sd">        :param _frame: frame executed in (ignored)</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If we are to raise the keyboard interrupt, do so</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raise_keyboard_interrupt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User has cancelled simulation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.exception_handler"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.exception_handler">[docs]</a>    <span class="k">def</span> <span class="nf">exception_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handler of exceptions</span>

<span class="sd">        :param type exctype: the type of exception received</span>
<span class="sd">        :param Exception value: the value of the exception</span>
<span class="sd">        :param traceback traceback_obj: the trace back stuff</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Shutdown on exception&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_except_hook</span><span class="p">(</span><span class="n">exctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback_obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.verify_not_running"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.verify_not_running">[docs]</a>    <span class="k">def</span> <span class="nf">verify_not_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Verify that the simulator is in a state where it can start running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">in</span> <span class="n">RUNNING_STATUS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Illegal call while a simulation is already running&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">in</span> <span class="n">SHUTDOWN_STATUS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Illegal call after simulation is shutdown&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_should_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the simulation should run.</span>

<span class="sd">        Will warn the user if there is no need to run</span>

<span class="sd">        :return: True if and only if one of the graphs has vertices in it</span>
<span class="sd">        :raises ConfigurationException: If the current state does not</span>
<span class="sd">            support a new run call</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_not_running</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Your graph has no vertices in it. &quot;</span>
            <span class="s2">&quot;Therefor the run call will exit immediately.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.run_until_complete"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.run_until_complete">[docs]</a>    <span class="k">def</span> <span class="nf">run_until_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Run a simulation until it completes</span>

<span class="sd">        :param int n_steps:</span>
<span class="sd">            If not None, this specifies that the simulation should be</span>
<span class="sd">            requested to run for the given number of steps.  The host will</span>
<span class="sd">            still wait until the simulation itself says it has completed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">sync_time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.run"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">,</span> <span class="n">sync_time</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Run a simulation for a fixed amount of time</span>

<span class="sd">        :param int run_time: the run duration in milliseconds.</span>
<span class="sd">        :param float sync_time:</span>
<span class="sd">            If not 0, this specifies that the simulation should pause after</span>
<span class="sd">            this duration.  The continue_simulation() method must then be</span>
<span class="sd">            called for the simulation to continue.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run</span><span class="p">(</span><span class="n">run_time</span><span class="p">,</span> <span class="n">sync_time</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_build_graphs_for_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;Illegal state where both original_application and &quot;</span>
                    <span class="s2">&quot;original machine graph have vertices in them&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_in_ms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get a number of timesteps for a given time in milliseconds.</span>

<span class="sd">        :return: The number of timesteps</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_time_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">time_in_ms</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span><span class="p">))</span>
        <span class="n">calc_time</span> <span class="o">=</span> <span class="n">n_time_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span>

        <span class="c1"># Allow for minor float errors</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">time_in_ms</span> <span class="o">-</span> <span class="n">calc_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.00001</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Time of </span><span class="si">{}</span><span class="s2">ms &quot;</span>
                <span class="s2">&quot;is not a multiple of the machine time step of </span><span class="si">{}</span><span class="s2">ms &quot;</span>
                <span class="s2">&quot;and has therefore been rounded up to </span><span class="si">{}</span><span class="s2">ms&quot;</span><span class="p">,</span>
                <span class="n">time_in_ms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span><span class="p">,</span> <span class="n">calc_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n_time_steps</span>

    <span class="k">def</span> <span class="nf">_calc_run_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates n_machine_time_steps and total_run_time based on run_time\</span>
<span class="sd">        and machine_time_step</span>

<span class="sd">        This method rounds the run up to the next timestep as discussed in\</span>
<span class="sd">        https://github.com/SpiNNakerManchester/sPyNNaker/issues/149</span>

<span class="sd">        If run_time is None (run forever) both values will be None</span>

<span class="sd">        :param run_time: time user requested to run for in milliseconds</span>
<span class="sd">        :type run_time: float or None</span>
<span class="sd">        :return: n_machine_time_steps as a whole int and</span>
<span class="sd">            total_run_time in milliseconds</span>
<span class="sd">        :rtype: tuple(int,float) or tuple(None,None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">run_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">n_machine_time_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timesteps</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>
        <span class="n">total_run_timesteps</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">+</span> <span class="n">n_machine_time_steps</span><span class="p">)</span>
        <span class="n">total_run_time</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">total_run_timesteps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span> <span class="o">*</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_scale_factor</span><span class="p">)</span>

        <span class="c1"># Convert dt into microseconds and multiply by</span>
        <span class="c1"># scale factor to get hardware timestep</span>
        <span class="n">hardware_timestep_us</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_scale_factor</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Simulating for </span><span class="si">{</span><span class="n">n_machine_time_steps</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span><span class="si">}</span><span class="s2">ms timesteps using a &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;hardware timestep of </span><span class="si">{</span><span class="n">hardware_timestep_us</span><span class="si">}</span><span class="s2">us&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">,</span> <span class="n">sync_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The main internal run function.</span>

<span class="sd">        :param int run_time: the run duration in milliseconds.</span>
<span class="sd">        :param int sync_time:</span>
<span class="sd">            the time in ms between synchronisations, or 0 to disable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_run</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="c1"># verify that we can keep doing auto pause and resume</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="n">can_keep_running</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                <span class="n">executable_type</span><span class="o">.</span><span class="n">supports_auto_pause_and_resume</span>
                <span class="k">for</span> <span class="n">executable_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">can_keep_running</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Only binaries that use the simulation interface can be&quot;</span>
                    <span class="s2">&quot; run more than once&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">IN_RUN</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_config</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>

        <span class="c1"># Install the Control-C handler</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">(),</span> <span class="n">threading</span><span class="o">.</span><span class="n">_MainThread</span><span class="p">):</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__signal_handler</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_keyboard_interrupt</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_except_hook</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting execution process&quot;</span><span class="p">)</span>

        <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">total_run_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_run_time</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span><span class="o">.</span><span class="n">extend_allocation</span><span class="p">(</span>
                <span class="n">total_run_time</span><span class="p">)</span>

        <span class="n">n_sync_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timesteps</span><span class="p">(</span><span class="n">sync_time</span><span class="p">)</span>

        <span class="c1"># If we have never run before, or the graph has changed,</span>
        <span class="c1"># start by performing mapping</span>
        <span class="n">graph_changed</span><span class="p">,</span> <span class="n">data_changed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_if_graph_has_changed</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">graph_changed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;The network cannot be changed between runs without&quot;</span>
                <span class="s2">&quot; resetting&quot;</span><span class="p">)</span>

        <span class="c1"># If we have reset and the graph has changed, stop any running</span>
        <span class="c1"># application</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">graph_changed</span> <span class="ow">or</span> <span class="n">data_changed</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">stop_application</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># build the graphs to modify with system requirements</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">or</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="c1"># Reset the machine if the graph has changed</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                <span class="c1"># wipe out stuff associated with a given machine, as these need</span>
                <span class="c1"># to be rebuilt.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_new_run_clear</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_accessed_machine</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_machine_clear</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
                <span class="c1"># create new sub-folder for reporting data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_up_output_folders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_build_graphs_for_usage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_dependent_verts_and_edges_for_application_graph</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_commands_to_command_sender</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;use_auto_pause_and_resume&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
                    <span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;minimum_auto_time_steps&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span> <span class="o">=</span> <span class="n">n_machine_time_steps</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_known_machine</span><span class="p">(</span><span class="n">total_run_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_execute_get_max_machine</span><span class="p">(</span><span class="n">total_run_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_mapping</span><span class="p">(</span><span class="n">total_run_time</span><span class="p">)</span>

        <span class="c1"># Check if anything has per-timestep SDRAM usage</span>
        <span class="n">provide_injectables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">is_per_timestep_sdram</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_per_timestep_sdram</span><span class="p">()</span>

        <span class="c1"># Disable auto pause and resume if the binary can&#39;t do it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">executable_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">executable_type</span><span class="o">.</span><span class="n">supports_auto_pause_and_resume</span><span class="p">:</span>
                    <span class="n">set_config</span><span class="p">(</span>
                        <span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;use_auto_pause_and_resume&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>

        <span class="c1"># Work out the maximum run duration given all recordings</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deduce_data_n_timesteps</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">)</span>
        <span class="n">clear_injectables</span><span class="p">()</span>

        <span class="c1"># Work out an array of timesteps to perform</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;use_auto_pause_and_resume&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_per_timestep_sdram</span><span class="p">):</span>

            <span class="c1"># Runs should only be in units of max_run_time_steps at most</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">is_per_timestep_sdram</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span> <span class="o">&lt;</span> <span class="n">n_machine_time_steps</span> <span class="ow">or</span>
                        <span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">FINISHED</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="s2">&quot;The SDRAM required by one or more vertices is based on&quot;</span>
                    <span class="s2">&quot; the run time, so the run time is limited to&quot;</span>
                    <span class="s2">&quot; </span><span class="si">{}</span><span class="s2"> time steps&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">))</span>

            <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_machine_time_steps</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">run_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="c1"># With auto pause and resume, any time step is possible but run</span>
            <span class="c1"># time more than the first will guarantee that run will be called</span>
            <span class="c1"># more than once</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_steps</span><span class="p">(</span>
                <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">)</span>

        <span class="c1"># If we have never run before, or the graph has changed, or data has</span>
        <span class="c1"># been changed, generate and load the data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">or</span> <span class="n">graph_changed</span> <span class="ow">or</span> <span class="n">data_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_data_generation</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_do_load</span><span class="p">(</span><span class="n">graph_changed</span><span class="p">)</span>

        <span class="c1"># Run for each of the given steps</span>
        <span class="k">if</span> <span class="n">run_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running for </span><span class="si">{}</span><span class="s2"> steps for a total of </span><span class="si">{}</span><span class="s2">ms&quot;</span><span class="p">,</span>
                        <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">),</span> <span class="n">run_time</span><span class="p">)</span>
            <span class="k">for</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run </span><span class="si">{}</span><span class="s2"> of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">steps</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">run_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running until complete&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Buffers&quot;</span><span class="p">,</span> <span class="s2">&quot;use_auto_pause_and_resume&quot;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="ow">not</span> <span class="n">is_per_timestep_sdram</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running forever&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for stop request&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span><span class="p">:</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">!=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">STOP_REQUESTED</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running forever in steps of </span><span class="si">{}</span><span class="s2">ms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">!=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">STOP_REQUESTED</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Run </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_run</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Indicate that the signal handler needs to act</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">(),</span> <span class="n">threading</span><span class="o">.</span><span class="n">_MainThread</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raise_keyboard_interrupt</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_except_hook</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exception_handler</span>

        <span class="c1"># update counter for runs (used by reports and app data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">FINISHED</span>

    <span class="k">def</span> <span class="nf">_is_per_timestep_sdram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="o">.</span><span class="n">placements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">placement</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">resources_required</span><span class="o">.</span><span class="n">sdram</span><span class="o">.</span><span class="n">per_timestep</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_add_commands_to_command_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">command_sender</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">vertices</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span>
        <span class="n">command_sender_vertex</span> <span class="o">=</span> <span class="n">CommandSender</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="o">.</span><span class="n">vertices</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span>
            <span class="n">command_sender_vertex</span> <span class="o">=</span> <span class="n">CommandSenderMachineVertex</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">AbstractSendMeMulticastCommandsVertex</span><span class="p">):</span>
                <span class="c1"># if there&#39;s no command sender yet, build one</span>
                <span class="k">if</span> <span class="n">command_sender</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">command_sender</span> <span class="o">=</span> <span class="n">command_sender_vertex</span><span class="p">(</span>
                        <span class="s2">&quot;auto_added_command_sender&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">command_sender</span><span class="p">)</span>

                <span class="c1"># allow the command sender to create key to partition map</span>
                <span class="n">command_sender</span><span class="o">.</span><span class="n">add_commands</span><span class="p">(</span>
                    <span class="n">vertex</span><span class="o">.</span><span class="n">start_resume_commands</span><span class="p">,</span>
                    <span class="n">vertex</span><span class="o">.</span><span class="n">pause_stop_commands</span><span class="p">,</span>
                    <span class="n">vertex</span><span class="o">.</span><span class="n">timed_commands</span><span class="p">,</span> <span class="n">vertex</span><span class="p">)</span>

        <span class="c1"># add the edges from the command sender to the dependent vertices</span>
        <span class="k">if</span> <span class="n">command_sender</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edges</span><span class="p">,</span> <span class="n">partition_ids</span> <span class="o">=</span> <span class="n">command_sender</span><span class="o">.</span><span class="n">edges_and_partitions</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">partition_id</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">partition_ids</span><span class="p">):</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">partition_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_dependent_verts_and_edges_for_application_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
            <span class="c1"># add any dependent edges and vertices if needed</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">AbstractVertexWithEdgeToDependentVertices</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">dependant_vertex</span> <span class="ow">in</span> <span class="n">vertex</span><span class="o">.</span><span class="n">dependent_vertices</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">dependant_vertex</span><span class="p">)</span>
                    <span class="n">edge_partition_ids</span> <span class="o">=</span> <span class="n">vertex</span><span class="o">.</span>\
                        <span class="n">edge_partition_identifiers_for_dependent_vertex</span><span class="p">(</span>
                            <span class="n">dependant_vertex</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">edge_identifier</span> <span class="ow">in</span> <span class="n">edge_partition_ids</span><span class="p">:</span>
                        <span class="n">dependant_edge</span> <span class="o">=</span> <span class="n">ApplicationEdge</span><span class="p">(</span>
                            <span class="n">pre_vertex</span><span class="o">=</span><span class="n">vertex</span><span class="p">,</span> <span class="n">post_vertex</span><span class="o">=</span><span class="n">dependant_vertex</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                            <span class="n">dependant_edge</span><span class="p">,</span> <span class="n">edge_identifier</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_deduce_data_n_timesteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">machine_graph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Operates the auto pause and resume functionality by figuring out\</span>
<span class="sd">            how many timer ticks a simulation can run before SDRAM runs out,\</span>
<span class="sd">            and breaks simulation into chunks of that long.</span>

<span class="sd">        :param ~.MachineGraph machine_graph:</span>
<span class="sd">        :return: max time a simulation can run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Go through the placements and find how much SDRAM is used</span>
        <span class="c1"># on each chip</span>
        <span class="n">usage_by_chip</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">seen_partitions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">placement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="o">.</span><span class="n">placements</span><span class="p">:</span>
            <span class="n">sdram_required</span> <span class="o">=</span> <span class="n">placement</span><span class="o">.</span><span class="n">vertex</span><span class="o">.</span><span class="n">resources_required</span><span class="o">.</span><span class="n">sdram</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">placement</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">placement</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">usage_by_chip</span><span class="p">:</span>
                <span class="n">usage_by_chip</span><span class="p">[</span><span class="n">placement</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">placement</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sdram_required</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">usage_by_chip</span><span class="p">[</span><span class="n">placement</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">placement</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">sdram_required</span>

            <span class="c1"># add sdram partitions</span>
            <span class="n">sdram_partitions</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">machine_graph</span><span class="o">.</span><span class="n">get_sdram_edge_partitions_starting_at_vertex</span><span class="p">(</span>
                    <span class="n">placement</span><span class="o">.</span><span class="n">vertex</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">sdram_partitions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">partition</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_partitions</span><span class="p">:</span>
                    <span class="n">usage_by_chip</span><span class="p">[</span><span class="n">placement</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">placement</span><span class="o">.</span><span class="n">y</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="n">ConstantSDRAM</span><span class="p">(</span>
                            <span class="n">partition</span><span class="o">.</span><span class="n">total_sdram_requirements</span><span class="p">()</span> <span class="o">+</span>
                            <span class="n">SARK_PER_MALLOC_SDRAM_USAGE</span><span class="p">))</span>
                    <span class="n">seen_partitions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>

        <span class="c1"># Go through the chips and divide up the remaining SDRAM, finding</span>
        <span class="c1"># the minimum number of machine timesteps to assign</span>
        <span class="n">max_time_steps</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">sdram</span> <span class="ow">in</span> <span class="n">usage_by_chip</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">get_chip_at</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">sdram</span><span class="o">.</span><span class="n">size</span>
            <span class="k">if</span> <span class="n">sdram</span><span class="o">.</span><span class="n">per_timestep</span><span class="p">:</span>
                <span class="n">max_this_chip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">size</span> <span class="o">-</span> <span class="n">sdram</span><span class="o">.</span><span class="n">fixed</span><span class="p">)</span> <span class="o">//</span> <span class="n">sdram</span><span class="o">.</span><span class="n">per_timestep</span><span class="p">)</span>
                <span class="n">max_time_steps</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_time_steps</span><span class="p">,</span> <span class="n">max_this_chip</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">max_time_steps</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_generate_steps</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">n_steps_per_segment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generates the list of &quot;timer&quot; runs. These are usually in terms of\</span>
<span class="sd">            time steps, but need not be.</span>

<span class="sd">        :param int n_steps: the total runtime in machine time steps</span>
<span class="sd">        :param int n_steps_per_segment: the minimum allowed per chunk</span>
<span class="sd">        :return: list of time step lengths</span>
<span class="sd">        :rtype: list(int)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n_full_iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n_steps</span> <span class="o">/</span> <span class="n">n_steps_per_segment</span><span class="p">))</span>
        <span class="n">left_over_steps</span> <span class="o">=</span> <span class="n">n_steps</span> <span class="o">-</span> <span class="n">n_full_iterations</span> <span class="o">*</span> <span class="n">n_steps_per_segment</span>
        <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n_steps_per_segment</span><span class="p">)]</span> <span class="o">*</span> <span class="n">n_full_iterations</span>
        <span class="k">if</span> <span class="n">left_over_steps</span><span class="p">:</span>
            <span class="n">steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">left_over_steps</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">steps</span>

    <span class="k">def</span> <span class="nf">_calculate_number_of_machine_time_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_run_timesteps</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">next_run_timesteps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">total_timesteps</span> <span class="o">=</span> <span class="n">next_run_timesteps</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span>
            <span class="k">return</span> <span class="n">total_timesteps</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_execute_get_virtual_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the VirtualMachineGenerator if required</span>

<span class="sd">        May set then &quot;machine&quot; value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">GET_MACHINE</span><span class="p">,</span> <span class="s2">&quot;Virtual machine generator&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="n">virtual_machine_generator</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_execute_allocator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the SpallocAllocator or HBPAllocator if required</span>

<span class="sd">        :param str category: Algorithm category for provenance</span>
<span class="sd">        :param total_run_time: The total run time to request</span>
<span class="sd">        type total_run_time: int or None</span>
<span class="sd">        :return: machine name, machine version, BMP details (if any),</span>
<span class="sd">            reset on startup flag, auto-detect BMP, SCAMP connection details,</span>
<span class="sd">            boot port, allocation controller</span>
<span class="sd">        :rtype: tuple(str, int, object, bool, bool, object, object,</span>
<span class="sd">            MachineAllocationController)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_needed</span><span class="p">:</span>
            <span class="n">n_chips_required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_needed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_chips_required</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_required</span>
        <span class="k">if</span> <span class="n">n_chips_required</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="s2">&quot;SpallocAllocator&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">spalloc_allocator</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span><span class="p">,</span> <span class="n">n_chips_required</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="s2">&quot;HBPAllocator&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">hbp_allocator</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">,</span>
                    <span class="n">n_chips_required</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_boards_required</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_machine_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">allocator_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the MachineGenerator if required</span>

<span class="sd">        May set the &quot;machine&quot; value if not already set</span>

<span class="sd">        :param str category: Algorithm category for provenance</span>
<span class="sd">        :allocator_data: None or</span>
<span class="sd">            (machine name, machine version, BMP details (if any),</span>
<span class="sd">            reset on startup flag, auto-detect BMP, SCAMP connection details,</span>
<span class="sd">            boot port, allocation controller)</span>
<span class="sd">        :type allocator_data: None or</span>
<span class="sd">            tuple(str, int, object, bool, bool, object, object,</span>
<span class="sd">            MachineAllocationController)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span>
            <span class="n">bmp_details</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;bmp_names&quot;</span><span class="p">)</span>
            <span class="n">auto_detect_bmp</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;auto_detect_bmp&quot;</span><span class="p">)</span>
            <span class="n">scamp_connection_data</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;scamp_connections_data&quot;</span><span class="p">)</span>
            <span class="n">boot_port_num</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;boot_connection_port_num&quot;</span><span class="p">)</span>
            <span class="n">reset_machine</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;reset_machine_on_startup&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_board_version</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">allocator_data</span><span class="p">:</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_board_version</span><span class="p">,</span> <span class="n">bmp_details</span><span class="p">,</span>
             <span class="n">reset_machine</span><span class="p">,</span> <span class="n">auto_detect_bmp</span><span class="p">,</span> <span class="n">scamp_connection_data</span><span class="p">,</span>
             <span class="n">boot_port_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span>
             <span class="p">)</span> <span class="o">=</span> <span class="n">allocator_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="s2">&quot;Machine generator&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="n">machine_generator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="n">bmp_details</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_board_version</span><span class="p">,</span>
                <span class="n">auto_detect_bmp</span><span class="p">,</span> <span class="n">scamp_connection_data</span><span class="p">,</span> <span class="n">boot_port_num</span><span class="p">,</span>
                <span class="n">reset_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_get_max_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the a MaxMachineGenerator if required</span>

<span class="sd">        Will set the &quot;machine&quot; value if not already set</span>

<span class="sd">        Sets the _max_machine to True if the &quot;machine&quot; value is a temporary</span>
<span class="sd">        max machine.</span>

<span class="sd">        :param total_run_time: The total run time to request</span>
<span class="sd">        :type total_run_time: int or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">:</span>
            <span class="c1"># Leave _max_machine as is a may be true from an earlier call</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_max_machine</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">GET_MACHINE</span><span class="p">,</span> <span class="s2">&quot;Spalloc max machine generator&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="n">spalloc_max_machine_generator</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">GET_MACHINE</span><span class="p">,</span> <span class="s2">&quot;HBPMaxMachineGenerator&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="n">hbp_max_machine_generator</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No machine generataion possible&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_known_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_run_time</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The python machine description object.</span>

<span class="sd">        :param float total_run_time: The total run time to request</span>
<span class="sd">        :rtype: ~spinn_machine.Machine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="o">=</span> <span class="n">ALANS_DEFAULT_RANDOM_APP_ID</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">app_id_tracker</span><span class="o">.</span><span class="n">get_new_id</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_execute_get_virtual_machine</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">allocator_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_allocator</span><span class="p">(</span>
                    <span class="n">GET_MACHINE</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_execute_machine_generator</span><span class="p">(</span><span class="n">GET_MACHINE</span><span class="p">,</span> <span class="n">allocator_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_run_time</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The python machine description object.</span>

<span class="sd">        :param bool max: If True will produce a max machine if required</span>
<span class="sd">        :param float total_run_time: The total run time to request</span>
<span class="sd">        :rtype: ~spinn_machine.Machine</span>
<span class="sd">        :raise Exception: No known size machine possible</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_accessed_machine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_known_machine</span><span class="p">(</span><span class="n">total_run_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_accessed_machine</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Not enough information provided to supply a machine&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_version_provenance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add the version information to the provenance data at the start.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">ProvenanceWriter</span><span class="p">()</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;spinn_utilities_version&quot;</span><span class="p">,</span> <span class="n">spinn_utils_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;spinn_machine_version&quot;</span><span class="p">,</span> <span class="n">spinn_machine_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;spalloc_version&quot;</span><span class="p">,</span> <span class="n">spalloc_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;spinnman_version&quot;</span><span class="p">,</span> <span class="n">spinnman_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;pacman_version&quot;</span><span class="p">,</span> <span class="n">pacman_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;data_specification_version&quot;</span><span class="p">,</span> <span class="n">data_spec_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;front_end_common_version&quot;</span><span class="p">,</span> <span class="n">fec_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;numpy_version&quot;</span><span class="p">,</span> <span class="n">numpy_version</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_version</span><span class="p">(</span><span class="s2">&quot;scipy_version&quot;</span><span class="p">,</span> <span class="n">scipy_version</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_extra_mapping_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows overriding classes to add algorithms</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_json_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs WriteJsonMachine if required</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Json machine&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_machine&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">write_json_machine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_folder</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_network_specification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the Network Specification report is requested</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Network Specification report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_network_specification_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span>
            <span class="n">network_specification</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_chip_id_allocator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the ChipIdAllocator</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Chip ID allocator&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span>
            <span class="n">malloc_based_chip_id_allocator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
            <span class="c1"># return ignored as changes done inside original machine object</span>

    <span class="k">def</span> <span class="nf">_execute_insert_live_packet_gatherers_to_graphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the InsertLivePacketGatherersToGraphs if required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span>
                <span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Insert live packet gatherers to graphs&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">,</span>
                                   <span class="s2">&quot;live_packet_recorder_params&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_parameters_mapping</span> <span class="o">=</span> \
                <span class="n">insert_live_packet_gatherers_to_graphs</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_board_chip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the BoardChipReport is requested</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Board chip report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_board_chip_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">board_chip_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_splitter_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the splitter_reset</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Splitter reset&quot;</span><span class="p">):</span>
            <span class="n">splitter_reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="c1"># Overriden by spynaker to choose an extended algorithm</span>
    <span class="k">def</span> <span class="nf">_execute_splitter_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the SplitterSelector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Splitter selector&quot;</span><span class="p">):</span>
            <span class="n">splitter_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_delay_support_adder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stub to allow spynakker to add delay supports</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_execute_preallocate_for_live_packet_gatherer</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">pre_allocated_resources</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the PreAllocateResourcesForLivePacketGatherers if\</span>
<span class="sd">        required</span>

<span class="sd">        :param pre_allocated_resources: other preallocated resources</span>
<span class="sd">        :type pre_allocated_resources:</span>
<span class="sd">            ~pacman.model.resources.PreAllocatedResourceContainer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span>
                <span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Preallocate for live packet gatherer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">,</span>
                                   <span class="s2">&quot;live_packet_recorder_params&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">preallocate_resources_for_live_packet_gatherers</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="n">pre_allocated_resources</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_preallocate_for_chip_power_monitor</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">pre_allocated_resources</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the PreAllocateResourcesForChipPowerMonitor if\</span>
<span class="sd">        required</span>

<span class="sd">        :param pre_allocated_resources: other preallocated resources</span>
<span class="sd">        :type pre_allocated_resources:</span>
<span class="sd">            ~pacman.model.resources.PreAllocatedResourceContainer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Preallocate for chip power monitor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">preallocate_resources_for_chip_power_monitor</span><span class="p">(</span>
                <span class="n">pre_allocated_resources</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_preallocate_for_extra_monitor_support</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">pre_allocated_resources</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the PreAllocateResourcesForExtraMonitorSupport if\</span>
<span class="sd">        required</span>

<span class="sd">        :param pre_allocated_resources: other preallocated resources</span>
<span class="sd">        :type pre_allocated_resources:</span>
<span class="sd">            ~pacman.model.resources.PreAllocatedResourceContainer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Preallocate for extra monitor support&quot;</span><span class="p">)</span> \
                <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfgs_false</span><span class="p">(</span>
                    <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">pre_allocate_resources_for_extra_monitor_support</span><span class="p">(</span>
                <span class="n">pre_allocated_resources</span><span class="p">)</span>

    <span class="c1"># Overriden by spynaker to choose a different algorithm</span>
    <span class="k">def</span> <span class="nf">_execute_splitter_partitioner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_allocated_resources</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the SplitterPartitioner if\</span>
<span class="sd">        required</span>

<span class="sd">        :param pre_allocated_resources: other preallocated resources</span>
<span class="sd">        :type pre_allocated_resources:</span>
<span class="sd">            ~pacman.model.resources.PreAllocatedResourceContainer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Splitter partitioner&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_needed</span> <span class="o">=</span> <span class="n">splitter_partitioner</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span><span class="p">,</span>
                <span class="n">pre_allocated_resources</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_graph_measurer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs GraphMeasurer is required</span>

<span class="sd">        Sets self._n_chips_needed if no machine exists</span>

<span class="sd">        Warning if the users has specified a machine size he gets what he</span>
<span class="sd">        asks for and if it is too small the placer will tell him.</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_machine</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Graph measurer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_n_chips_needed</span> <span class="o">=</span> <span class="n">graph_measurer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_insert_chip_power_monitors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run, time and log the InsertChipPowerMonitorsToGraphs if required</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Insert chip power monitors&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">insert_chip_power_monitors_to_graphs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span>
                <span class="n">get_config_int</span><span class="p">(</span><span class="s2">&quot;EnergyMonitor&quot;</span><span class="p">,</span> <span class="s2">&quot;sampling_frequency&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_insert_extra_monitor_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run, time and log the InsertExtraMonitorVerticesToGraphs if required</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Insert extra monitor vertices&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfgs_false</span><span class="p">(</span>
                    <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="c1"># inserter checks for None app graph not an empty one</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vertex_to_ethernet_connected_chip_mapping</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_vertices</span><span class="p">,</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_to_chip_mapping</span><span class="p">)</span> <span class="o">=</span> \
            <span class="n">insert_extra_monitor_vertices_to_graphs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_partitioner_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write, times and logs the partitioner_report if needed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Partitioner report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_partitioner_reports&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">partitioner_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_edge_to_n_keys_mapper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the EdgeToNKeysMapper</span>

<span class="sd">        Sets the &quot;machine_partition_n_keys_map&quot; data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Edge to n keys mapper&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span> <span class="o">=</span> <span class="n">edge_to_n_keys_mapper</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_local_tdma_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs times and logs the LocalTDMABuilder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Local TDMA builder&quot;</span><span class="p">):</span>
            <span class="n">local_tdma_builder</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_json_partition_n_keys_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes, times and logs the machine_partition_n_keys_map if required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Json partition n keys map&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_partition_n_keys_map&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">write_json_partition_n_keys_map</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_folder</span><span class="p">)</span>
            <span class="c1"># Output ignored as never used</span>

    <span class="k">def</span> <span class="nf">_execute_connective_based_placer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the ConnectiveBasedPlacer</span>

<span class="sd">        Sets the &quot;placements&quot; data</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg placer value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Connective based placer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span> <span class="o">=</span> <span class="n">connective_based_placer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_one_to_one_placer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the OneToOnePlacer</span>

<span class="sd">        Sets the &quot;placements&quot; data</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg placer value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;One to one placer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span> <span class="o">=</span> <span class="n">one_to_one_placer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_radial_placer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the RadialPlacer</span>

<span class="sd">        Sets the &quot;placements&quot; data</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg placer value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Radial placer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span> <span class="o">=</span> <span class="n">radial_placer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_speader_placer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the SpreaderPlacer</span>

<span class="sd">        Sets the &quot;placements&quot; data</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg placer value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Spreader placer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span> <span class="o">=</span> <span class="n">spreader_placer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_placer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs one of the placers</span>

<span class="sd">        Sets the &quot;placements&quot; data</span>

<span class="sd">        Which placer is run depends on the cfg placer value</span>

<span class="sd">        This method is the entry point for adding a new Placer</span>

<span class="sd">        :raise ConfigurationException: if the cfg place value is unexpected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;placer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ConnectiveBasedPlacer&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_connective_based_placer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;OneToOnePlacer&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_one_to_one_placer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RadialPlacer&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_radial_placer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;SpreaderPlacer&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_speader_placer</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Only a single algorithm is supported for placer&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected cfg setting placer: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_insert_edges_to_live_packet_gatherers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the InsertEdgesToLivePacketGatherers if required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span>
                <span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Insert edges to live packet gatherers&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">,</span>
                                   <span class="s2">&quot;live_packet_recorder_params&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">insert_edges_to_live_packet_gatherers</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_live_packet_recorder_parameters_mapping</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_insert_edges_to_extra_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs times and logs the InsertEdgesToExtraMonitor is required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Insert Edges To Extra Monitor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfgs_false</span><span class="p">(</span>
                    <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">insert_edges_to_extra_monitor_functionality</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_to_ethernet_connected_chip_mapping</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_system_multicast_routing_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the SystemMulticastRoutingGenerator is required</span>

<span class="sd">        May sets the data &quot;data_in_multicast_routing_tables&quot;,</span>
<span class="sd">        &quot;data_in_multicast_key_to_chip_map&quot; and</span>
<span class="sd">        &quot;system_multicast_router_timeout_keys&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;System multicast routing generator&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfgs_false</span><span class="p">(</span>
                    <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data_in_multicast_routing_tables</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_data_in_multicast_key_to_chip_map</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_system_multicast_router_timeout_keys</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">system_multicast_routing_generator</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_to_chip_mapping</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_execute_fixed_route_router</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the FixedRouteRouter if required</span>

<span class="sd">        May set the &quot;fixed_routes&quot; data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Fixed route router&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_routes</span> <span class="o">=</span> <span class="n">fixed_route_router</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span>
                <span class="n">DataSpeedUpPacketGatherMachineVertex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_placements_with_application_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes, times and logs the application graph placer report if</span>
<span class="sd">        requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span>
                <span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Placements wth application graph report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_application_graph_placer_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">placer_reports_with_application_graph</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_placements_with_machine_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes, times and logs the machine graph placer report if</span>
<span class="sd">        requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Placements wthout machine graaph&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_machine_graph_placer_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">placer_reports_without_application_graph</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_json_placements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Does, times and logs the writing of placements as json if requested</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Json placements&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_placements&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">write_json_placements</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_folder</span><span class="p">)</span>
            <span class="c1"># Output ignored as never used</span>

    <span class="k">def</span> <span class="nf">_execute_ner_route_traffic_aware</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the NerRouteTrafficAware</span>

<span class="sd">        Sets the &quot;routing_table_by_partition&quot; data if called</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg router value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Ner route traffic aware&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_table_by_partition</span> <span class="o">=</span> <span class="n">ner_route_traffic_aware</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_ner_route</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the NerRoute</span>

<span class="sd">        Sets the &quot;routing_table_by_partition&quot; data</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg router value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Ner route&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_table_by_partition</span> <span class="o">=</span> <span class="n">ner_route</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_basic_dijkstra_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the BasicDijkstraRouting</span>

<span class="sd">        Sets the &quot;routing_table_by_partition&quot; data if called</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg router value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Basic dijkstra routing&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_table_by_partition</span> <span class="o">=</span> <span class="n">basic_dijkstra_routing</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs one of the routers</span>

<span class="sd">        Sets the &quot;routing_table_by_partition&quot; data</span>

<span class="sd">        Which router is run depends on the cfg router value</span>

<span class="sd">        This method is the entry point for adding a new Router</span>

<span class="sd">        :raise ConfigurationException: if the cfg router value is unexpected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;router&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;BasicDijkstraRouting&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_basic_dijkstra_routing</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;NerRoute&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_ner_route</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;NerRouteTrafficAware&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_ner_route_traffic_aware</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Only a single algorithm is supported for router&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected cfg setting router: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_basic_tag_allocator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the Tag Allocator</span>

<span class="sd">        Sets the &quot;tag&quot; data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Basic tag allocator&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="n">basic_tag_allocator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_tag_allocations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write, times and logs the tag allocator report if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Tag allocator report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_tag_allocation_reports&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">tag_allocator_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_process_partition_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the ProcessPartitionConstraints</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Process partition constraints&quot;</span><span class="p">):</span>
            <span class="n">process_partition_constraints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_global_allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the Global Zoned Routing Info Allocator</span>

<span class="sd">        Sets &quot;routing_info&quot; is called</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg info_allocator value</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Global allocate&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span> <span class="o">=</span> <span class="n">global_allocate</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_flexible_allocate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the Zoned Routing Info Allocator</span>

<span class="sd">        Sets &quot;routing_info&quot; is called</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg info_allocator value</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Zoned routing info allocator&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span> <span class="o">=</span> <span class="n">flexible_allocate</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_malloc_based_routing_info_allocator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the Malloc Based Routing Info Allocator</span>

<span class="sd">        Sets &quot;routing_info&quot; is called</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg info_allocator value</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Malloc based routing info allocator&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span> <span class="o">=</span> <span class="n">malloc_based_routing_info_allocator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.do_info_allocator"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.do_info_allocator">[docs]</a>    <span class="k">def</span> <span class="nf">do_info_allocator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs one of the info allocaters</span>

<span class="sd">        Sets the &quot;routing_info&quot; data</span>

<span class="sd">        Which alloactor is run depends on the cfg info_allocator value</span>

<span class="sd">        This method is the entry point for adding a new Info Allocator</span>

<span class="sd">        :raise ConfigurationException: if the cfg info_allocator value is</span>
<span class="sd">            unexpected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;info_allocator&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;GlobalZonedRoutingInfoAllocator &quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_global_allocate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;MallocBasedRoutingInfoAllocator&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_malloc_based_routing_info_allocator</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ZonedRoutingInfoAllocator&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_flexible_allocate</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Only a single algorithm is supported for info_allocator&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected cfg setting info_allocator: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_report_router_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes, times and logs the router iinfo report if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Router info report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_router_info_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">routing_info_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_basic_routing_table_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the Routing Table Generator</span>

<span class="sd">        .. note::</span>
<span class="sd">            Currently no other Routing Table Generator supported.</span>
<span class="sd">            To add an additional Generator copy the pattern of do_placer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Basic routing table generator&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span> <span class="o">=</span> <span class="n">basic_routing_table_generator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_table_by_partition</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>
        <span class="c1"># TODO Nuke ZonedRoutingTableGenerator</span>

    <span class="k">def</span> <span class="nf">_report_routers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write, times and logs the router report if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Router report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_router_reports&quot;</span><span class="p">):</span>
                <span class="k">return</span>
        <span class="n">router_report_from_paths</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_router_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write, times and logs the router summary report if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Router summary report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_router_summary_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">router_summary_report</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_json_routing_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write, time and log the routing tables as json if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Json routing tables&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_json_routing_tables&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">write_json_routing_tables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_json_folder</span><span class="p">)</span>
            <span class="c1"># Output ignored as never used</span>

    <span class="k">def</span> <span class="nf">_report_router_collision_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write, time and log the router collision report</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Router collision potential report&quot;</span><span class="p">):</span>
            <span class="c1"># TODO cfg flag!</span>
            <span class="n">router_collision_potential_report</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_routing_table_by_partition</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_partition_n_keys_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_locate_executable_start_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs LocateExecutableStartType if required</span>

<span class="sd">        May set the executable_types data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Locate executable start type&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="c1"># TODO why skip if virtual ?</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span> <span class="o">=</span> <span class="n">locate_executable_start_type</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_buffer_manager_creator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run, times and logs the buffer manager creator if required</span>

<span class="sd">        May set the buffer_manager data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;Buffer manager creator&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="o">=</span> <span class="n">buffer_manager_creator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_vertices</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_to_chip_mapping</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_to_ethernet_connected_chip_mapping</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_routes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_sdram_outgoing_partition_allocator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the SDRAMOutgoingPartitionAllocator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="s2">&quot;SDRAM outgoing partition allocator&quot;</span><span class="p">):</span>
            <span class="c1"># Ok if transceiver = None</span>
            <span class="n">sdram_outgoing_partition_allocator</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs all the algorithms in the mapping stage</span>

<span class="sd">        :param float total_run_time:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># time the time it takes to do all pacman stuff</span>
        <span class="n">mapping_total_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="n">mapping_total_timer</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>
        <span class="n">provide_injectables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_java_caller</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_extra_mapping_algorithms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_network_specification</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_splitter_reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_splitter_selector</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_delay_support_adder</span><span class="p">()</span>
        <span class="n">pre_allocated_resources</span> <span class="o">=</span> <span class="n">PreAllocatedResourceContainer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_preallocate_for_live_packet_gatherer</span><span class="p">(</span>
            <span class="n">pre_allocated_resources</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_preallocate_for_chip_power_monitor</span><span class="p">(</span>
            <span class="n">pre_allocated_resources</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_preallocate_for_extra_monitor_support</span><span class="p">(</span>
            <span class="n">pre_allocated_resources</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_splitter_partitioner</span><span class="p">(</span><span class="n">pre_allocated_resources</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_graph_measurer</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_machine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_max_machine</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">allocator_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_allocator</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="n">total_run_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_machine_generator</span><span class="p">(</span><span class="n">MAPPING</span><span class="p">,</span> <span class="n">allocator_data</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_json_machine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_chip_id_allocator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_insert_live_packet_gatherers_to_graphs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_board_chip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_insert_chip_power_monitors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_insert_extra_monitor_vertices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_partitioner_report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_edge_to_n_keys_mapper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_local_tdma_builder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_json_partition_n_keys_map</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_placer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_insert_edges_to_live_packet_gatherers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_insert_edges_to_extra_monitor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_system_multicast_routing_generator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_fixed_route_router</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_placements_with_application_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_placements_with_machine_graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_json_placements</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_routing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_basic_tag_allocator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_tag_allocations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_process_partition_constraints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_info_allocator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_router_info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_basic_routing_table_generator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_routers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_router_summary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_json_routing_tables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_router_collision_potential</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_locate_executable_start_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_buffer_manager_creator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sdram_outgoing_partition_allocator</span><span class="p">()</span>

        <span class="n">clear_injectables</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">ProvenanceWriter</span><span class="p">()</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_category_timing</span><span class="p">(</span>
                <span class="n">MAPPING</span><span class="p">,</span> <span class="n">mapping_total_timer</span><span class="o">.</span><span class="n">take_sample</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span><span class="p">)</span>

    <span class="c1"># Overridden by spy which adds placement_order</span>
    <span class="k">def</span> <span class="nf">_execute_graph_data_specification_writer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times, and logs the GraphDataSpecificationWriter</span>

<span class="sd">        Sets the dsg_targets data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span>
                <span class="n">DATA_GENERATION</span><span class="p">,</span> <span class="s2">&quot;Graph data specification writer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_region_sizes</span> <span class="o">=</span> \
                <span class="n">graph_data_specification_writer</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_data_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, Times and logs the data generation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set up timing</span>
        <span class="n">data_gen_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="n">data_gen_timer</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_first_machine_time_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span>

        <span class="n">provide_injectables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_graph_data_specification_writer</span><span class="p">()</span>
        <span class="n">clear_injectables</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">ProvenanceWriter</span><span class="p">()</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_category_timing</span><span class="p">(</span>
                <span class="n">DATA_GENERATION</span><span class="p">,</span> <span class="n">data_gen_timer</span><span class="o">.</span><span class="n">take_sample</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_routing_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the RoutingSetup if required.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Routing setup&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="c1"># Only needs the x and y of chips with routing tables</span>
            <span class="n">routing_setup</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_graph_binary_gatherer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the GraphBinaryGatherer if required.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Graph binary gatherer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span> <span class="o">=</span> <span class="n">graph_binary_gatherer</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_virtual_board</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Ignoring exectable not found as using virtual&quot;</span><span class="p">)</span>
                    <span class="n">timer</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;exectable not found and virtual board&quot;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">_execute_host_bitfield_compressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the HostBasedBitFieldRouterCompressor</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg compressor or</span>
<span class="sd">            virtual_compressor value</span>

<span class="sd">        :return: CompressedRoutingTables</span>
<span class="sd">        :rtype: MulticastRoutingTables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span>
                <span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Host based bitfield router compressor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">compressed</span> <span class="o">=</span> <span class="n">host_based_bit_field_router_compressor</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">compressed</span>

    <span class="k">def</span> <span class="nf">_execute_machine_bitfield_ordered_covering_compressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the MachineBitFieldOrderedCoveringCompressor</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg compressor or</span>
<span class="sd">            virtual_compressor value</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span>
                <span class="n">LOADING</span><span class="p">,</span>
                <span class="s2">&quot;Machine bitfield ordered covering compressor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">machine_bit_field_ordered_covering_compressor</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_execute_machine_bitfield_pair_compressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the MachineBitFieldPairRouterCompressor</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg compressor or</span>
<span class="sd">            virtual_compressor value</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span>
                <span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Machine bitfield pair router compressor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">machine_bit_field_pair_router_compressor</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_execute_ordered_covering_compressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the OrderedCoveringCompressor</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg compressor or</span>
<span class="sd">            virtual_compressor value</span>

<span class="sd">        :return: CompressedRoutingTables</span>
<span class="sd">        :rtype: MulticastRoutingTables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Ordered covering compressor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_skipable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">):</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Tables already small enough&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span>
            <span class="n">compressed</span> <span class="o">=</span> <span class="n">ordered_covering_compressor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">compressed</span>

    <span class="k">def</span> <span class="nf">_execute_ordered_covering_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the ordered covering compressor on machine</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg compressor or</span>
<span class="sd">            virtual_compressor value</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Ordered covering compressor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_skipable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">):</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Tables already small enough&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span>
            <span class="n">ordered_covering_compression</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_execute_pair_compressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the PairCompressor</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg compressor or</span>
<span class="sd">            virtual_compressor value</span>

<span class="sd">        :return: CompressedRoutingTable</span>
<span class="sd">        :rtype: MulticastRoutingTables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Pair compressor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_skipable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">):</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Tables already small enough&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span>
            <span class="n">compressed</span> <span class="o">=</span> <span class="n">pair_compressor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">compressed</span>

    <span class="k">def</span> <span class="nf">_execute_pair_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the pair compressor on machine</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg compressor or</span>
<span class="sd">            virtual_compressor value</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Pair on chip router compression&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_skipable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">):</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Tables already small enough&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span>
            <span class="n">pair_compression</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_execute_pair_unordered_compressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the CheckedUnorderedPairCompressor</span>

<span class="sd">        .. note::</span>
<span class="sd">            Calling of this method is based on the cfg compressor or</span>
<span class="sd">            virtual_compressor value</span>

<span class="sd">        :return: CompressedRoutingTables</span>
<span class="sd">        :rtype: MulticastRoutingTables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Pair unordered compressor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_skipable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">):</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Tables already small enough&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span>
            <span class="n">compressed</span> <span class="o">=</span> <span class="n">pair_compressor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">compressed</span>

    <span class="k">def</span> <span class="nf">_compressor_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_virtual_board</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;virtual_compressor&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;As no virtual_compressor specified &quot;</span>
                            <span class="s2">&quot;using compressor setting&quot;</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;compressor&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;compressor&quot;</span><span class="p">)</span>
        <span class="n">pre_compress</span> <span class="o">=</span> <span class="s2">&quot;BitField&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">pre_compress</span>

    <span class="k">def</span> <span class="nf">_compression_skipable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tables</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;router_table_compress_as_far_as_possible&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">tables</span><span class="o">.</span><span class="n">max_number_of_entries</span> <span class="o">&lt;=</span> <span class="n">Machine</span><span class="o">.</span><span class="n">ROUTER_ENTRIES</span>

    <span class="k">def</span> <span class="nf">_execute_pre_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_compress</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pre_compress</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mapping&quot;</span><span class="p">,</span> <span class="s2">&quot;precompressor&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Ranged&quot;</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Ranged Compressor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compression_skipable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">):</span>
                        <span class="n">timer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;Tables already small enough&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span>
                        <span class="k">return</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span> <span class="o">=</span> <span class="n">range_compressor</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unexpected cfg setting precompressor: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_precompressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span>

    <span class="k">def</span> <span class="nf">_do_early_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls a compressor based on the name provided</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method is the entry point for adding a new compressor that</span>
<span class="sd">             can or must run early.</span>

<span class="sd">        :param str name: Name of a compressor</span>
<span class="sd">        :raise ConfigurationException: if the name is not expected</span>
<span class="sd">        :return: CompressedRoutingTables (likely to be None),</span>
<span class="sd">            RouterCompressorProvenanceItems (may be an empty list)</span>
<span class="sd">        :rtype: tuple(MulticastRoutingTables or None, list(ProvenanceDataItem))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;MachineBitFieldOrderedCoveringCompressor&quot;</span><span class="p">:</span>
            <span class="k">return</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_execute_machine_bitfield_ordered_covering_compressor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;MachineBitFieldPairRouterCompressor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_machine_bitfield_pair_compressor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;OrderedCoveringCompressor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_ordered_covering_compressor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;OrderedCoveringOnChipRouterCompression&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_ordered_covering_compression</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;PairCompressor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_pair_compressor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;PairOnChipRouterCompression&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_pair_compression</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;PairUnorderedCompressor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_pair_unordered_compressor</span><span class="p">()</span>

        <span class="c1"># delay compression until later</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_do_delayed_compression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">compressed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        run compression that must be delayed until later</span>

<span class="sd">        .. note::</span>
<span class="sd">            This method is the entry point for adding a new compressor that</span>
<span class="sd">            can not run at the normal place</span>

<span class="sd">        :param str name: Name of a compressor</span>
<span class="sd">        :raise ConfigurationException: if the name is not expected</span>
<span class="sd">        :return: CompressedRoutingTables (likely to be None),</span>
<span class="sd">            RouterCompressorProvenanceItems (may be an empty list)</span>
<span class="sd">        :rtype: tuple(MulticastRoutingTables or None, list(ProvenanceDataItem))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="ow">or</span> <span class="n">compressed</span><span class="p">:</span>
            <span class="c1"># Already compressed</span>
            <span class="k">return</span> <span class="n">compressed</span>
        <span class="c1"># overridden in spy to handle:</span>
        <span class="c1"># SpynnakerMachineBitFieldOrderedCoveringCompressor</span>
        <span class="c1"># SpynnakerMachineBitFieldPairRouterCompressor</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;HostBasedBitFieldRouterCompressor&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_host_bitfield_compressor</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Only a single algorithm is supported for compressor&quot;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected cfg setting compressor: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_load_routing_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compressed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the RoutingTableLoader if required</span>

<span class="sd">        :param compressed:</span>
<span class="sd">        :type compressed: MulticastRoutingTables or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">compressed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Routing table loader&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_multicast_routes_loaded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">routing_table_loader</span><span class="p">(</span>
                <span class="n">compressed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_uncompressed_routing_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the router report from router tables if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO why not during mapping?</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Uncompressed routing table report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_routing_table_reports&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">router_report_from_router_tables</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_bit_field_compressor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the BitFieldCompressorReport if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Bitfield compressor report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span>  <span class="s2">&quot;write_bit_field_compressor_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="c1"># BitFieldSummary output ignored as never used</span>
            <span class="n">bitfield_compressor_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_load_fixed_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs Load Fixed Routes is required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Load fixed routes&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">load_fixed_routes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fixed_routes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_system_data_specification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the execute_system_data_specs if required</span>

<span class="sd">        :return: map of placement and DSG data, and loaded data flag.</span>
<span class="sd">        :rtype: dict(tuple(int,int,int),DataWritten) or DsWriteInfo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Execute system data specification&quot;</span><span class="p">)</span> \
                <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">execute_system_data_specs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_targets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_region_sizes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_load_system_executable_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the loading of exectuable images</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Load executable system Images&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">load_sys_images</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_application_data_specification</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">processor_to_app_data_base_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the execute_application_data_specs if required</span>

<span class="sd">        :return: map of placement and DSG data, and loaded data flag.</span>
<span class="sd">        :rtype: dict(tuple(int,int,int),DataWritten) or DsWriteInfo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Host data specification&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">processor_to_app_data_base_address</span>
            <span class="k">return</span> <span class="n">execute_application_data_specs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dsg_targets</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_region_sizes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_vertices</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_vertex_to_ethernet_connected_chip_mapping</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_java_caller</span><span class="p">,</span> <span class="n">processor_to_app_data_base_address</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_tags_from_machine_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run, times and logs the TagsFromMachineReport if requested</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Tags from machine report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_tag_allocation_reports&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">tags_from_machine_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_load_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the Tags Loader if required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO why: if graph_changed or data_changed:</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Tags Loader&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">tags_loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_extra_load_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs any extra load algorithms</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_report_memory_on_host</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processor_to_app_data_base_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs MemoryMapOnHostReport is requested</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Memory report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_memory_map_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">memory_map_on_host_report</span><span class="p">(</span><span class="n">processor_to_app_data_base_address</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_memory_on_chip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs MemoryMapOnHostChipReport is requested</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Memory report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_memory_map_report&quot;</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="n">memory_map_on_host_chip_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dsg_targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">)</span>

    <span class="c1"># TODO consider different cfg flags</span>
    <span class="k">def</span> <span class="nf">_report_compressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compressed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the compressor reports if requested</span>

<span class="sd">        :param compressed:</span>
<span class="sd">        :type compressed: MulticastRoutingTables or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Compressor report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_routing_table_reports&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_routing_tables_from_machine_reports&quot;</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="n">compressed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                    <span class="k">return</span>
                <span class="n">compressed</span> <span class="o">=</span> <span class="n">read_routing_tables_from_machine</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>

            <span class="n">router_report_from_compressed_router_tables</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>

            <span class="n">generate_comparison_router_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="n">compressed</span><span class="p">)</span>

            <span class="n">router_compressed_summary_report</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">)</span>

            <span class="n">routing_table_from_machine_report</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_report_fixed_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the FixedRouteFromMachineReport is requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Fixed route report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="c1"># TODO at the same time as LoadFixedRoutes?</span>
            <span class="n">fixed_route_from_machine_report</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_application_load_executables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; algorithms needed for loading the binaries to the SpiNNaker machine</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">LOADING</span><span class="p">,</span> <span class="s2">&quot;Load executable app images&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">load_app_images</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the load algotithms</span>

<span class="sd">        :param bool graph_changed: Flag to say the graph changed,</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set up timing</span>
        <span class="n">load_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="n">load_timer</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_routing_setup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_graph_binary_gatherer</span><span class="p">()</span>
        <span class="c1"># loading_algorithms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_uncompressed_routing_table</span><span class="p">()</span>
        <span class="n">compressor</span><span class="p">,</span> <span class="n">pre_compress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compressor_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_pre_compression</span><span class="p">(</span><span class="n">pre_compress</span><span class="p">)</span>
        <span class="n">compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_early_compression</span><span class="p">(</span><span class="n">compressor</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">graph_changed</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_load_fixed_routes</span><span class="p">()</span>
        <span class="n">processor_to_app_data_base_address</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_system_data_specification</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_load_system_executable_images</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_load_tags</span><span class="p">()</span>
        <span class="n">processor_to_app_data_base_address</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_application_data_specification</span><span class="p">(</span>
                <span class="n">processor_to_app_data_base_address</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_do_extra_load_algorithms</span><span class="p">()</span>
        <span class="n">compressed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_delayed_compression</span><span class="p">(</span><span class="n">compressor</span><span class="p">,</span> <span class="n">compressed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_load_routing_tables</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_report_bit_field_compressor</span><span class="p">()</span>

        <span class="c1"># TODO Was master correct to run the report first?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_tags_from_machine_report</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_memory_on_host</span><span class="p">(</span><span class="n">processor_to_app_data_base_address</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_memory_on_chip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_compressed</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_report_fixed_routes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_application_load_executables</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">ProvenanceWriter</span><span class="p">()</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_category_timing</span><span class="p">(</span>
                <span class="n">LOADING</span><span class="p">,</span> <span class="n">load_timer</span><span class="o">.</span><span class="n">take_sample</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_sdram_usage_report_per_chip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO why in do run</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Sdram usage per chip report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_sdram_usage_report_per_chip&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">sdram_usage_report_per_chip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_plan_n_timesteps</span><span class="p">,</span>
                <span class="n">data_n_timesteps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_dsg_region_reloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Runs, times and logs the DSGRegionReloader if required</span>

<span class="sd">            Reload any parameters over the loaded data if we have already</span>
<span class="sd">            run and not using a virtual board and the data hasn&#39;t already</span>
<span class="sd">            been regenerated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_ran</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;DSG region reloader&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">dsg_region_reloader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_graph_provenance_gatherer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and log the GraphProvenanceGatherer if requested</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Graph provenance gatherer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;read_provenance_data&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">graph_provenance_gatherer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_placements_provenance_gatherer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and log the PlacementsProvenanceGatherer if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Placements provenance gatherer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;read_provenance_data&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">placements_provenance_gatherer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_router_provenance_gatherer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and log the RouterProvenanceGatherer if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Router provenance gatherer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;read_provenance_data&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">router_provenance_gatherer</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_vertices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_profile_data_gatherer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the ProfileDataGatherer if requested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Profile data gatherer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;read_provenance_data&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">profile_data_gatherer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_read_provenance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and log the methods that gather provenance</span>

<span class="sd">        :rtype: list(ProvenanceDataItem)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_graph_provenance_gatherer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_placements_provenance_gatherer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_router_provenance_gatherer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_profile_data_gatherer</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_report_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the energy report if requested</span>

<span class="sd">        :param int run_time: the run duration in milliseconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Energy report&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># TODO runtime is None</span>
            <span class="n">power_used</span> <span class="o">=</span> <span class="n">compute_energy_used</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_board_version</span><span class="p">,</span>
                <span class="n">run_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span><span class="p">)</span>

            <span class="n">energy_provenance_reporter</span><span class="p">(</span><span class="n">power_used</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>

            <span class="c1"># create energy reporter</span>
            <span class="n">energy_reporter</span> <span class="o">=</span> <span class="n">EnergyReport</span><span class="p">(</span>
                <span class="n">get_config_int</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spalloc_server</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remote_spinnaker_url</span><span class="p">)</span>

            <span class="c1"># run energy report</span>
            <span class="n">energy_reporter</span><span class="o">.</span><span class="n">write_energy_report</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span><span class="p">,</span> <span class="n">power_used</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_provenance_reports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs any reports based on provenance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_execute_clear_io_buf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runtime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the ChipIOBufClearer if required</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">runtime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Clear IO buffer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="c1"># TODO Why check empty_graph is always false??</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span><span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_iobuf_during_run&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="n">chip_io_buf_clearer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_runtime_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the runtime updater if required</span>

<span class="sd">        :param int n_sync_steps:</span>
<span class="sd">            The number of timesteps between synchronisations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Runtime Update&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ExecutableType</span><span class="o">.</span><span class="n">USES_SIMULATION_INTERFACE</span> <span class="ow">in</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">):</span>
                <span class="n">chip_runtime_updater</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_first_machine_time_step</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timer</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s2">&quot;No Simulation Interface used&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_create_database_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs Database Interface Creater</span>

<span class="sd">        Sets the _database_file_path data object</span>

<span class="sd">        :param int run_time: the run duration in milliseconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Create database interface&quot;</span><span class="p">):</span>
            <span class="c1"># Used to used compressed routing tables if available on host</span>
            <span class="c1"># TODO consider not saving router tabes.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_database_file_path</span> <span class="o">=</span> <span class="n">database_interface</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">,</span> <span class="n">run_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_run_time_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_create_notifiaction_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the creation of the Notification Protocol</span>

<span class="sd">        Sets the notification_interface data object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Create notification protocol&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_notification_interface</span> <span class="o">=</span> <span class="n">create_notification_protocol</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_database_socket_addresses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database_file_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_runner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">,</span> <span class="n">run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the ApplicationRunner</span>

<span class="sd">        :param int n_sync_steps:</span>
<span class="sd">            The number of timesteps between synchronisations</span>
<span class="sd">        :param int run_time: the run duration in milliseconds.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="n">APPLICATION_RUNNER</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="c1"># Don&#39;t timeout if a stepped mode is in operation</span>
            <span class="k">if</span> <span class="n">n_sync_steps</span><span class="p">:</span>
                <span class="n">time_threshold</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time_threshold</span> <span class="o">=</span> <span class="n">get_config_int</span><span class="p">(</span>
                    <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;post_simulation_overrun_before_error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="n">application_runner</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notification_interface</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="n">run_time</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span><span class="p">,</span> <span class="n">time_threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_extract_iobuff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the ChipIOBufExtractor if required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Extract IO buff&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_cfg_false</span><span class="p">(</span>
                    <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;extract_iobuf&quot;</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="c1"># ErrorMessages, WarnMessages output ignored as never used!</span>
            <span class="n">chip_io_buf_extractor</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_buffer_extractor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the BufferExtractor if required</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Buffer extractor&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">timer</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timer</span><span class="o">.</span><span class="n">skip_if_virtual_board</span><span class="p">():</span>
                <span class="k">return</span>
            <span class="n">buffer_extractor</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_extract_from_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_time</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the steps to extract data from the machine</span>

<span class="sd">        :param run_time: the run duration in milliseconds.</span>
<span class="sd">        :type run_time: int or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_extract_iobuff</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_buffer_extractor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_clear_io_buf</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>

        <span class="c1"># FinaliseTimingData never needed as just pushed self._ to inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_read_provenance</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">ProvenanceWriter</span><span class="p">()</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">insert_category_timing</span><span class="p">(</span>
                <span class="n">RUN_LOOP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_timer</span><span class="o">.</span><span class="n">take_sample</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_report_energy</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_provenance_reports</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__do_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the do run steps.</span>

<span class="sd">        :param n_machine_time_steps: Number of timesteps run</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :param int n_sync_steps:</span>
<span class="sd">            The number of timesteps between synchronisations</span>
<span class="sd">        :param bool graph_changed: Flag to say the graph changed,</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO virtual board</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_timer</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>
        <span class="n">run_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">run_time</span> <span class="o">=</span> <span class="n">n_machine_time_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_machine_time_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_number_of_machine_time_steps</span><span class="p">(</span><span class="n">n_machine_time_steps</span><span class="p">)</span>

        <span class="n">provide_injectables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sdram_usage_report_per_chip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">or</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_create_database_interface</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_create_notifiaction_protocol</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">graph_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execute_dsg_region_reloader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_runtime_update</span><span class="p">(</span><span class="n">n_sync_steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_runner</span><span class="p">(</span><span class="n">n_sync_steps</span><span class="p">,</span> <span class="n">run_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_machine_time_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_do_extract_from_machine</span><span class="p">(</span><span class="n">run_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># reset at the end of each do_run cycle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_machine_time_step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">clear_injectables</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_do_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs, times and logs the do run steps.</span>

<span class="sd">        :param n_machine_time_steps: Number of timesteps run</span>
<span class="sd">        :type n_machine_time_steps: int or None</span>
<span class="sd">        :param int n_sync_steps:</span>
<span class="sd">            The number of timesteps between synchronisations</span>
<span class="sd">        :param bool graph_changed: Flag to say the graph changed,</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__do_run</span><span class="p">(</span>
                <span class="n">n_machine_time_steps</span><span class="p">,</span> <span class="n">graph_changed</span><span class="p">,</span> <span class="n">n_sync_steps</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;User has aborted the simulation&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">run_e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recover_from_error</span><span class="p">(</span><span class="n">run_e</span><span class="p">)</span>

            <span class="c1"># if in debug mode, do not shut down machine</span>
            <span class="k">if</span> <span class="n">get_config_str</span><span class="p">(</span><span class="s2">&quot;Mode&quot;</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;Debug&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span>
                        <span class="n">turn_off_machine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">clear_tags</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">stop_e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error </span><span class="si">{</span><span class="n">stop_e</span><span class="si">}</span><span class="s2"> when attempting to stop&quot;</span><span class="p">)</span>

            <span class="c1"># reraise exception</span>
            <span class="k">raise</span> <span class="n">run_e</span>

    <span class="k">def</span> <span class="nf">_recover_from_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param Exception exception:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__recover_from_error</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">rec_e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Error </span><span class="si">{</span><span class="n">rec_e</span><span class="si">}</span><span class="s2"> when attempting to recover from error&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__recover_from_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param Exception exception:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if exception has an exception, print to system</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;An error has occurred during simulation&quot;</span><span class="p">)</span>
        <span class="c1"># Print the detail including the traceback</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Attempting to extract data</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract router provenance</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">router_provenance_gatherer</span><span class="p">(</span>
                <span class="n">transceiver</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="n">machine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="p">,</span>
                <span class="n">router_tables</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="p">,</span>
                <span class="n">extra_monitor_vertices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_extra_monitor_vertices</span><span class="p">,</span>
                <span class="n">placements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error reading router provenance&quot;</span><span class="p">)</span>

        <span class="c1"># Find the cores that are not in an expected state</span>
        <span class="n">unsuccessful_cores</span> <span class="o">=</span> <span class="n">CPUInfos</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">SpiNNManCoresNotInStateException</span><span class="p">):</span>
            <span class="n">unsuccessful_cores</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="n">failed_core_states</span><span class="p">()</span>

        <span class="c1"># If there are no cores in a bad state, find those not yet in</span>
        <span class="c1"># their finished state</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unsuccessful_cores</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">executable_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">:</span>
                <span class="n">failed_cores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">get_cores_not_in_state</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">[</span><span class="n">executable_type</span><span class="p">],</span>
                    <span class="n">executable_type</span><span class="o">.</span><span class="n">end_state</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">failed_cores</span><span class="p">:</span>
                    <span class="n">unsuccessful_cores</span><span class="o">.</span><span class="n">add_processor</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">failed_cores</span><span class="o">.</span><span class="n">get_cpu_info</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

        <span class="c1"># Print the details of error cores</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">core_info</span> <span class="ow">in</span> <span class="n">unsuccessful_cores</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">core_info</span><span class="o">.</span><span class="n">state</span>
            <span class="n">rte_state</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">RUN_TIME_EXCEPTION</span><span class="p">:</span>
                <span class="n">rte_state</span> <span class="o">=</span> <span class="s2">&quot; (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">core_info</span><span class="o">.</span><span class="n">run_time_error</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rte_state</span><span class="p">,</span> <span class="n">core_info</span><span class="o">.</span><span class="n">application_name</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">core_info</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">RUN_TIME_EXCEPTION</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;r0=0x</span><span class="si">{:08X}</span><span class="s2"> r1=0x</span><span class="si">{:08X}</span><span class="s2"> r2=0x</span><span class="si">{:08X}</span><span class="s2"> r3=0x</span><span class="si">{:08X}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;r4=0x</span><span class="si">{:08X}</span><span class="s2"> r5=0x</span><span class="si">{:08X}</span><span class="s2"> r6=0x</span><span class="si">{:08X}</span><span class="s2"> r7=0x</span><span class="si">{:08X}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                        <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">core_info</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;PSR=0x</span><span class="si">{:08X}</span><span class="s2"> SR=0x</span><span class="si">{:08X}</span><span class="s2"> LR=0x</span><span class="si">{:08X}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">core_info</span><span class="o">.</span><span class="n">processor_state_register</span><span class="p">,</span>
                    <span class="n">core_info</span><span class="o">.</span><span class="n">stack_pointer</span><span class="p">,</span> <span class="n">core_info</span><span class="o">.</span><span class="n">link_register</span><span class="p">))</span>

        <span class="c1"># Find the cores that are not in RTE i.e. that can still be read</span>
        <span class="n">non_rte_cores</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">core_info</span> <span class="ow">in</span> <span class="n">unsuccessful_cores</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">core_info</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">RUN_TIME_EXCEPTION</span> <span class="ow">and</span>
                <span class="n">core_info</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">WATCHDOG</span><span class="p">)]</span>

        <span class="c1"># If there are any cores that are not in RTE, extract data from them</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">non_rte_cores</span> <span class="ow">and</span>
                <span class="n">ExecutableType</span><span class="o">.</span><span class="n">USES_SIMULATION_INTERFACE</span> <span class="ow">in</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">):</span>
            <span class="n">non_rte_core_subsets</span> <span class="o">=</span> <span class="n">CoreSubsets</span><span class="p">()</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">non_rte_cores</span><span class="p">:</span>
                <span class="n">non_rte_core_subsets</span><span class="o">.</span><span class="n">add_processor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

            <span class="c1"># Attempt to force the cores to write provenance and exit</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">chip_provenance_updater</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="n">non_rte_core_subsets</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Could not update provenance on chip&quot;</span><span class="p">)</span>

            <span class="c1"># Extract any written provenance data</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">finished_cores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">get_cores_in_state</span><span class="p">(</span>
                    <span class="n">non_rte_core_subsets</span><span class="p">,</span> <span class="n">CPUState</span><span class="o">.</span><span class="n">FINISHED</span><span class="p">)</span>
                <span class="n">finished_placements</span> <span class="o">=</span> <span class="n">Placements</span><span class="p">()</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="ow">in</span> <span class="n">finished_cores</span><span class="p">:</span>
                    <span class="n">finished_placements</span><span class="o">.</span><span class="n">add_placement</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span><span class="o">.</span><span class="n">get_placement_on_processor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
                <span class="n">placements_provenance_gatherer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="n">finished_placements</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">pro_e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not read provenance due to </span><span class="si">{</span><span class="n">pro_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Read IOBUF where possible (that should be everywhere)</span>
        <span class="n">iobuf</span> <span class="o">=</span> <span class="n">IOBufExtractor</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_finder</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span> <span class="o">=</span> <span class="n">iobuf</span><span class="o">.</span><span class="n">extract_iobuf</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Could not get iobuf&quot;</span><span class="p">)</span>
            <span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="c1"># Print the IOBUFs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_iobuf</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_print_iobuf</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">warnings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param list(str) errors:</span>
<span class="sd">        :param list(str) warnings:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warning</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.reset"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Code that puts the simulation back at time zero</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Resetting&quot;</span><span class="p">)</span>

        <span class="c1"># rewind the buffers from the buffer manager, to start at the beginning</span>
        <span class="c1"># of the simulation again and clear buffered out</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="c1"># reset the current count of how many milliseconds the application</span>
        <span class="c1"># has ran for over multiple calls to run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># sets the reset last flag to true, so that when run occurs, the tools</span>
        <span class="c1"># know to update the vertices which need to know a reset has occurred</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># User must assume on reset any previous machine (info) is dead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_accessed_machine</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">assert</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_accessed_machine</span><span class="p">)</span>

        <span class="c1"># Reset the graph off the machine, to set things to time 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__reset_graph_elements</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_detect_if_graph_has_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reset_flags</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Iterates though the original graphs looking for changes.</span>

<span class="sd">        :param bool reset_flags:</span>
<span class="sd">        :return: mapping_changed, data_changed</span>
<span class="sd">        :rtype: tuple(bool, bool)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># Set changed - note that we can&#39;t return yet as we still have to</span>
            <span class="c1"># mark vertices as not changed, otherwise they will keep reporting</span>
            <span class="c1"># that they have changed when they haven&#39;t</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_accessed_machine</span><span class="p">:</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># if application graph is filled, check their changes</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">vertex</span><span class="o">.</span><span class="n">requires_mapping</span><span class="p">:</span>
                        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">vertex</span><span class="o">.</span><span class="n">requires_data_generation</span><span class="p">:</span>
                        <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">reset_flags</span><span class="p">:</span>
                        <span class="n">vertex</span><span class="o">.</span><span class="n">mark_no_changes</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">outgoing_edge_partitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">partition</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">requires_mapping</span><span class="p">:</span>
                            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">requires_data_generation</span><span class="p">:</span>
                            <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">reset_flags</span><span class="p">:</span>
                            <span class="n">edge</span><span class="o">.</span><span class="n">mark_no_changes</span><span class="p">()</span>

        <span class="c1"># if no application, but a machine graph, check for changes there</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">machine_vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">machine_vertex</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">machine_vertex</span><span class="o">.</span><span class="n">requires_mapping</span><span class="p">:</span>
                        <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">machine_vertex</span><span class="o">.</span><span class="n">requires_data_generation</span><span class="p">:</span>
                        <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">reset_flags</span><span class="p">:</span>
                        <span class="n">machine_vertex</span><span class="o">.</span><span class="n">mark_no_changes</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">outgoing_edge_partitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">machine_edge</span> <span class="ow">in</span> <span class="n">partition</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">machine_edge</span><span class="p">,</span> <span class="n">AbstractChangableAfterRun</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">machine_edge</span><span class="o">.</span><span class="n">requires_mapping</span><span class="p">:</span>
                            <span class="n">changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">machine_edge</span><span class="o">.</span><span class="n">requires_data_generation</span><span class="p">:</span>
                            <span class="n">data_changed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">reset_flags</span><span class="p">:</span>
                            <span class="n">machine_edge</span><span class="o">.</span><span class="n">mark_no_changes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">changed</span><span class="p">,</span> <span class="n">data_changed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_ran</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Whether the simulation has executed anything at all.</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The python machine description object.</span>

<span class="sd">         :rtype: ~spinn_machine.Machine</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_machine</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">no_machine_time_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of machine time steps.</span>

<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">machine_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a protected view of the machine_graph</span>
<span class="sd">        :rtype: ~pacman.model.graphs.machine.MachineGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MachineGraphView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine_graph</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">original_machine_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~pacman.model.graphs.machine.MachineGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">original_application_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~pacman.model.graphs.application.ApplicationGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">application_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The protected view of the application graph used to derive the</span>
<span class="sd">            runtime machine configuration.</span>

<span class="sd">        :rtype: ~pacman.model.graphs.application.ApplicationGraph</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ApplicationGraphView</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_application_graph</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">routing_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~pacman.model.routing_info.RoutingInfo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_routing_infos</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fixed_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: dict(tuple(int,int),~spinn_machine.FixedRouteEntry)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fixed_routes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">placements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Where machine vertices are placed on the machine.</span>

<span class="sd">        :rtype: ~pacman.model.placements.Placements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_placements</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">transceiver</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; How to talk to the machine.</span>

<span class="sd">        :rtype: ~spinnman.transceiver.Transceiver</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~pacman.model.tags.Tags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">buffer_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The buffer manager being used for loading/extracting buffers</span>

<span class="sd">        :rtype:</span>
<span class="sd">            ~spinn_front_end_common.interface.buffer_management.BufferManager</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_manager</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">none_labelled_edge_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of times edges have not been labelled.</span>

<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_none_labelled_edge_count</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.increment_none_labelled_edge_count"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.increment_none_labelled_edge_count">[docs]</a>    <span class="k">def</span> <span class="nf">increment_none_labelled_edge_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Increment the number of new edges which have not been labelled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_none_labelled_edge_count</span> <span class="o">+=</span> <span class="mi">1</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_virtual_board</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; True if this run is using a virtual machine</span>

<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_calls_to_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number for this or the next end_user call to run</span>

<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_calls_to_run</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_loops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The number for this or the net loop within an end_user run</span>

<span class="sd">        :rtype: int or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_loops</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.get_current_time"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.get_current_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the current simulation time.</span>

<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_time_step_ms</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;general front end instance for machine </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ipaddress</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;general front end instance for machine </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_hostname</span><span class="si">}</span><span class="s2">&quot;</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_application_vertex"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_application_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">add_application_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~pacman.model.graphs.application.ApplicationVertex vertex:</span>
<span class="sd">            the vertex to add to the graph</span>
<span class="sd">        :raises ConfigurationException: when both graphs contain vertices</span>
<span class="sd">        :raises PacmanConfigurationException:</span>
<span class="sd">            If there is an attempt to add the same vertex more than once</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Cannot add vertices to both the machine and application&quot;</span>
                <span class="s2">&quot; graphs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_machine_vertex"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_machine_vertex">[docs]</a>    <span class="k">def</span> <span class="nf">add_machine_vertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~pacman.model.graphs.machine.MachineVertex vertex:</span>
<span class="sd">            the vertex to add to the graph</span>
<span class="sd">        :raises ConfigurationException: when both graphs contain vertices</span>
<span class="sd">        :raises PacmanConfigurationException:</span>
<span class="sd">            If there is an attempt to add the same vertex more than once</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check that there&#39;s no application vertices added so far</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span>
                <span class="s2">&quot;Cannot add vertices to both the machine and application&quot;</span>
                <span class="s2">&quot; graphs&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_application_edge"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_application_edge">[docs]</a>    <span class="k">def</span> <span class="nf">add_application_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_to_add</span><span class="p">,</span> <span class="n">partition_identifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~pacman.model.graphs.application.ApplicationEdge edge_to_add:</span>
<span class="sd">            the edge to add to the graph</span>
<span class="sd">        :param str partition_identifier:</span>
<span class="sd">            the partition identifier for the outgoing edge partition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
            <span class="n">edge_to_add</span><span class="p">,</span> <span class="n">partition_identifier</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_machine_edge"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_machine_edge">[docs]</a>    <span class="k">def</span> <span class="nf">add_machine_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">partition_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param ~pacman.model.graphs.machine.MachineEdge edge:</span>
<span class="sd">            the edge to add to the graph</span>
<span class="sd">        :param str partition_id:</span>
<span class="sd">            the partition identifier for the outgoing edge partition</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">partition_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices_or_edges_added</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_shutdown</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">turn_off_machine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">clear_tags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param bool turn_off_machine:</span>
<span class="sd">        :param bool clear_routing_tables:</span>
<span class="sd">        :param bool clear_tags:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">SHUTDOWN</span>

        <span class="k">if</span> <span class="n">turn_off_machine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">turn_off_machine</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;turn_off_machine&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clear_routing_tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">clear_routing_tables</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
                <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_routing_tables&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">clear_tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">clear_tags</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;clear_tags&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if stopping on machine, clear IP tags and routing table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__clear</span><span class="p">(</span><span class="n">clear_tags</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="p">)</span>

        <span class="c1"># Fully stop the application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__stop_app</span><span class="p">()</span>

        <span class="c1"># stop the transceiver and allocation controller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__close_transceiver</span><span class="p">(</span><span class="n">turn_off_machine</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__close_allocation_controller</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notification_interface</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_notification_interface</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_notification_interface</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Error when closing Notifications&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear_tags</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param bool clear_tags:</span>
<span class="sd">        :param bool clear_routing_tables:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if stopping on machine, clear IP tags and</span>
        <span class="k">if</span> <span class="n">clear_tags</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ip_tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">ip_tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">clear_ip_tag</span><span class="p">(</span>
                    <span class="n">ip_tag</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">board_address</span><span class="o">=</span><span class="n">ip_tag</span><span class="o">.</span><span class="n">board_address</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">reverse_ip_tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="o">.</span><span class="n">reverse_ip_tags</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">clear_ip_tag</span><span class="p">(</span>
                    <span class="n">reverse_ip_tag</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                    <span class="n">board_address</span><span class="o">=</span><span class="n">reverse_ip_tag</span><span class="o">.</span><span class="n">board_address</span><span class="p">)</span>

        <span class="c1"># if clearing routing table entries, clear</span>
        <span class="k">if</span> <span class="n">clear_routing_tables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">router_table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router_tables</span><span class="o">.</span><span class="n">routing_tables</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">get_chip_at</span><span class="p">(</span>
                        <span class="n">router_table</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">router_table</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">virtual</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">clear_multicast_routes</span><span class="p">(</span>
                        <span class="n">router_table</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">router_table</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># clear values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__stop_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">stop_application</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__close_transceiver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">turn_off_machine</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param bool turn_off_machine:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">turn_off_machine</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Turning off machine&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">power_off_machine</span><span class="o">=</span><span class="n">turn_off_machine</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__close_allocation_controller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_machine_allocation_controller</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.stop"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">turn_off_machine</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># pylint: disable=arguments-differ</span>
             <span class="n">clear_routing_tables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clear_tags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        End running of the simulation.</span>

<span class="sd">        :param bool turn_off_machine:</span>
<span class="sd">            decides if the machine should be powered down after running the</span>
<span class="sd">            execution. Note that this powers down all boards connected to the</span>
<span class="sd">            BMP connections given to the transceiver</span>
<span class="sd">        :param bool clear_routing_tables: informs the tool chain if it</span>
<span class="sd">            should turn off the clearing of the routing tables</span>
<span class="sd">        :param bool clear_tags: informs the tool chain if it should clear the</span>
<span class="sd">            tags off the machine at stop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Simulator_Status</span><span class="o">.</span><span class="n">SHUTDOWN</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ConfigurationException</span><span class="p">(</span><span class="s2">&quot;Simulator has already been shutdown&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">SHUTDOWN</span>

        <span class="c1"># Keep track of any exception to be re-raised</span>
        <span class="n">exn</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If we have run forever, stop the binaries</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_has_ran</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_virtual_board</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_until_complete</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_do_stop_workflow</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">exn</span> <span class="o">=</span> <span class="n">e</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_recover_from_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># shut down the machine properly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown</span><span class="p">(</span><span class="n">turn_off_machine</span><span class="p">,</span> <span class="n">clear_routing_tables</span><span class="p">,</span> <span class="n">clear_tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">exn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_errored_file</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">exn</span>  <span class="c1"># pylint: disable=raising-bad-type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_finished_file</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_execute_application_finisher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">FecTimer</span><span class="p">(</span><span class="n">RUN_LOOP</span><span class="p">,</span> <span class="s2">&quot;Application finisher&quot;</span><span class="p">):</span>
            <span class="n">application_finisher</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executable_types</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_stop_workflow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :rtype: ~.PACMANAlgorithmExecutor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_application_finisher</span><span class="p">()</span>
        <span class="c1"># TODO is self._current_run_timesteps just 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_extract_from_machine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_current_run_timesteps</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.add_socket_address"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.add_socket_address">[docs]</a>    <span class="k">def</span> <span class="nf">add_socket_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">socket_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add the address of a socket used in the run notification protocol.</span>

<span class="sd">        :param ~spinn_utilities.socket_address.SocketAddress socket_address:</span>
<span class="sd">            The address of the database socket</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_database_socket_addresses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">socket_address</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_reset_last</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_reset_last</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_number_of_available_cores_on_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The number of available cores on the machine after taking\</span>
<span class="sd">            into account preallocated resources.</span>

<span class="sd">        :return: number of available cores</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_machine</span><span class="p">()</span>

        <span class="c1"># get cores of machine</span>
        <span class="n">cores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">total_available_user_cores</span>
        <span class="n">take_into_account_chip_power_monitor</span> <span class="o">=</span> <span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;write_energy_report&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">take_into_account_chip_power_monitor</span><span class="p">:</span>
            <span class="n">cores</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">n_chips</span>
        <span class="n">take_into_account_extra_monitor_cores</span> <span class="o">=</span> <span class="p">(</span><span class="n">get_config_bool</span><span class="p">(</span>
            <span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_advanced_monitor_support&quot;</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">get_config_bool</span><span class="p">(</span><span class="s2">&quot;Machine&quot;</span><span class="p">,</span> <span class="s2">&quot;enable_reinjection&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">take_into_account_extra_monitor_cores</span><span class="p">:</span>
            <span class="n">cores</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">n_chips</span>
            <span class="n">cores</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_machine</span><span class="o">.</span><span class="n">ethernet_connected_chips</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cores</span>

<div class="viewcode-block" id="AbstractSpinnakerBase.stop_run"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.stop_run">[docs]</a>    <span class="k">def</span> <span class="nf">stop_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Request that the current infinite run stop.</span>

<span class="sd">        .. note::</span>
<span class="sd">            This will need to be called from another thread as the infinite \</span>
<span class="sd">            run call is blocking.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">IN_RUN</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Simulator_Status</span><span class="o">.</span><span class="n">STOP_REQUESTED</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state_condition</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span></div>

<div class="viewcode-block" id="AbstractSpinnakerBase.continue_simulation"><a class="viewcode-back" href="../../../spinn_front_end_common.interface.html#spinn_front_end_common.interface.abstract_spinnaker_base.AbstractSpinnakerBase.continue_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">continue_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Continue a simulation that has been started in stepped mode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sync_signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="o">.</span><span class="n">SYNC0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sync_signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="o">.</span><span class="n">SYNC1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_txrx</span><span class="o">.</span><span class="n">send_signal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_app_id</span><span class="p">,</span> <span class="n">sync_signal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_sync_changes</span> <span class="o">+=</span> <span class="mi">1</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__reset_object</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="c1"># Reset an object if appropriate</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">AbstractCanReset</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">reset_to_first_timestep</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__reset_graph_elements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Reset any object that can reset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__reset_object</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_application_graph</span><span class="o">.</span><span class="n">outgoing_edge_partitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__reset_object</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">n_vertices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">machine_vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__reset_object</span><span class="p">(</span><span class="n">machine_vertex</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_machine_graph</span><span class="o">.</span><span class="n">outgoing_edge_partitions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">machine_edge</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__reset_object</span><span class="p">(</span><span class="n">machine_edge</span><span class="p">)</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SpiNNFrontEndCommon 6.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">spinn_front_end_common.interface.abstract_spinnaker_base</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2021.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>